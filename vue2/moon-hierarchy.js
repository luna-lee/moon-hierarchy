(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e(require("d3"),require("lodash-es")):"function"===typeof define&&define.amd?define(["d3","lodash-es"],e):"object"===typeof exports?exports["moon-hierarchy"]=e(require("d3"),require("lodash-es")):t["moon-hierarchy"]=e(t["d3"],t["lodash-es"])})("undefined"!==typeof self?self:this,function(t,e){return function(){"use strict";var n={34:function(t,e,n){var r=n(4901);t.exports=function(t){return"object"==typeof t?null!==t:r(t)}},81:function(t,e,n){var r=n(9565),i=n(9306),o=n(8551),s=n(6823),a=n(851),h=TypeError;t.exports=function(t,e){var n=arguments.length<2?a(t):e;if(i(n))return o(r(n,t));throw new h(s(t)+" is not iterable")}},116:function(t,e,n){var r=n(6518),i=n(9565),o=n(2652),s=n(9306),a=n(8551),h=n(1767),d=n(9539),c=n(4549),l=c("find",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:l},{find:function(t){a(this);try{s(t)}catch(r){d(this,"throw",r)}if(l)return i(l,this,t);var e=h(this),n=0;return o(e,function(e,r){if(t(e,n++))return r(e)},{IS_RECORD:!0,INTERRUPTED:!0}).result}})},283:function(t,e,n){var r=n(9504),i=n(9039),o=n(4901),s=n(9297),a=n(3724),h=n(350).CONFIGURABLE,d=n(3706),c=n(1181),l=c.enforce,u=c.get,f=String,y=Object.defineProperty,p=r("".slice),g=r("".replace),m=r([].join),v=a&&!i(function(){return 8!==y(function(){},"length",{value:8}).length}),b=String(String).split("String"),x=t.exports=function(t,e,n){"Symbol("===p(f(e),0,7)&&(e="["+g(f(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!s(t,"name")||h&&t.name!==e)&&(a?y(t,"name",{value:e,configurable:!0}):t.name=e),v&&n&&s(n,"arity")&&t.length!==n.arity&&y(t,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&y(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(i){}var r=l(t);return s(r,"source")||(r.source=m(b,"string"==typeof e?e:"")),t};Function.prototype.toString=x(function(){return o(this)&&u(this).source||d(this)},"toString")},350:function(t,e,n){var r=n(3724),i=n(9297),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=i(o,"name"),h=a&&"something"===function(){}.name,d=a&&(!r||r&&s(o,"name").configurable);t.exports={EXISTS:a,PROPER:h,CONFIGURABLE:d}},397:function(t,e,n){var r=n(7751);t.exports=r("document","documentElement")},421:function(t){t.exports={}},507:function(t,e,n){var r=n(9565);t.exports=function(t,e,n){var i,o,s=n?t:t.iterator,a=t.next;while(!(i=r(a,s)).done)if(o=e(i.value),void 0!==o)return o}},616:function(t,e,n){var r=n(9039);t.exports=!r(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})},679:function(t,e,n){var r=n(1625),i=TypeError;t.exports=function(t,e){if(r(e,t))return t;throw new i("Incorrect invocation")}},684:function(t){t.exports=function(t,e){var n="function"==typeof Iterator&&Iterator.prototype[t];if(n)try{n.call({next:null},e).next()}catch(r){return!0}}},741:function(t){var e=Math.ceil,n=Math.floor;t.exports=Math.trunc||function(t){var r=+t;return(r>0?n:e)(r)}},757:function(t,e,n){var r=n(7751),i=n(4901),o=n(1625),s=n(7040),a=Object;t.exports=s?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return i(e)&&o(e.prototype,a(t))}},851:function(t,e,n){var r=n(6955),i=n(5966),o=n(4117),s=n(6269),a=n(8227),h=a("iterator");t.exports=function(t){if(!o(t))return i(t,h)||i(t,"@@iterator")||s[r(t)]}},1072:function(t,e,n){var r=n(1828),i=n(8727);t.exports=Object.keys||function(t){return r(t,i)}},1181:function(t,e,n){var r,i,o,s=n(8622),a=n(4576),h=n(34),d=n(6699),c=n(9297),l=n(7629),u=n(6119),f=n(421),y="Object already initialized",p=a.TypeError,g=a.WeakMap,m=function(t){return o(t)?i(t):r(t,{})},v=function(t){return function(e){var n;if(!h(e)||(n=i(e)).type!==t)throw new p("Incompatible receiver, "+t+" required");return n}};if(s||l.state){var b=l.state||(l.state=new g);b.get=b.get,b.has=b.has,b.set=b.set,r=function(t,e){if(b.has(t))throw new p(y);return e.facade=t,b.set(t,e),e},i=function(t){return b.get(t)||{}},o=function(t){return b.has(t)}}else{var x=u("state");f[x]=!0,r=function(t,e){if(c(t,x))throw new p(y);return e.facade=t,d(t,x,e),e},i=function(t){return c(t,x)?t[x]:{}},o=function(t){return c(t,x)}}t.exports={set:r,get:i,has:o,enforce:m,getterFor:v}},1291:function(t,e,n){var r=n(741);t.exports=function(t){var e=+t;return e!==e||0===e?0:r(e)}},1385:function(t,e,n){var r=n(9539);t.exports=function(t,e,n){for(var i=t.length-1;i>=0;i--)if(void 0!==t[i])try{n=r(t[i].iterator,e,n)}catch(o){e="throw",n=o}if("throw"===e)throw n;return n}},1625:function(t,e,n){var r=n(9504);t.exports=r({}.isPrototypeOf)},1698:function(t,e,n){var r=n(6518),i=n(4204),o=n(9835),s=n(4916),a=!s("union")||!o("union");r({target:"Set",proto:!0,real:!0,forced:a},{union:i})},1701:function(t,e,n){var r=n(6518),i=n(9565),o=n(9306),s=n(8551),a=n(1767),h=n(9462),d=n(6319),c=n(9539),l=n(684),u=n(4549),f=n(6395),y=!f&&!l("map",function(){}),p=!f&&!y&&u("map",TypeError),g=f||y||p,m=h(function(){var t=this.iterator,e=s(i(this.next,t)),n=this.done=!!e.done;if(!n)return d(t,this.mapper,[e.value,this.counter++],!0)});r({target:"Iterator",proto:!0,real:!0,forced:g},{map:function(t){s(this);try{o(t)}catch(e){c(this,"throw",e)}return p?i(p,this,t):new m(a(this),{mapper:t})}})},1767:function(t){t.exports=function(t){return{iterator:t,next:t.next,done:!1}}},1828:function(t,e,n){var r=n(9504),i=n(9297),o=n(5397),s=n(9617).indexOf,a=n(421),h=r([].push);t.exports=function(t,e){var n,r=o(t),d=0,c=[];for(n in r)!i(a,n)&&i(r,n)&&h(c,n);while(e.length>d)i(r,n=e[d++])&&(~s(c,n)||h(c,n));return c}},2106:function(t,e,n){var r=n(283),i=n(4913);t.exports=function(t,e,n){return n.get&&r(n.get,e,{getter:!0}),n.set&&r(n.set,e,{setter:!0}),i.f(t,e,n)}},2140:function(t,e,n){var r=n(8227),i=r("toStringTag"),o={};o[i]="z",t.exports="[object z]"===String(o)},2195:function(t,e,n){var r=n(9504),i=r({}.toString),o=r("".slice);t.exports=function(t){return o(i(t),8,-1)}},2211:function(t,e,n){var r=n(9039);t.exports=!r(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},2360:function(t,e,n){var r,i=n(8551),o=n(6801),s=n(8727),a=n(421),h=n(397),d=n(4055),c=n(6119),l=">",u="<",f="prototype",y="script",p=c("IE_PROTO"),g=function(){},m=function(t){return u+y+l+t+u+"/"+y+l},v=function(t){t.write(m("")),t.close();var e=t.parentWindow.Object;return t=null,e},b=function(){var t,e=d("iframe"),n="java"+y+":";return e.style.display="none",h.appendChild(e),e.src=String(n),t=e.contentWindow.document,t.open(),t.write(m("document.F=Object")),t.close(),t.F},x=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}x="undefined"!=typeof document?document.domain&&r?v(r):b():v(r);var t=s.length;while(t--)delete x[f][s[t]];return x()};a[p]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(g[f]=i(t),n=new g,g[f]=null,n[p]=t):n=x(),void 0===e?n:o.f(n,e)}},2475:function(t,e,n){var r=n(6518),i=n(8527),o=n(4916),s=!o("isSupersetOf",function(t){return!t});r({target:"Set",proto:!0,real:!0,forced:s},{isSupersetOf:i})},2489:function(t,e,n){var r=n(6518),i=n(9565),o=n(9306),s=n(8551),a=n(1767),h=n(9462),d=n(6319),c=n(6395),l=n(9539),u=n(684),f=n(4549),y=!c&&!u("filter",function(){}),p=!c&&!y&&f("filter",TypeError),g=c||y||p,m=h(function(){var t,e,n,r=this.iterator,o=this.predicate,a=this.next;while(1){if(t=s(i(a,r)),e=this.done=!!t.done,e)return;if(n=t.value,d(r,o,[n,this.counter++],!0))return n}});r({target:"Iterator",proto:!0,real:!0,forced:g},{filter:function(t){s(this);try{o(t)}catch(e){l(this,"throw",e)}return p?i(p,this,t):new m(a(this),{predicate:t})}})},2529:function(t){t.exports=function(t,e){return{value:t,done:e}}},2652:function(t,e,n){var r=n(6080),i=n(9565),o=n(8551),s=n(6823),a=n(4209),h=n(6198),d=n(1625),c=n(81),l=n(851),u=n(9539),f=TypeError,y=function(t,e){this.stopped=t,this.result=e},p=y.prototype;t.exports=function(t,e,n){var g,m,v,b,x,w,_,C=n&&n.that,O=!(!n||!n.AS_ENTRIES),D=!(!n||!n.IS_RECORD),N=!(!n||!n.IS_ITERATOR),S=!(!n||!n.INTERRUPTED),k=r(e,C),I=function(t){return g&&u(g,"normal"),new y(!0,t)},$=function(t){return O?(o(t),S?k(t[0],t[1],I):k(t[0],t[1])):S?k(t,I):k(t)};if(D)g=t.iterator;else if(N)g=t;else{if(m=l(t),!m)throw new f(s(t)+" is not iterable");if(a(m)){for(v=0,b=h(t);b>v;v++)if(x=$(t[v]),x&&d(p,x))return x;return new y(!1)}g=c(t,m)}w=D?t.next:g.next;while(!(_=i(w,g)).done){try{x=$(_.value)}catch(L){u(g,"throw",L)}if("object"==typeof x&&x&&d(p,x))return x}return new y(!1)}},2777:function(t,e,n){var r=n(9565),i=n(34),o=n(757),s=n(5966),a=n(4270),h=n(8227),d=TypeError,c=h("toPrimitive");t.exports=function(t,e){if(!i(t)||o(t))return t;var n,h=s(t,c);if(h){if(void 0===e&&(e="default"),n=r(h,t,e),!i(n)||o(n))return n;throw new d("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},2787:function(t,e,n){var r=n(9297),i=n(4901),o=n(8981),s=n(6119),a=n(2211),h=s("IE_PROTO"),d=Object,c=d.prototype;t.exports=a?d.getPrototypeOf:function(t){var e=o(t);if(r(e,h))return e[h];var n=e.constructor;return i(n)&&e instanceof n?n.prototype:e instanceof d?c:null}},2796:function(t,e,n){var r=n(9039),i=n(4901),o=/#|\.prototype\./,s=function(t,e){var n=h[a(t)];return n===c||n!==d&&(i(e)?r(e):!!e)},a=s.normalize=function(t){return String(t).replace(o,".").toLowerCase()},h=s.data={},d=s.NATIVE="N",c=s.POLYFILL="P";t.exports=s},2839:function(t,e,n){var r=n(4576),i=r.navigator,o=i&&i.userAgent;t.exports=o?String(o):""},3392:function(t,e,n){var r=n(9504),i=0,o=Math.random(),s=r(1.1.toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+s(++i+o,36)}},3440:function(t,e,n){var r=n(7080),i=n(4402),o=n(9286),s=n(5170),a=n(3789),h=n(8469),d=n(507),c=i.has,l=i.remove;t.exports=function(t){var e=r(this),n=a(t),i=o(e);return s(e)<=n.size?h(e,function(t){n.includes(t)&&l(i,t)}):d(n.getIterator(),function(t){c(i,t)&&l(i,t)}),i}},3579:function(t,e,n){var r=n(6518),i=n(9565),o=n(2652),s=n(9306),a=n(8551),h=n(1767),d=n(9539),c=n(4549),l=c("some",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:l},{some:function(t){a(this);try{s(t)}catch(r){d(this,"throw",r)}if(l)return i(l,this,t);var e=h(this),n=0;return o(e,function(e,r){if(t(e,n++))return r()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3650:function(t,e,n){var r=n(7080),i=n(4402),o=n(9286),s=n(3789),a=n(507),h=i.add,d=i.has,c=i.remove;t.exports=function(t){var e=r(this),n=s(t).getIterator(),i=o(e);return a(n,function(t){d(e,t)?c(i,t):h(i,t)}),i}},3706:function(t,e,n){var r=n(9504),i=n(4901),o=n(7629),s=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(t){return s(t)}),t.exports=o.inspectSource},3717:function(t,e){e.f=Object.getOwnPropertySymbols},3724:function(t,e,n){var r=n(9039);t.exports=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},3789:function(t,e,n){var r=n(9306),i=n(8551),o=n(9565),s=n(1291),a=n(1767),h="Invalid size",d=RangeError,c=TypeError,l=Math.max,u=function(t,e){this.set=t,this.size=l(e,0),this.has=r(t.has),this.keys=r(t.keys)};u.prototype={getIterator:function(){return a(i(o(this.keys,this.set)))},includes:function(t){return o(this.has,this.set,t)}},t.exports=function(t){i(t);var e=+t.size;if(e!==e)throw new c(h);var n=s(e);if(n<0)throw new d(h);return new u(t,n)}},3838:function(t,e,n){var r=n(7080),i=n(5170),o=n(8469),s=n(3789);t.exports=function(t){var e=r(this),n=s(t);return!(i(e)>n.size)&&!1!==o(e,function(t){if(!n.includes(t))return!1},!0)}},3853:function(t,e,n){var r=n(6518),i=n(4449),o=n(4916),s=!o("isDisjointFrom",function(t){return!t});r({target:"Set",proto:!0,real:!0,forced:s},{isDisjointFrom:i})},3893:function(e){e.exports=t},4055:function(t,e,n){var r=n(4576),i=n(34),o=r.document,s=i(o)&&i(o.createElement);t.exports=function(t){return s?o.createElement(t):{}}},4114:function(t,e,n){var r=n(6518),i=n(8981),o=n(6198),s=n(4527),a=n(6837),h=n(9039),d=h(function(){return 4294967297!==[].push.call({length:4294967296},1)}),c=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},l=d||!c();r({target:"Array",proto:!0,arity:1,forced:l},{push:function(t){var e=i(this),n=o(e),r=arguments.length;a(n+r);for(var h=0;h<r;h++)e[n]=arguments[h],n++;return s(e,n),n}})},4117:function(t){t.exports=function(t){return null===t||void 0===t}},4204:function(t,e,n){var r=n(7080),i=n(4402).add,o=n(9286),s=n(3789),a=n(507);t.exports=function(t){var e=r(this),n=s(t).getIterator(),h=o(e);return a(n,function(t){i(h,t)}),h}},4209:function(t,e,n){var r=n(8227),i=n(6269),o=r("iterator"),s=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||s[o]===t)}},4270:function(t,e,n){var r=n(9565),i=n(4901),o=n(34),s=TypeError;t.exports=function(t,e){var n,a;if("string"===e&&i(n=t.toString)&&!o(a=r(n,t)))return a;if(i(n=t.valueOf)&&!o(a=r(n,t)))return a;if("string"!==e&&i(n=t.toString)&&!o(a=r(n,t)))return a;throw new s("Can't convert object to primitive value")}},4376:function(t,e,n){var r=n(2195);t.exports=Array.isArray||function(t){return"Array"===r(t)}},4402:function(t,e,n){var r=n(9504),i=Set.prototype;t.exports={Set:Set,add:r(i.add),has:r(i.has),remove:r(i["delete"]),proto:i}},4449:function(t,e,n){var r=n(7080),i=n(4402).has,o=n(5170),s=n(3789),a=n(8469),h=n(507),d=n(9539);t.exports=function(t){var e=r(this),n=s(t);if(o(e)<=n.size)return!1!==a(e,function(t){if(n.includes(t))return!1},!0);var c=n.getIterator();return!1!==h(c,function(t){if(i(e,t))return d(c,"normal",!1)})}},4495:function(t,e,n){var r=n(9519),i=n(9039),o=n(4576),s=o.String;t.exports=!!Object.getOwnPropertySymbols&&!i(function(){var t=Symbol("symbol detection");return!s(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41})},4527:function(t,e,n){var r=n(3724),i=n(4376),o=TypeError,s=Object.getOwnPropertyDescriptor,a=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=a?function(t,e){if(i(t)&&!s(t,"length").writable)throw new o("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},4549:function(t,e,n){var r=n(4576);t.exports=function(t,e){var n=r.Iterator,i=n&&n.prototype,o=i&&i[t],s=!1;if(o)try{o.call({next:function(){return{done:!0}},return:function(){s=!0}},-1)}catch(a){a instanceof e||(s=!1)}if(!s)return o}},4576:function(t,e,n){var r=function(t){return t&&t.Math===Math&&t};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()},4659:function(t,e,n){var r=n(3724),i=n(4913),o=n(6980);t.exports=function(t,e,n){r?i.f(t,e,o(0,n)):t[e]=n}},4901:function(t){var e="object"==typeof document&&document.all;t.exports="undefined"==typeof e&&void 0!==e?function(t){return"function"==typeof t||t===e}:function(t){return"function"==typeof t}},4913:function(t,e,n){var r=n(3724),i=n(5917),o=n(8686),s=n(8551),a=n(6969),h=TypeError,d=Object.defineProperty,c=Object.getOwnPropertyDescriptor,l="enumerable",u="configurable",f="writable";e.f=r?o?function(t,e,n){if(s(t),e=a(e),s(n),"function"===typeof t&&"prototype"===e&&"value"in n&&f in n&&!n[f]){var r=c(t,e);r&&r[f]&&(t[e]=n.value,n={configurable:u in n?n[u]:r[u],enumerable:l in n?n[l]:r[l],writable:!1})}return d(t,e,n)}:d:function(t,e,n){if(s(t),e=a(e),s(n),i)try{return d(t,e,n)}catch(r){}if("get"in n||"set"in n)throw new h("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},4916:function(t,e,n){var r=n(7751),i=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},o=function(t){return{size:t,has:function(){return!0},keys:function(){throw new Error("e")}}};t.exports=function(t,e){var n=r("Set");try{(new n)[t](i(0));try{return(new n)[t](i(-1)),!1}catch(a){if(!e)return!0;try{return(new n)[t](o(-1/0)),!1}catch(h){var s=new n;return s.add(1),s.add(2),e(s[t](o(1/0)))}}}catch(h){return!1}}},5024:function(t,e,n){var r=n(6518),i=n(3650),o=n(9835),s=n(4916),a=!s("symmetricDifference")||!o("symmetricDifference");r({target:"Set",proto:!0,real:!0,forced:a},{symmetricDifference:i})},5031:function(t,e,n){var r=n(7751),i=n(9504),o=n(8480),s=n(3717),a=n(8551),h=i([].concat);t.exports=r("Reflect","ownKeys")||function(t){var e=o.f(a(t)),n=s.f;return n?h(e,n(t)):e}},5170:function(t,e,n){var r=n(6706),i=n(4402);t.exports=r(i.proto,"size","get")||function(t){return t.size}},5397:function(t,e,n){var r=n(7055),i=n(7750);t.exports=function(t){return r(i(t))}},5610:function(t,e,n){var r=n(1291),i=Math.max,o=Math.min;t.exports=function(t,e){var n=r(t);return n<0?i(n+e,0):o(n,e)}},5745:function(t,e,n){var r=n(7629);t.exports=function(t,e){return r[t]||(r[t]=e||{})}},5876:function(t,e,n){var r=n(6518),i=n(3838),o=n(4916),s=!o("isSubsetOf",function(t){return t});r({target:"Set",proto:!0,real:!0,forced:s},{isSubsetOf:i})},5917:function(t,e,n){var r=n(3724),i=n(9039),o=n(4055);t.exports=!r&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},5966:function(t,e,n){var r=n(9306),i=n(4117);t.exports=function(t,e){var n=t[e];return i(n)?void 0:r(n)}},6076:function(t){t.exports=e},6080:function(t,e,n){var r=n(7476),i=n(9306),o=n(616),s=r(r.bind);t.exports=function(t,e){return i(t),void 0===e?t:o?s(t,e):function(){return t.apply(e,arguments)}}},6119:function(t,e,n){var r=n(5745),i=n(3392),o=r("keys");t.exports=function(t){return o[t]||(o[t]=i(t))}},6198:function(t,e,n){var r=n(8014);t.exports=function(t){return r(t.length)}},6269:function(t){t.exports={}},6279:function(t,e,n){var r=n(6840);t.exports=function(t,e,n){for(var i in e)r(t,i,e[i],n);return t}},6319:function(t,e,n){var r=n(8551),i=n(9539);t.exports=function(t,e,n,o){try{return o?e(r(n)[0],n[1]):e(n)}catch(s){i(t,"throw",s)}}},6395:function(t){t.exports=!1},6518:function(t,e,n){var r=n(4576),i=n(7347).f,o=n(6699),s=n(6840),a=n(9433),h=n(7740),d=n(2796);t.exports=function(t,e){var n,c,l,u,f,y,p=t.target,g=t.global,m=t.stat;if(c=g?r:m?r[p]||a(p,{}):r[p]&&r[p].prototype,c)for(l in e){if(f=e[l],t.dontCallGetSet?(y=i(c,l),u=y&&y.value):u=c[l],n=d(g?l:p+(m?".":"#")+l,t.forced),!n&&void 0!==u){if(typeof f==typeof u)continue;h(f,u)}(t.sham||u&&u.sham)&&o(f,"sham",!0),s(c,l,f,t)}}},6699:function(t,e,n){var r=n(3724),i=n(4913),o=n(6980);t.exports=r?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},6706:function(t,e,n){var r=n(9504),i=n(9306);t.exports=function(t,e,n){try{return r(i(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(o){}}},6801:function(t,e,n){var r=n(3724),i=n(8686),o=n(4913),s=n(8551),a=n(5397),h=n(1072);e.f=r&&!i?Object.defineProperties:function(t,e){s(t);var n,r=a(e),i=h(e),d=i.length,c=0;while(d>c)o.f(t,n=i[c++],r[n]);return t}},6823:function(t){var e=String;t.exports=function(t){try{return e(t)}catch(n){return"Object"}}},6837:function(t){var e=TypeError,n=9007199254740991;t.exports=function(t){if(t>n)throw e("Maximum allowed index exceeded");return t}},6840:function(t,e,n){var r=n(4901),i=n(4913),o=n(283),s=n(9433);t.exports=function(t,e,n,a){a||(a={});var h=a.enumerable,d=void 0!==a.name?a.name:e;if(r(n)&&o(n,d,a),a.global)h?t[e]=n:s(e,n);else{try{a.unsafe?t[e]&&(h=!0):delete t[e]}catch(c){}h?t[e]=n:i.f(t,e,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},6955:function(t,e,n){var r=n(2140),i=n(4901),o=n(2195),s=n(8227),a=s("toStringTag"),h=Object,d="Arguments"===o(function(){return arguments}()),c=function(t,e){try{return t[e]}catch(n){}};t.exports=r?o:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=c(e=h(t),a))?n:d?o(e):"Object"===(r=o(e))&&i(e.callee)?"Arguments":r}},6969:function(t,e,n){var r=n(2777),i=n(757);t.exports=function(t){var e=r(t,"string");return i(e)?e:e+""}},6980:function(t){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},7040:function(t,e,n){var r=n(4495);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7055:function(t,e,n){var r=n(9504),i=n(9039),o=n(2195),s=Object,a=r("".split);t.exports=i(function(){return!s("z").propertyIsEnumerable(0)})?function(t){return"String"===o(t)?a(t,""):s(t)}:s},7080:function(t,e,n){var r=n(4402).has;t.exports=function(t){return r(t),t}},7347:function(t,e,n){var r=n(3724),i=n(9565),o=n(8773),s=n(6980),a=n(5397),h=n(6969),d=n(9297),c=n(5917),l=Object.getOwnPropertyDescriptor;e.f=r?l:function(t,e){if(t=a(t),e=h(e),c)try{return l(t,e)}catch(n){}if(d(t,e))return s(!i(o.f,t,e),t[e])}},7476:function(t,e,n){var r=n(2195),i=n(9504);t.exports=function(t){if("Function"===r(t))return i(t)}},7588:function(t,e,n){var r=n(6518),i=n(9565),o=n(2652),s=n(9306),a=n(8551),h=n(1767),d=n(9539),c=n(4549),l=c("forEach",TypeError);r({target:"Iterator",proto:!0,real:!0,forced:l},{forEach:function(t){a(this);try{s(t)}catch(r){d(this,"throw",r)}if(l)return i(l,this,t);var e=h(this),n=0;o(e,function(e){t(e,n++)},{IS_RECORD:!0})}})},7629:function(t,e,n){var r=n(6395),i=n(4576),o=n(9433),s="__core-js_shared__",a=t.exports=i[s]||o(s,{});(a.versions||(a.versions=[])).push({version:"3.43.0",mode:r?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.43.0/LICENSE",source:"https://github.com/zloirock/core-js"})},7642:function(t,e,n){var r=n(6518),i=n(3440),o=n(9039),s=n(4916),a=!s("difference",function(t){return 0===t.size}),h=a||o(function(){var t={size:1,has:function(){return!0},keys:function(){var t=0;return{next:function(){var n=t++>1;return e.has(1)&&e.clear(),{done:n,value:2}}}}},e=new Set([1,2,3,4]);return 3!==e.difference(t).size});r({target:"Set",proto:!0,real:!0,forced:h},{difference:i})},7657:function(t,e,n){var r,i,o,s=n(9039),a=n(4901),h=n(34),d=n(2360),c=n(2787),l=n(6840),u=n(8227),f=n(6395),y=u("iterator"),p=!1;[].keys&&(o=[].keys(),"next"in o?(i=c(c(o)),i!==Object.prototype&&(r=i)):p=!0);var g=!h(r)||s(function(){var t={};return r[y].call(t)!==t});g?r={}:f&&(r=d(r)),a(r[y])||l(r,y,function(){return this}),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:p}},7740:function(t,e,n){var r=n(9297),i=n(5031),o=n(7347),s=n(4913);t.exports=function(t,e,n){for(var a=i(e),h=s.f,d=o.f,c=0;c<a.length;c++){var l=a[c];r(t,l)||n&&r(n,l)||h(t,l,d(e,l))}}},7750:function(t,e,n){var r=n(4117),i=TypeError;t.exports=function(t){if(r(t))throw new i("Can't call method on "+t);return t}},7751:function(t,e,n){var r=n(4576),i=n(4901),o=function(t){return i(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?o(r[t]):r[t]&&r[t][e]}},8004:function(t,e,n){var r=n(6518),i=n(9039),o=n(8750),s=n(4916),a=!s("intersection",function(t){return 2===t.size&&t.has(1)&&t.has(2)})||i(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))});r({target:"Set",proto:!0,real:!0,forced:a},{intersection:o})},8014:function(t,e,n){var r=n(1291),i=Math.min;t.exports=function(t){var e=r(t);return e>0?i(e,9007199254740991):0}},8111:function(t,e,n){var r=n(6518),i=n(4576),o=n(679),s=n(8551),a=n(4901),h=n(2787),d=n(2106),c=n(4659),l=n(9039),u=n(9297),f=n(8227),y=n(7657).IteratorPrototype,p=n(3724),g=n(6395),m="constructor",v="Iterator",b=f("toStringTag"),x=TypeError,w=i[v],_=g||!a(w)||w.prototype!==y||!l(function(){w({})}),C=function(){if(o(this,y),h(this)===y)throw new x("Abstract class Iterator not directly constructable")},O=function(t,e){p?d(y,t,{configurable:!0,get:function(){return e},set:function(e){if(s(this),this===y)throw new x("You can't redefine this property");u(this,t)?this[t]=e:c(this,t,e)}}):y[t]=e};u(y,b)||O(b,v),!_&&u(y,m)&&y[m]!==Object||O(m,C),C.prototype=y,r({global:!0,constructor:!0,forced:_},{Iterator:C})},8227:function(t,e,n){var r=n(4576),i=n(5745),o=n(9297),s=n(3392),a=n(4495),h=n(7040),d=r.Symbol,c=i("wks"),l=h?d["for"]||d:d&&d.withoutSetter||s;t.exports=function(t){return o(c,t)||(c[t]=a&&o(d,t)?d[t]:l("Symbol."+t)),c[t]}},8237:function(t,e,n){var r=n(6518),i=n(2652),o=n(9306),s=n(8551),a=n(1767),h=n(9539),d=n(4549),c=n(8745),l=n(9039),u=TypeError,f=l(function(){[].keys().reduce(function(){},void 0)}),y=!f&&d("reduce",u);r({target:"Iterator",proto:!0,real:!0,forced:f||y},{reduce:function(t){s(this);try{o(t)}catch(l){h(this,"throw",l)}var e=arguments.length<2,n=e?void 0:arguments[1];if(y)return c(y,this,e?[t]:[t,n]);var r=a(this),d=0;if(i(r,function(r){e?(e=!1,n=r):n=t(n,r,d),d++},{IS_RECORD:!0}),e)throw new u("Reduce of empty iterator with no initial value");return n}})},8469:function(t,e,n){var r=n(9504),i=n(507),o=n(4402),s=o.Set,a=o.proto,h=r(a.forEach),d=r(a.keys),c=d(new s).next;t.exports=function(t,e,n){return n?i({iterator:d(t),next:c},e):h(t,e)}},8480:function(t,e,n){var r=n(1828),i=n(8727),o=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},8527:function(t,e,n){var r=n(7080),i=n(4402).has,o=n(5170),s=n(3789),a=n(507),h=n(9539);t.exports=function(t){var e=r(this),n=s(t);if(o(e)<n.size)return!1;var d=n.getIterator();return!1!==a(d,function(t){if(!i(e,t))return h(d,"normal",!1)})}},8551:function(t,e,n){var r=n(34),i=String,o=TypeError;t.exports=function(t){if(r(t))return t;throw new o(i(t)+" is not an object")}},8622:function(t,e,n){var r=n(4576),i=n(4901),o=r.WeakMap;t.exports=i(o)&&/native code/.test(String(o))},8686:function(t,e,n){var r=n(3724),i=n(9039);t.exports=r&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},8727:function(t){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},8745:function(t,e,n){var r=n(616),i=Function.prototype,o=i.apply,s=i.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},8750:function(t,e,n){var r=n(7080),i=n(4402),o=n(5170),s=n(3789),a=n(8469),h=n(507),d=i.Set,c=i.add,l=i.has;t.exports=function(t){var e=r(this),n=s(t),i=new d;return o(e)>n.size?h(n.getIterator(),function(t){l(e,t)&&c(i,t)}):a(e,function(t){n.includes(t)&&c(i,t)}),i}},8773:function(t,e){var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);e.f=i?function(t){var e=r(this,t);return!!e&&e.enumerable}:n},8981:function(t,e,n){var r=n(7750),i=Object;t.exports=function(t){return i(r(t))}},9039:function(t){t.exports=function(t){try{return!!t()}catch(e){return!0}}},9286:function(t,e,n){var r=n(4402),i=n(8469),o=r.Set,s=r.add;t.exports=function(t){var e=new o;return i(t,function(t){s(e,t)}),e}},9297:function(t,e,n){var r=n(9504),i=n(8981),o=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return o(i(t),e)}},9306:function(t,e,n){var r=n(4901),i=n(6823),o=TypeError;t.exports=function(t){if(r(t))return t;throw new o(i(t)+" is not a function")}},9433:function(t,e,n){var r=n(4576),i=Object.defineProperty;t.exports=function(t,e){try{i(r,t,{value:e,configurable:!0,writable:!0})}catch(n){r[t]=e}return e}},9462:function(t,e,n){var r=n(9565),i=n(2360),o=n(6699),s=n(6279),a=n(8227),h=n(1181),d=n(5966),c=n(7657).IteratorPrototype,l=n(2529),u=n(9539),f=n(1385),y=a("toStringTag"),p="IteratorHelper",g="WrapForValidIterator",m="normal",v="throw",b=h.set,x=function(t){var e=h.getterFor(t?g:p);return s(i(c),{next:function(){var n=e(this);if(t)return n.nextHandler();if(n.done)return l(void 0,!0);try{var r=n.nextHandler();return n.returnHandlerResult?r:l(r,n.done)}catch(i){throw n.done=!0,i}},return:function(){var n=e(this),i=n.iterator;if(n.done=!0,t){var o=d(i,"return");return o?r(o,i):l(void 0,!0)}if(n.inner)try{u(n.inner.iterator,m)}catch(s){return u(i,v,s)}if(n.openIters)try{f(n.openIters,m)}catch(s){return u(i,v,s)}return i&&u(i,m),l(void 0,!0)}})},w=x(!0),_=x(!1);o(_,y,"Iterator Helper"),t.exports=function(t,e,n){var r=function(r,i){i?(i.iterator=r.iterator,i.next=r.next):i=r,i.type=e?g:p,i.returnHandlerResult=!!n,i.nextHandler=t,i.counter=0,i.done=!1,b(this,i)};return r.prototype=e?w:_,r}},9504:function(t,e,n){var r=n(616),i=Function.prototype,o=i.call,s=r&&i.bind.bind(o,o);t.exports=r?s:function(t){return function(){return o.apply(t,arguments)}}},9519:function(t,e,n){var r,i,o=n(4576),s=n(2839),a=o.process,h=o.Deno,d=a&&a.versions||h&&h.version,c=d&&d.v8;c&&(r=c.split("."),i=r[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&s&&(r=s.match(/Edge\/(\d+)/),(!r||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/),r&&(i=+r[1]))),t.exports=i},9539:function(t,e,n){var r=n(9565),i=n(8551),o=n(5966);t.exports=function(t,e,n){var s,a;i(t);try{if(s=o(t,"return"),!s){if("throw"===e)throw n;return n}s=r(s,t)}catch(h){a=!0,s=h}if("throw"===e)throw n;if(a)throw s;return i(s),n}},9565:function(t,e,n){var r=n(616),i=Function.prototype.call;t.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},9617:function(t,e,n){var r=n(5397),i=n(5610),o=n(6198),s=function(t){return function(e,n,s){var a=r(e),h=o(a);if(0===h)return!t&&-1;var d,c=i(s,h);if(t&&n!==n){while(h>c)if(d=a[c++],d!==d)return!0}else for(;h>c;c++)if((t||c in a)&&a[c]===n)return t||c||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},9835:function(t){t.exports=function(t){try{var e=new Set,n={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return e.clear(),e.add(4),function(){return{done:!0}}}})}},r=e[t](n);return 1!==r.size||4!==r.values().next().value}catch(i){return!1}}}},r={};function i(t){var e=r[t];if(void 0!==e)return e.exports;var o=r[t]={exports:{}};return n[t].call(o.exports,o,o.exports,i),o.exports}!function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.p=""}();var o={};if(i.d(o,{default:function(){return A}}),"undefined"!==typeof window){var s=window.document.currentScript,a=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}var h=function(){var t=this,e=t._self._c;return e("div",["h"==t.mode?e("horizontal",t._g(t._b({ref:"MoonHierarchy"},"horizontal",t.$attrs,!1),t.$listeners),[t._t("default")],2):e("vertical",t._g(t._b({ref:"MoonHierarchy"},"vertical",t.$attrs,!1),t.$listeners),[t._t("default")],2)],1)},d=[],c=function(){var t=this,e=t._self._c;return e("div",{ref:"svg"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showCustomView,expression:"showCustomView"}],ref:"CoustomView",staticClass:"moon-hierarchy-custom-view"},[t._t("default")],2)])},l=[],u=(i(4114),i(8111),i(2489),i(116),i(7588),i(1701),i(8237),i(3579),i(6076));let f=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((t,e)=>(e&=63,t+=e<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_",t),"");const y=(t,e)=>"string"===typeof e?Object.prototype.toString.call(t)==`[object ${e}]`:Array.isArray(e)?e.some(e=>Object.prototype.toString.call(t)==`[object ${e}]`):void 0,p=(t="uuid")=>t+f(),g=(t,e="id",n="pId",r="children",i=!0)=>{if(!y(t,"Array"))return void console.error("数据源必须是数组");let o=i?(0,u.cloneDeep)(t):t.map(t=>(delete t.children,delete t.track,delete t.trigger,t));try{let t=o.reduce((t,i)=>{if(!i.hasOwnProperty(e))throw`${JSON.stringify(i)}树形结构数据不准确,数据项中没有指定的id:${e}`;i[r]=i[r]||[],i.track=i.track||[i[e]],i.trigger=i.trigger||[];let s=o.find(t=>t[e]==i[n]);return s?(s.track=s.track||[s[e]],i.track.push(s.track),s.trigger=s.trigger||[],s.trigger.push(i[e]),s.trigger.push(i.trigger),s[r]=s[r]?[...s[r],i]:[i]):t.push(i),t},[]),i=[],s=o.reduce((t,n)=>(n.trigger=(0,u.flattenDeep)(n.trigger),n.track=(0,u.flattenDeep)(n.track).reverse(),n.level=n.track.length,t[n[e]]=n,n[r].length||i.push(n),t),{});return{treeData:t,leafs:i,objById:s,flatData:o}}catch(s){return console.error(s),{treeData:[],leafs:[],objById:{},flatData:[]}}},m=(t,e)=>{if(!y(t,"Array")||!y(e,"Function"))throw"arrayRemoveItem 参数类型不正确，arr必须是数组，fun必须是函数";{let n=t.filter((t,n)=>!e(t,n));t.splice(0,t.length),n.forEach(e=>{t.push(e)})}};i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698);var v=i(3893);function b(t){return t&&t.length}var x={props:{width:{type:Number,default:1366},height:{type:Number,default:768},treeData:{type:Array,default:()=>[]},treeOptions:{type:Object,default:()=>({})},defaultOpenLevel:{type:Number,default:2},duration:{type:Number,default:400},negativeIds:{type:Array,default:()=>[]},config:{type:Object,default:()=>({})},canExpendFold:{type:[Boolean,Function],default:!0},expendShape:{type:String},foldShape:{type:String}},mounted(){this.currentScale=this.config?.zoom?.defaultScale||1,this.drawSvg(),this.$watch(()=>[this.treeData,this.layout],()=>{b(this.treeData)&&this.drawContainer()},{deep:!0,immediate:!0})},data(){return{svg:null,zoom:null,container:null,hierarchyLayoutData:null,lastClickNode:null,nodesContainer:null,linksContainer:null,currentScale:1,treeDataFactory:{treeData:[],leafs:[],objById:{},flatData:[]},exceptListener:["click","clickFetchChildren","mouseover","mouseout"],showCustomView:!1,InnerChangeTreeData:!1}},computed:{nodeListener(){return this.config?.node?.on||{}},symbolKey(){return this.inner_treeOptions.id},inner_treeOptions(){return{id:"id",pId:"pId",name:"name",...this.treeOptions}},centerPosition(){return{x:this.width/2,y:this.height/2}},linkConifg(){return{fill:"none",...this.config?.link||{},class:"moon-hierarchy-link","marker-end":!1===this.config?.arrow?.show?"none":"url(#moon-hierarchy-arrow)"}},defsNodeConfig(){const t=16;return{loadingSize:t,nodeList:[{name:"marker",attrs:{viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",...this.config.arrow?.attrs||{},id:"moon-hierarchy-arrow",class:"moon-hierarchy-arrow"},children:[{name:"path",attrs:{d:this.config.arrow?.path||"M 0 0 L 10 5 L 0 10 z"}}]},{name:"symbol",attrs:{viewBox:"0 0 1024 1024",width:"16",height:"16",id:"loading"},children:[{name:"path",attrs:{d:"M475.428571 97.52381h73.142858v219.428571h-73.142858z m0 609.523809h73.142858v219.428571h-73.142858zM926.47619 475.428571v73.142858h-219.428571v-73.142858z m-609.523809 0v73.142858H97.52381v-73.142858zM779.215238 193.072762l51.712 51.687619-155.136 155.184762-51.736381-51.736381zM348.208762 624.054857l51.736381 51.736381-155.160381 155.136-51.712-51.687619zM193.097143 244.784762l51.687619-51.712 155.184762 155.136-51.736381 51.736381z m430.982095 431.006476l51.736381-51.736381 155.136 155.160381-51.687619 51.712z"}}]}]}}},methods:{formatToArray(t){return t?Array.isArray(t)?t:[t]:[]},initTreeData(){this.treeDataFactory=g(this.treeData,this.inner_treeOptions.id,this.inner_treeOptions.pId);let t=[];this.treeDataFactory.treeData.length>1&&this.treeDataFactory.treeData.slice(1).forEach(e=>{t.push(e[this.symbolKey],...e.trigger)}),m(this.treeDataFactory.flatData,e=>t.includes(e[this.symbolKey])),t.forEach(t=>{delete this.treeDataFactory.objById[t]}),this.setSign()},createSvg(){this.svg=v.create("svg").attr("class","moon-hierarchy-svg").attr("width",this.width).attr("height",this.height).attr("cursor","move"),this.$emit("graph",this.svg)},createContainDom(){this.container=this.svg.append("g").attr("class","moon-hierarchy-container").attr("font-family","sans-serif").attr("transform",`translate(${this.width/2},${this.height/2}) scale(1)`)},drawSvg(){this.$watch(()=>[this.width,this.height],()=>{this.svg?(this.svg.attr("width",this.width).attr("height",this.height),this.treeData?.length&&this.treeLayout&&this.moveToCenter()):this.createSvg()},{deep:!0,immediate:!0}),this.addDefs(),this.$refs.svg.append(this.svg.node())},drawContainer(){this.InnerChangeTreeData?this.InnerChangeTreeData=!1:(this.container&&this.container.remove(),Object.assign(this.$data,this.$options.data(),{svg:this.svg}),this.createContainDom(),this.initTreeData(),this.defaultExpendLevel(),this.drawView(),this.initZoom(),this.moveToCenter(),this.$emit("draw-done",{svg:this.svg,container:this.container}))},defaultExpendLevel(){this.defaultOpenLevel>0&&this.treeDataFactory.flatData.forEach(t=>{t.level>=this.defaultOpenLevel&&(t._children=t.children,t.children=null)})},setLayoutData(){let t=this.treeDataFactory.treeData[0];if(this.hierarchyLayoutData=this.treeLayout(v.hierarchy(t)),"bf"==this.layout&&t.children){let e=t.children.filter(t=>1==t._sign),n=t.children.filter(t=>-1==t._sign),r=this.treeLayout(v.hierarchy({...t,children:e})),i=this.treeLayout(v.hierarchy({...t,children:n}));this.hierarchyLayoutData.children=[...r?.children||[],...i?.children||[]]}},setNodeClassAttr(t){const e=this.config.node?.attrs||{};t.attr("class",function(t){const n=v.select(this).attr("class")||"",r=n.split(" ");r.push("moon-hierarchy-node"),1==t.data.track.length&&r.push("moon-hierarchy-node-root"),"boolean"==typeof t.data._isexpend&&r.push("moon-hierarchy-node-limit-button"),b(t.data.children)?r.push("moon-hierarchy-node-expend"):m(r,t=>"moon-hierarchy-node-expend"==t),b(t.data.children)||b(t.data._children)||t.data._hasChildren?r.push("moon-hierarchy-node-haschildren"):m(r,t=>"moon-hierarchy-node-haschildren"==t);let i=e.class;return i&&("function"==typeof i&&r.push(i(t)||""),"string"==typeof i)?r.push(i):[...new Set(r)].join(" ")})},setNodeDefaultAttr(t){const e=this.getNodeId,n=this.symbolKey;let r=this.lastClickNode;const i=this.config.node?.attrs||{},o={cursor:"pointer",...i,id:t=>e(t.data[n]),transform:t=>this.onNodeFoldTranslate(r,t)};Object.keys(o).reduce((t,e)=>t.attr(e,o[e]),t),this.setNodeClassAttr(t)},getLastFoldNode(t){let e=t.track.find(t=>this.treeDataFactory.objById[t]._children&&this.treeDataFactory.objById[t]._children.length),n=null;if(!e)return this.hierarchyLayoutData;n=this.treeDataFactory.objById[e];let r=this.treeDataFactory.objById[n[this.inner_treeOptions.pId]];return r._exChildren&&r._exChildren.length&&r._exChildren.find(t=>t[this.symbolKey]==n[this.symbolKey])&&(n=r),this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==n[this.symbolKey])},addNode(t){this.nodesContainer||(this.nodesContainer=this.container.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).attr("class","moon-hierarchy-nodes"));const e=this.nodesContainer.selectAll().data(t).join("g").on("click",(t,e)=>{if(t.stopPropagation(),this.onNodeClick(e),"boolean"==typeof e.data._isexpend)return;const n=this.getNodeId(e.data[this.symbolKey]),r=this.svg.select(`#${n}`);this.nodeListener["click"]?.(t,e,r,this.svg)}).on("mouseover",(t,e)=>{if("boolean"==typeof e.data._isexpend)return;this.onNodeMouseOver(e);const n=this.getNodeId(e.data[this.symbolKey]),r=this.svg.select(`#${n}`);this.nodeListener["mouseover"]?.(t,e,r,this.svg)}).on("mouseout",(t,e)=>{if("boolean"==typeof e.data._isexpend)return;this.onNodeMouseOut(e);const n=this.getNodeId(e.data[this.symbolKey]),r=this.svg.select(`#${n}`);this.nodeListener["mouseout"]?.(t,e,r,this.svg)});this.setNodeDefaultAttr(e),this.addListener(e,this.nodeListener,this.exceptListener),e.transition().duration(this.duration).attr("transform",t=>this.onNodeExpendTranslate(t)),this.iteratorAddNode(e,this.nodeConfig.shaps),this.addShapEexpendFold(e)},updateNodeByData(t){t=this.formatToArray(t);let e=[this.inner_treeOptions.id,this.inner_treeOptions.pId,"children","level","track","trigger"];t.forEach(t=>{let n=this.treeDataFactory.objById[t[this.symbolKey]];if(!n)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t[this.symbolKey]}的节点`;let r=Object.keys(n).reduce((t,r)=>((e.includes(r)||r.startsWith("_"))&&(t[r]=n[r]),t),{});Object.assign(n,t,r),this.InnerChangeTreeData=!0;let i=this.treeData.find(e=>e[this.symbolKey]==t[this.symbolKey]);Object.keys(i).forEach(t=>{i[t]=n[t]})}),this.drawView()},updateNode(t){for(let e=0;e<t.length;e++){let n=t[e];const r=this.getNodeId(n.data[this.symbolKey]),i=this.svg.select(`#${r}`);this.addListener(i,this.nodeListener,this.exceptListener,n),i.on("click",t=>{t.stopPropagation(),this.onNodeClick(n),"boolean"!=typeof n.data._isexpend&&this.nodeListener["click"]?.(t,n,i,this.svg)}).on("mouseover",t=>{"boolean"!=typeof n.data._isexpend&&(this.onNodeMouseOver(n),this.nodeListener["mouseover"]?.(t,n,i,this.svg))}).on("mouseout",t=>{"boolean"!=typeof n.data._isexpend&&(this.onNodeMouseOut(n),this.nodeListener["mouseout"]?.(t,n,i,this.svg))}).transition().duration(this.duration).attr("transform",()=>this.onNodeExpendTranslate(n)),i.selectAll("*").remove(),this.setNodeClassAttr(i),this.iteratorAddNode(i,this.nodeConfig.shaps),this.addShapEexpendFold(i,n)}},removeNode(t,e=!0,n=!1){if(!t)throw`moon-hierarchy组件：请传入目标节点数据中${this.symbolKey}的值`;let r=this.hierarchyLayoutData.data[this.symbolKey];if(t==r)throw"moon-hierarchy组件：根节点不能删除";const i=this.treeDataFactory.objById[t];if(!i)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t}的节点`;if("boolean"==typeof i._isexpend&&!n)throw"moon-hierarchy组件：展开/收起节点不能手动删除！";let o=[...i.trigger,t];for(let a=0;a<o.length;a++){let t=this.treeDataFactory.objById[o[a]];this.svg.select(`#${this.getNodeId(t[this.symbolKey])}`).remove();const e=this.getLinkId(t[this.inner_treeOptions.pId],t[this.symbolKey]);this.svg.select(`#${e}`).remove()}let s=this.treeDataFactory.objById[i[this.inner_treeOptions.pId]];if(s){if(s._exChildren){let e=s._exChildren.findIndex(e=>e[this.symbolKey]==t);e>=0&&s._exChildren.splice(e,1)}const e=e=>{let n=s[e];if(n&&(n.splice(n.findIndex(e=>e[this.symbolKey]==t),1),this.limit>0&&s._exChildren)){let t=s._exChildren.filter(t=>t._sign==i._sign),e=n.filter(t=>t._sign==i._sign&&"boolean"!=typeof t._isexpend);if(e.length<this.limit){let r=t.slice(0,this.limit-e.length),o=n.findIndex(t=>"boolean"==typeof t._isexpend&&t._sign==i._sign);n.splice(o,0,...r),m(s._exChildren,t=>r.find(e=>e[this.symbolKey]==t[this.symbolKey]))}if(t=s._exChildren.filter(t=>t._sign==i._sign),e=n.filter(t=>t._sign==i._sign&&"boolean"!=typeof t._isexpend),e.length+t.length<=this.limit){let t=n.find(t=>"boolean"==typeof t._isexpend&&t._sign==i._sign);t&&this.removeNode(t[this.symbolKey],!1,!0)}}};e("children"),e("_children")}m(this.treeDataFactory.flatData,e=>[...i.trigger,t].includes(e[this.symbolKey])),[...i.trigger,t].forEach(t=>{delete this.treeDataFactory.objById[t]}),s.track.map(e=>{m(this.treeDataFactory.objById[e].trigger,e=>[...i.trigger,t].includes(e))}),this.InnerChangeTreeData=!0,m(this.treeData,e=>[...i.trigger,t].includes(e[this.symbolKey])),e&&this.drawView()},removeNodeById(t){t=this.formatToArray(t),t.forEach(t=>{this.removeNode(t,!1)}),this.drawView()},addShapEexpendFold(t,e){this.expendShape!=this.foldShape?(this.expendShape&&t.select(this.expendShape).on("click.customEvent",(t,n)=>{t.stopPropagation(),this.onNodeExpendOrFold(e||n,!0)}),this.foldShape&&t.select(this.foldShape).on("click.customEvent",(t,n)=>{t.stopPropagation(),this.onNodeExpendOrFold(e||n,!1)})):this.expendShape&&t.select(this.expendShape).on("click.customEvent",(t,n)=>{t.stopPropagation();const r=e?e.data[this.symbolKey]:n.data[this.symbolKey],i=this.treeDataFactory.objById[r];this.onNodeExpendOrFold(e||n,!b(i.children))})},addListener(t,e={},n=[],r){Object.keys(e).forEach(i=>{if(!n.includes(i)){let n=this.svg;t.on(i,function(t,o){r&&(o=r),"boolean"!=typeof o.data._isexpend&&e[i](t,o,this,n)})}})},addOrUpdateNode(){const t=this.hierarchyLayoutData.descendants();let e=[],n=[];for(let r=0;r<t.length;r++){let i=t[r];const o=this.getNodeId(i.data[this.symbolKey]),s=this.svg.select(`#${o}`);s.node()?n.push(i):e.push(i)}this.addNode(e),this.updateNode(n)},async onNodeClick(t){this.lastClickNode=t;const e=this.symbolKey,n=this.treeDataFactory.objById[this.lastClickNode.data[e]];b(n.children)?this.foldShape||this.onNodeExpendOrFold(t,!1):this.expendShape||this.onNodeExpendOrFold(t,!0),"boolean"===typeof n._isexpend&&this.onLimitNodeExpendOrFold&&this.onLimitNodeExpendOrFold(n)},async onNodeExpendOrFold(t,e=!1){const n=this.symbolKey;this.lastClickNode=t;const r=this.treeDataFactory.objById[this.lastClickNode.data[n]];if("boolean"==typeof this.canExpendFold&&!this.canExpendFold)return;if("function"==typeof this.canExpendFold&&!this.canExpendFold(r))return;e?b(r._children)?(r.children=r._children,r._children=void 0):r._hasChildren&&(await this.onClickFetchChildren(r),this.setLimtNode&&this.setLimtNode()):b(r.children)&&(r._children=r.children,r.children=void 0),this.drawView();let i=b(r._children);const o=this.hierarchyLayoutData.find(t=>t.data[n]==this.lastClickNode.data[n]);i&&this.foldLinksAndNodes(this.lastClickNode,o),this.moveToCenter({...this.nodeToCenterXY(o),d:this.duration})},onNodeMouseOver(t){t.links().forEach(t=>{const e=this.getLinkId(t.source.data[this.symbolKey],t.target.data[this.symbolKey]);this.svg.select(`#${e}`).classed("moon-hierarchy-node-hover-link",!0)})},onNodeMouseOut(t){t.links().forEach(t=>{const e=this.getLinkId(t.source.data[this.symbolKey],t.target.data[this.symbolKey]);let n=this.svg.select(`#${e}`);n.classed("moon-hierarchy-node-hover-link",!1)})},addNodeToTargetNode(t,e,n){if(!t)throw`moon-hierarchy组件：请传入目标节点数据中${this.symbolKey}的值`;const r=this.treeDataFactory.objById[t];if(!r)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t}的节点`;if("boolean"==typeof r._isexpend)throw"展开/收起节点不能新增子节点！";let i=this.treeDataFactory.treeData[0];n=t==i[this.symbolKey]?"bf"==this.layout&&[-1,1].includes(n)?n||r._sign:"bt"==this.layout||"rl"==this.layout?-1:1:r._sign;let o=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t);if(this.lastClickNode=o,e=this.formatToArray(e),e.length){r.track.map(t=>{this.treeDataFactory.objById[t].trigger.push(...e.map(t=>t[this.symbolKey]))});let t=e.map(t=>(t._sign=n,t[this.inner_treeOptions.pId]=r[this.symbolKey],t)),i=t.findIndex(t=>t[this.symbolKey]==r[this.symbolKey]);-1!=i&&t.splice(i,1);const s={...r};s.children=[],t.push(s);let{objById:a,flatData:h}=g(t,this.symbolKey,this.inner_treeOptions.pId),d=a[r[this.symbolKey]].children;if(r._exChildren?.length){let t=r.children||r._children,e=t.findIndex(t=>"boolean"==typeof t._isexpend&&t._sign==n),i=t[e];r._exChildren.push(...d),i?._isexpend&&r.children.splice(e,0,...d),i._isexpend||(i._isexpend=!0,t.splice(t.indexOf(i),0,...o.data._exChildren.filter(t=>t._sign==i._sign)))}else r.children?r.children.push(...d):r._children?r._children.push(...d):r.children=d;h.filter(t=>t[this.symbolKey]!=r[this.symbolKey]).forEach(t=>{let e=t[this.symbolKey];this.treeDataFactory.objById[e]=t,this.treeDataFactory.flatData.push(t)})}this.onNodeExpendOrFold(o,!0),this.InnerChangeTreeData=!0,this.treeData.push(...e)},async onClickFetchChildren(t){if(t._hasChildren&&!t._loading)try{this.setLoadingIcon(t);let e=await(this.nodeListener["clickFetchChildren"]?.(t,this.svg.select(`#${this.getNodeId(t[this.symbolKey])}`),this.svg));if(e=this.formatToArray(e),e.length){t.track.map(t=>{this.treeDataFactory.objById[t].trigger.push(...e.map(t=>t[this.symbolKey]))});let n=e.map(e=>(e._sign=t._sign,e[this.inner_treeOptions.pId]||(e[this.inner_treeOptions.pId]=t[this.symbolKey]),e)),r=n.findIndex(e=>e[this.symbolKey]==t[this.symbolKey]);-1!=r&&n.splice(r,1),n.push(t);let{objById:i,flatData:o}=g(n,this.symbolKey,this.inner_treeOptions.pId);t.children=i[t[this.symbolKey]].children,o.filter(e=>e[this.symbolKey]!=t[this.symbolKey]).forEach(t=>{let e=t[this.symbolKey];this.treeDataFactory.objById[e]=t,this.treeDataFactory.flatData.push(t)})}this.setLoadingIcon(t,!1)}catch(e){throw this.setLoadingIcon(t,!1),e}},addOrUpdateLinks(){const t=this.hierarchyLayoutData.links();let e=[],n=[];for(let r=0;r<t.length;r++){let i=t[r];const o=this.getLinkId(i.source.data[this.symbolKey],i.target.data[this.symbolKey]),s=this.svg.select(`#${o}`);s.node()?n.push(i):e.push(i)}this.addLinks(e),this.updateLinks(n)},foldLinksAndNodes(t,e,n){const r=this.getLinkId,i=this.getNodeId,o=this.symbolKey;t.links().forEach(t=>{if("function"==typeof n&&!n(t))return;const s=i(t.target.data[o]),a=this.svg.select(`#${s}`);a.transition().duration(this.duration).attr("transform",()=>this.onNodeFoldTranslate(e,t.target));const h=r(t.source.data[o],t.target.data[o]),d=this.svg.select(`#${h}`);d.transition().duration(this.duration).attr("transform",()=>this.onNodeFoldTranslate(e,t.target)).on("end",()=>{d.attr("d",null)})})},drawView(){this.initLayoutData(),this.addOrUpdateLinks(),this.addOrUpdateNode(),this.updateCustomView()},addDefs(){const t=this.svg.append("defs");this.iteratorAddNode(t,this.defsNodeConfig.nodeList)},iteratorAddNode(t,e){e.forEach(e=>{const n=t.append(e.name);this.setAttrByOpt(n,e.attrs),this.setComposeOpt(n,e.compose),this.addListener(n,e.on),e.children&&this.iteratorAddNode(n,e.children)})},moveToCenter(t){if(!t){let e=this.hierarchyLayoutData;t={...this.nodeToCenterXY(e),d:this.duration}}let{x:e,y:n,d:r}=t;const i=1/this.currentScale;let o=this.centerPosition.x*i-e,s=this.centerPosition.y*i-n,a=v.zoomIdentity.scale(this.currentScale).translate(o,s);a.d=r,this.svg.call(this.zoom.transform,a)},initZoom(){let t=this.config?.zoom?.scaleRange||[.2,2],e=t=>{this.config?.zoom?.callback&&this.config?.zoom?.callback(t);let e=t.transform;this.currentScale=e.k,this.container.transition().duration(e.d).attr("transform",`translate(${Number(e.x)},${e.y}) scale(${e.k})`)};this.zoom=v.zoom().scaleExtent(t).on("zoom",e),this.zoom.zoomEvent=e,this.zoom.scaleRange=t,this.svg.call(this.zoom).on("dblclick.zoom",null)},pauseZoom(){this.zoom.scaleExtent([this.currentScale,this.currentScale])},continueZoom(){this.zoom.scaleExtent(this.zoom.scaleRange)},scale(t){if("number"!==typeof t)throw"缩放参数必须数字";{this.currentScale=this.currentScale*Math.abs(t);let e=this.config?.zoom?.scaleRange||[.2,2];this.currentScale<e[0]&&(this.currentScale=e[0]),this.currentScale>e[1]&&(this.currentScale=e[1]),this.moveToCenter()}},setAttrByOpt(t,e={}){Object.keys(e).map(n=>{t.attr(n,e[n])})},setComposeOpt(t,e={}){Object.keys(e).reduce((t,n)=>(Array.isArray(e[n])?t[n](...e[n]):t[n](e[n]),t),t)},getNodeById(t){return{data:this.treeDataFactory.objById[t],el:this.svg.select(`#${this.getNodeId(t)}`)}},getAllNode(){const t=Object.keys(this.treeDataFactory.objById),e=[];for(let n=0;n<t.length;n++){const r=t[n];let i=this.treeDataFactory.objById[r];"boolean"!=typeof i._isexpend&&e.push({data:i,el:this.svg.select(`#${this.getNodeId(r)}`)})}return e},getNodeId(t){return"node-"+t},getLinkId(t,e){return"link-"+t+"-"+e},setPaddingFormat(t){let e=()=>[0,0,0,0],n=t;return"number"==typeof n&&(e=()=>[n,n,n,n]),Array.isArray(n)&&(2==n.length&&(e=()=>[n[0],n[1],n[0],n[1]]),4==n.length&&(e=()=>n)),"function"==typeof n&&(e=n),e},setShapClass(t,e,n){let r=n[e].attrs.class,i=`moon-hierarchy-${e}`;return"function"==typeof r?`${i} ${r(t)||""}`:"string"==typeof r&&r?`${i} ${r}`:i},calculateTextWidth(t,e,n){const r=document.createElement("canvas"),i=r.getContext("2d");i.font=`${e}px ${n}`;const o=i.measureText(t).width;return o},createOrUpdateForeignObject(t){t={width:100,height:50,transform_begin:"translate(0,0) scale(0)",transform:"translate(0,0) scale(1)",...t},this.foreignObject||(this.foreignObject=this.container.append("foreignObject")),this.showCustomView=!0,Object.keys(t).reduce((e,n)=>"transform"!=n?e.attr(n,t[n]):e,this.foreignObject),t.hasChangeNode&&this.foreignObject.attr("transform",t.transform_begin),this.foreignObject.transition().duration(t.duration||this.config?.customView?.duration||this.duration).attr("transform",t.transform),this.foreignObject.on("click",t=>t.stopPropagation()),this.foreignObject.node().append(this.$refs.CoustomView)},updateCustomView(){if(this.foreignObject&&this.drawCustomViewLastConfig.d){let t=this.drawCustomViewLastConfig.d;const e=this.svg.select(`#${this.getNodeId(t.data[this.symbolKey])}`);if(e.node()){let t=this.drawCustomViewLastConfig.d.data[this.symbolKey],e=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t),{e:n,width:r,height:i,priority:o}=this.drawCustomViewLastConfig;e?this.drawCustomView(n,e,r,i,o):this.hiddenCustomView()}else this.hiddenCustomView()}},hiddenCustomView(){this.showCustomView=!1,this.drawCustomViewLastConfig={},this.foreignObject&&(this.foreignObject.remove(),this.foreignObject=null)},expendAllNode(){this.lastClickNode=this.hierarchyLayoutData,this.treeDataFactory.flatData.forEach(t=>{if(t._children&&(t.children=t._children,t._children=null),"boolean"==typeof t._isexpend&&!1===t._isexpend){t._isexpend=!0;let e=this.treeDataFactory.objById[t[this.inner_treeOptions.pId]],n=e.children||e._children;if(e._exChildren?.length){let r=e._exChildren.filter(e=>e._sign==t._sign);n.splice(n.indexOf(t),0,...r)}}}),this.drawView()},foldAllNode(){let t=[];this.treeDataFactory.flatData.forEach(e=>{let n={};if(this.defaultOpenLevel>0&&(e.level>=this.defaultOpenLevel&&e.children&&(e._children=e.children,e.children=null),e.level==this.defaultOpenLevel)){let t=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==e[this.symbolKey]);n.node=t}if("boolean"==typeof e._isexpend&&e._isexpend){e._isexpend=!1;let t=this.treeDataFactory.objById[e[this.inner_treeOptions.pId]],r=t.children||t._children,i=t._exChildren.filter(t=>t._sign==e._sign).map(t=>t[this.symbolKey]);e.level==this.defaultOpenLevel&&(n.parentNode=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t[this.symbolKey]),n.exChildrenIds=i),m(r,t=>i.includes(t[this.symbolKey]))}n.node&&t.push(n)}),this.drawView(),t.length?t.forEach(({node:t,parentNode:e,exChildrenIds:n})=>{let r=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t.data[this.symbolKey]);this.foldLinksAndNodes(t,r),e&&n&&(r=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==e.data[this.symbolKey]),this.foldLinksAndNodes(e,r,t=>n.includes(t.target.data[this.symbolKey])))}):this.foldLinksAndNodes(this.hierarchyLayoutData,this.hierarchyLayoutData),this.moveToCenter()},expendToNode(t){t.track.forEach((e,n)=>{if(e!=t[this.symbolKey]){let r=this.treeDataFactory.objById[e];if(this.lastClickNode||b(r._children)&&(this.lastClickNode=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==e)),b(r._children)&&(r.children=r._children,r._children=void 0),n<t.track.length-1){let e=t.track[n+1],i=r.children||r._children,o=r?._exChildren?.find(t=>t[this.symbolKey]==e);if(o){let t=i.find(t=>"boolean"==typeof t._isexpend&&t._sign==o._sign);t._isexpend||(t._isexpend=!0,i.splice(i.indexOf(t),0,...r._exChildren.filter(e=>e._sign==t._sign)))}}}}),this.drawView()},moveToNode(t,e=[]){if(!t)throw`moon-hierarchy组件：请传入目标节点数据中${this.symbolKey}的值`;const n=this.treeDataFactory.objById[t];if(!n)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t}的节点`;let r=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==n[this.symbolKey]);if(r||(this.expendToNode(n),r=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==n[this.symbolKey])),this.moveToCenter({...this.nodeToCenterXY(r),d:this.duration}),e=this.formatToArray(e),e.length){let i=this.svg.select(`#${this.getNodeId(t)}`);e.forEach(t=>{const e={preventDefault(){}};if("clickFetchChildren"!=t)return"click"==t?(console.log("click"),void this.nodeListener["click"]?.(e,r,i,this.svg)):"mouseover"==t?(this.onNodeMouseOver(r),void this.nodeListener["mouseover"]?.(e,r,i,this.svg)):"mouseover"==t?(this.onNodeMouseOut(r),void this.nodeListener["mouseout"]?.(e,r,i,this.svg)):void this.nodeListener[t]?.(e,r,r,this.svg);this.onClickFetchChildren(n)})}}}};function w(t){return t&&t.length}var _={inheritAttrs:!1,name:"",mixins:[x],props:{layout:{type:String,default:"lr"},limit:{type:Number,default:3}},components:{},created(){},watch:{},computed:{nodeConfig(){let t=2*(this.config.node?.plus?.attrs?.r||6);"boolean"!=typeof this.config.node?.plus?.show||this.config.node?.plus?.show||(t=0);let e={padding:e=>{let n=[15,15,15,15];return e&&(w(e.children)||w(e._children)||e._hasChildren)&&(1==e._sign&&e.track.length>1&&(n[1]=t+n[1]),-1==e._sign&&(n[3]=t+n[3])),n},nodeWidth:60,nodeHeight:16,separation:1.5,exShaps:[],...this.config.node||{},rect:{attrs:{},show:!0,on:{},...this.config.node?.rect||{}},text:{attrs:{},show:!0,on:{},compose:{},...this.config.node?.text||{}},plus:{attrs:{},show:!0,on:{},...this.config.node?.plus||{}}},n=this.setPaddingFormat(e.padding),r=n();e.padding=n;let i=e.text.attrs["font-size"]||16;e.text.attrs["font-size"]=i;let o=e.text.attrs["font-family"]||null;e.text.attrs["font-family"]=o;let s=e.nodeHeight+r[0]+r[2],a=e.nodeWidth;e.plus.attrs.r=t/2;let h=e.separation,d=this.inner_treeOptions.name;const c={name:"rect",attrs:{...e.rect.attrs,class:t=>this.setShapClass(t,"rect",e),height:s,width:t=>t.data._nodeConfig.nodeWidth}},l={name:"rect",attrs:{stroke:"none",fill:"black","fill-opacity":0,"stroke-width":"0",height:s,width:t=>t.data._nodeConfig.nodeWidth},on:e.rect.on},u={name:"text",attrs:{"font-size":i,transform:t=>{let e=i+4;return`translate(${n(t.data)[3]},${(s-e)/2+i})`},...e.text.attrs,class:t=>this.setShapClass(t,"text",e)},compose:{text(t){return void 0===t.data._isexpend?t.data[d]:!0===t.data._isexpend?"收起":"展开"},...e.text.compose},on:e.text.on},f={name:"g",attrs:{...e.plus.attrs,class:t=>this.setShapClass(t,"plus",e),transform:e=>`translate(${1==e.data._sign?e.data._nodeConfig.nodeWidth-n(e.data)[1]+t:n(e.data)[3]-t},${s/2})`},on:e.plus.on,children:[{name:"circle",attrs:{r:t/2}},{name:"line",attrs:{x1:-t/4,y1:"0",x2:t/4,y2:"0"}},{name:"line",attrs:{x1:"0",y1:-t/4,x2:"0",y2:t/4}}]};return{fontSize:i,padding:n,plusCircleWidth:t,nodeHeight:s,nodeSize:[s,a],separation:h,shaps:[...e.rect.show?[c]:[],...e.text.show?[u]:[],...e.plus.show?[f]:[],...e.rect.show?[l]:[],...e.exShaps]}}},methods:{setSign(){const t=(this.treeDataFactory.treeData[0].children||this.treeDataFactory.treeData[0]._children)?.filter(t=>this.negativeIds.includes(t[this.symbolKey])).map(t=>t[this.symbolKey])||[];this.treeDataFactory.flatData.forEach(e=>{e._sign=1,"rl"==this.layout&&(e._sign=-1),"bf"==this.layout&&(e._sign=(0,u.intersection)(e.track,t).length>0?-1:1)}),this.treeDataFactory.treeData[0]._sign=1,this.setLimtNode()},setLimtNode(){this.limit>0&&this.treeDataFactory.flatData.forEach(t=>{let e=!t.children||"boolean"==typeof t.children?.[t.children.length-1]?._isexpend;if(e)return;let n=[],r=[];const i=(e,i=1)=>{if(e.length>this.limit&&"boolean"!=typeof e[e.length-1]._isexpend){let o=p(),s={[this.symbolKey]:o,[this.inner_treeOptions.name]:"展开",[this.inner_treeOptions.pId]:t[this.symbolKey],track:[...t.track,o],trigger:[],level:t.level+1,_isexpend:!1,_sign:i};t.trigger.push(o),this.treeDataFactory.flatData.push(s),this.treeDataFactory.objById[o]=s,r.push(...e.slice(this.limit)),n.push(...e.slice(0,this.limit)),n.push(s)}else n.push(...e)};let o=t.children.filter(t=>1==t._sign),s=t.children.filter(t=>-1==t._sign);i(o,1),i(s,-1),t.children=n,t._exChildren=r})},initLayoutData(){this.addNodeConfigToData(this.treeDataFactory.treeData),this.addNodeOffset(this.treeDataFactory.treeData),this.setLayoutData()},onLimitNodeExpendOrFold(t){const e=this.symbolKey;let n=[],r=[];this.lastClickNode=this.lastClickNode.parent,t._isexpend=!t._isexpend;let i=this.treeDataFactory.objById[this.lastClickNode.data[e]];t._isexpend?i.children.splice(i.children.indexOf(t),0,...i._exChildren.filter(e=>e._sign==t._sign)):(n=i._exChildren.filter(e=>e._sign==t._sign).map(t=>t[this.symbolKey]),r=this.hierarchyLayoutData.descendants().filter(t=>n.includes(t.data[e])),i.children=i.children.filter(t=>!n.includes(t[this.symbolKey]))),this.drawView();const o=this.hierarchyLayoutData.find(t=>t.data[e]==this.lastClickNode.data[e]);t._isexpend||(r.forEach(t=>{this.foldLinksAndNodes(t,o)}),this.foldLinksAndNodes(this.lastClickNode,o,t=>n.includes(t.target.data[this.symbolKey]))),this.moveToCenter({...this.nodeToCenterXY(o),d:this.duration})},onNodeExpendTranslate(t){return t||(t={x:0,y:0,data:{_nodeConfig:{nodeWidth:0}}}),1==t.data._sign?`translate(${t.y},${t.x}) scale(1)`:-1==t.data._sign?`translate(${-t.y-t.data._nodeConfig.nodeWidth+this.getTranslateOffset(t)},${t.x}) scale(1)`:void 0},onNodeFoldTranslate(t,e){return t?`translate(${(t.y+t.data._nodeConfig.nodeWidth-this.getTranslateOffset(e))*t.data._sign},${t.x+this.nodeConfig.nodeHeight/2}) scale(0)`:`translate(0,${this.nodeConfig.nodeHeight/2}) scale(0)`},addLinks(t){const e=this.getLinkId,n=this.symbolKey;this.linksContainer||(this.linksContainer=this.container.append("g").attr("class","moon-hierarchy-links"));let r=this.linksContainer.selectAll().data(t).join("path");this.setAttrByOpt(r,this.linkConifg),r.attr("id",({source:t,target:r})=>e(t.data[n],r.data[n])),r.attr("d",t=>this.setLinkPath(t)).attr("transform",({target:t})=>this.onNodeFoldTranslate(this.lastClickNode,t)).transition().duration(this.duration).attr("transform",({target:t})=>`translate(${this.getTranslateOffset(t)},0) scale(1)`)},updateLinks(t){for(let e=0;e<t.length;e++){let n=t[e];const r=this.getLinkId(n.source.data[this.symbolKey],n.target.data[this.symbolKey]),i=this.svg.select(`#${r}`);i.transition().duration(this.duration).attr("transform",` translate(${this.getTranslateOffset(n.target)},0)  scale(1)`).attr("d",()=>this.setLinkPath(n))}},setLinkPath({source:t,target:e}){let n=this.nodeConfig.nodeHeight/2,r=e.data._sign*(t.y+t.data._nodeConfig.nodeWidth),i=t.x+n,o=e.data._sign*e.y,s=e.x+n,a=o-r,h=s-i,d=e.data._sign*this.nodeConfig.nodeSize[1];return`M${r},${i}h${a-d/2}v${h}h${d/2}`},nodeToCenterXY(t){let e=0;return e=1==t.data._sign?t.y+t.data._nodeConfig.nodeWidth/2:-t.y-t.data._nodeConfig.nodeWidth/2+this.hierarchyLayoutData.data._nodeConfig.nodeWidth,{x:e,y:t.x+this.nodeConfig.nodeHeight/2}},treeLayout(t){let e=v.tree().separation(()=>this.nodeConfig.separation).nodeSize(this.nodeConfig.nodeSize)(t);function n(t){for(let e=0;e<t.length;e++){let r=t[e];r.y=r.y+r.data.offset,w(r.children)&&n(r.children)}}return n(e.children||[]),e},addNodeConfigToData(t){for(let e=0;e<t.length;e++){let n=t[e];n._nodeConfig={...this.nodeConfig,nodeWidth:this.getNodeWidth(n)},w(n.children)&&this.addNodeConfigToData(n.children)}},addNodeOffset(t){const e=this.findTreeSameLevelData;function n(r,i=0){for(let o=0;o<r.length;o++){let s=r[o];if(s.offset=i,w(s.children)){let r=(0,u.maxBy)(e(t,s),function(t){return t._nodeConfig.nodeWidth});n(s.children,s.offset+r._nodeConfig.nodeWidth)}}}n(t)},findTreeSameLevelData(t,e){let n=[],r=e.level,i=e._sign;function o(t,e,r){for(let s=0;s<t.length;s++){let a=t[s];r!=e||a._sign!=i?w(a.children)&&o(a.children,e,r+1):n.push(a)}}return o(t,r,1),n},getTranslateOffset(t){return-1==t.data._sign&&t.data[this.symbolKey]!=this.hierarchyLayoutData.data[this.symbolKey]?this.hierarchyLayoutData.data._nodeConfig.nodeWidth:0},getNodeWidth(t){let e=this.calculateTextWidth(t[this.inner_treeOptions.name],this.nodeConfig.fontSize,this.nodeConfig.fontFamily),n=this.nodeConfig.padding(t);return e+n[1]+n[3]},setLoadingIcon(t,e=!0){t._loading=e;const n=this.getNodeId(t[this.symbolKey]),r=t=>1==t.data._sign?t.data._nodeConfig.nodeWidth:-this.defsNodeConfig.loadingSize,i=()=>this.nodeConfig.nodeHeight/2-this.defsNodeConfig.loadingSize/2;if(e){const t=v.select(`#${n}`).append("use").attr("class","moon-hierarchy-loading").attr("xlink:href","#loading");t.attr("x",r).attr("y",i).attr("transform-origin",t=>`${r(t)+this.defsNodeConfig.loadingSize/2} ${i(t)+this.defsNodeConfig.loadingSize/2}`)}else this.svg.select(`#${n}`).select("use").remove()},drawCustomView(t,e,n,r,i,o){n=n||this.config?.customView?.width||100,r=r||this.config?.customView?.height||50,i=i||this.config?.customView?.priority||["rb","rt","lb","lt"];const s=this.svg.node().getBoundingClientRect(),a=this.getNodeId(e.data[this.symbolKey]),h=this.svg.select(`#${a}`).node().getBoundingClientRect();let d={rb:s.bottom-h.bottom>=r&&s.right-h.right>=n,rt:h.top-s.top>=r&&s.right-h.right>=n,lb:s.bottom-h.bottom>=r&&h.left-s.left>=n,lt:h.top-s.top>=r&&h.left-s.left>=n},c=i.find(t=>d[t])||"rb",l="",u="",{nodeHeight:f,nodeWidth:y}=e.data._nodeConfig,p=this.getTranslateOffset(e),g={positive:{rt:[e.y+y,e.x],lt:[e.y,e.x],rb:[e.y+y,e.x+f],lb:[e.y,e.x+f]},negative:{rt:[-e.y+p,e.x],rb:[-e.y+p,e.x+f],lt:[-e.y+p-y,e.x],lb:[-e.y+p-y,e.x+f]}},m={positive:{rt:[e.y+y,e.x-r],lt:[e.y-n,e.x-r],rb:[e.y+y,e.x+f],lb:[e.y-n,e.x+f]},negative:{rt:[-e.y+p,e.x-r],rb:[-e.y+p,e.x+f],lt:[-e.y+p-y-n,e.x-r],lb:[-e.y+p-y-n,e.x+f]}};1==e.data._sign&&(u=`translate(${g.positive[c][0]},${g.positive[c][1]}) scale(0)`,l=`translate(${m.positive[c][0]},${m.positive[c][1]}) scale(1)`),-1==e.data._sign&&(u=`translate(${g.negative[c][0]},${g.negative[c][1]}) scale(0)`,l=`translate(${m.negative[c][0]},${m.negative[c][1]}) scale(1)`);let v=e.data[this.symbolKey]!=this.drawCustomViewLastConfig?.d?.data?.[this.symbolKey];this.drawCustomViewLastConfig={e:t,d:e,width:n,height:r,priority:i},this.createOrUpdateForeignObject({width:n,height:r,transform:l,transform_begin:u,hasChangeNode:v,duration:o})}}},C=_;function O(t,e,n,r,i,o,s,a){var h,d="function"===typeof t?t.options:t;if(e&&(d.render=e,d.staticRenderFns=n,d._compiled=!0),r&&(d.functional=!0),o&&(d._scopeId="data-v-"+o),s?(h=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},d._ssrRegister=h):i&&(h=a?function(){i.call(this,(d.functional?this.parent:this).$root.$options.shadowRoot)}:i),h)if(d.functional){d._injectStyles=h;var c=d.render;d.render=function(t,e){return h.call(e),c(t,e)}}else{var l=d.beforeCreate;d.beforeCreate=l?[].concat(l,h):[h]}return{exports:t,options:d}}var D=O(C,c,l,!1,null,"7c8d31f8",null),N=D.exports,S=function(){var t=this,e=t._self._c;return e("div",{ref:"svg"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showCustomView,expression:"showCustomView"}],ref:"CoustomView",staticClass:"moon-hierarchy-custom-view"},[t._t("default")],2)])},k=[];function I(t){return t&&t.length}var $={inheritAttrs:!1,name:"",mixins:[x],props:{layout:{type:String,default:"tb"}},components:{},created(){},watch:{},computed:{nodeConfig(){let t={padding:10,nodeWidth:168,nodeHeight:68,lineHeight:10,separation:1.5,exShaps:[],...this.config?.node||{},rect:{attrs:{},show:!0,on:{},...this.config.node?.rect||{}},text:{attrs:{},show:!0,on:{},...this.config.node?.text||{}},plus:{attrs:{},show:!0,on:{},...this.config.node?.plus||{}}};t.padding=this.setPaddingFormat(t.padding);let e=t.nodeWidth,n=t.nodeHeight,r=0;t.plus.show&&(r=2*(t.plus.attrs?.r||10),t.plus.attrs.r=r/2);let i=t.text.attrs["font-size"]||16;t.text.attrs["font-size"]=i;let o=t.text.attrs["font-family"]||null;t.text.attrs["font-family"]=o;let s=t.text.attrs["line-height"]||10;t.text.attrs["line-height"]=s;let a=t.separation;const h={name:"rect",attrs:{...t.rect.attrs,class:e=>this.setShapClass(e,"rect",t),height:n,width:t=>t.data._nodeConfig.nodeWidth}},d={name:"rect",attrs:{stroke:"none",fill:"black","fill-opacity":0,"stroke-width":"0",height:n,width:t=>t.data._nodeConfig.nodeWidth},on:t.rect.on},c={name:"g",attrs:{transform:t=>`translate(${e/2},${n/2-(t.data._name[1]?(i+s)/2:0)})`},on:t.text.on,children:[{name:"text",attrs:{...t.text.attrs,class:e=>this.setShapClass(e,"text",t),"font-size":i,"text-anchor":"middle","dominant-baseline":"middle"},children:[{name:"tspan",attrs:{},compose:{text(t){return t.data._name[0]}}},{name:"tspan",attrs:{x:0,dy:i+s},compose:{text(t){return t.data._name[1]}}}]}]},l={name:"g",attrs:{...t.plus.attrs,class:e=>this.setShapClass(e,"plus",t),transform:t=>`translate(${t.data._nodeConfig.nodeWidth/2},${(1==t.data._sign?n:0)+t.data._sign*r/2})`},on:t.plus.on,children:[{name:"circle",attrs:{r:r/2}},{name:"line",attrs:{x1:-r/4,y1:"0",x2:r/4,y2:"0"}},{name:"line",attrs:{x1:"0",y1:-r/4,x2:"0",y2:r/4}}]};return{fontSize:i,padding:t.padding,nodeHeight:n,nodeWidth:e,nodeSize:[e,2*n],separation:a,plusCircleWidth:r,shaps:[...t.rect.show?[h]:[],...t.text.show?[c]:[],...t.plus.show?[l]:[],...t.rect.show?[d]:[],...t.exShaps]}}},methods:{setSign(){const t=(this.treeDataFactory.treeData[0].children||this.treeDataFactory.treeData[0]._children)?.filter(t=>this.negativeIds.includes(t[this.symbolKey])).map(t=>t[this.symbolKey])||[];this.treeDataFactory.flatData.forEach(e=>{e._sign=1,"bt"==this.layout&&(e._sign=-1),"bf"==this.layout&&(e._sign=(0,u.intersection)(e.track,t).length>0?-1:1)}),this.treeDataFactory.treeData[0]._sign=1},initLayoutData(){this.addNodeConfigToData(this.treeDataFactory.treeData),this.setLayoutData()},onNodeExpendTranslate(t){return t||(t={x:0,y:0,data:{_nodeConfig:{nodeWidth:0}}}),1==t.data._sign?`translate(${t.x-t.data._nodeConfig.nodeWidth/2},${t.y}) scale(1)`:-1==t.data._sign?`translate(${t.x-t.data._nodeConfig.nodeWidth/2},${-t.y}) scale(1)`:void 0},onNodeFoldTranslate(t,e){return t?-1==e.data._sign?`translate(${t.x},${t.y*t.data._sign}) scale(0)`:`translate(${t.x},${t.y+this.nodeConfig.nodeHeight}) scale(0)`:(e.data._sign,`translate(0,${this.nodeConfig.nodeHeight}) scale(0)`)},addLinks(t){const e=this.getLinkId,n=this.symbolKey;this.linksContainer||(this.linksContainer=this.container.append("g").attr("class","moon-hierarchy-links"));let r=this.linksContainer.selectAll().data(t).join("path");this.setAttrByOpt(r,this.linkConifg),r.attr("id",({source:t,target:r})=>e(t.data[n],r.data[n])),r.attr("d",t=>this.setLinkPath(t)).attr("transform",({target:t})=>this.onNodeFoldTranslate(this.lastClickNode,t)).transition().duration(this.duration).attr("transform",({target:t})=>`translate(0,${this.getTranslateOffset(t)}) scale(1)`)},updateLinks(t){for(let e=0;e<t.length;e++){let n=t[e];const r=this.getLinkId(n.source.data[this.symbolKey],n.target.data[this.symbolKey]),i=this.svg.select(`#${r}`);i.transition().duration(this.duration).attr("transform",` translate(0,${this.getTranslateOffset(n.target)} )  scale(1)`).attr("d",()=>this.setLinkPath(n))}},setLinkPath({source:t,target:e}){let n=t.x,r=e.data._sign*(t.y+this.nodeConfig.nodeHeight),i=e.x,o=e.data._sign*e.y,s=i-n,a=o-r;return`M${n},${r}v${a/2}h${s}v${a/2}`},nodeToCenterXY(t){return{x:t.x+t.data._nodeConfig.nodeWidth/2,y:t.data._sign*t.y+this.nodeConfig.nodeHeight/2}},treeLayout(t){return v.tree().separation(()=>this.nodeConfig.separation).nodeSize(this.nodeConfig.nodeSize)(t)},addNodeConfigToData(t){for(let e=0;e<t.length;e++){let n=t[e];n._nodeConfig={...this.nodeConfig},n["_"+this.inner_treeOptions.name]=this.getFormatTextArr(n),I(n.children)&&this.addNodeConfigToData(n.children)}},getTranslateOffset(t){return-1==t.data._sign&&t.data[this.symbolKey]!=this.hierarchyLayoutData.data[this.symbolKey]?this.nodeConfig.nodeHeight:0},setLoadingIcon(t,e=!0){const n=this.getNodeId(t[this.symbolKey]),r=t=>t.data._nodeConfig.nodeWidth/2-this.defsNodeConfig.loadingSize/2,i=t=>1==t.data._sign?this.nodeConfig.nodeHeight+this.nodeConfig.plusCircleWidth:-this.defsNodeConfig.loadingSize-this.nodeConfig.plusCircleWidth;if(e){t._loading=e;const o=v.select(`#${n}`).append("use").attr("class","moon-hierarchy-loading").attr("xlink:href","#loading");o.attr("x",r).attr("y",i).attr("transform-origin",t=>`${r(t)+this.defsNodeConfig.loadingSize/2} ${i(t)+this.defsNodeConfig.loadingSize/2}`)}else delete t._loading,this.svg.select(`#${n}`).select("use").remove()},getFormatTextArr(t,e=2,n="…"){const r=t[this.inner_treeOptions.name],i=this.nodeConfig.padding(t),o=this.nodeConfig.nodeWidth-i[1]-i[3];let s=[];const a=this.calculateTextWidth;function h(t,e,n,r,i=[]){for(let o=t.length;o>=0;o--){const s=t.slice(0,o),d=a(s,n,r);if(e>=d){i.push(s);let a=t.slice(o);a&&h(a,e,n,r,i);break}}}if(h(r,o,this.nodeConfig.fontSize,this.nodeConfig.fontFamily,s),e&&s.length>e){s=s.slice(0,e);const t=s[e-1];for(let r=t.length;r>=0;r--){const i=t.slice(0,r)+n,h=a(i,this.nodeConfig.fontSize,this.nodeConfig.fontFamily);if(o>=h){s[e-1]=i;break}}}if(s.length<e)for(let d=s.length+1;d<=e;d++)s.push("");return s},drawCustomView(t,e,n,r,i,o){n=n||this.config?.customView?.width||100,r=r||this.config?.customView?.height||50,i=i||this.config?.customView?.priority||["rb","rt","lb","lt"];const s=this.svg.node().getBoundingClientRect(),a=this.getNodeId(e.data[this.symbolKey]),h=this.svg.select(`#${a}`).node().getBoundingClientRect();let d={rb:s.bottom-h.bottom>=r&&s.right-h.right>=n,rt:h.top-s.top>=r&&s.right-h.right>=n,lb:s.bottom-h.bottom>=r&&h.left-s.left>=n,lt:h.top-s.top>=r&&h.left-s.left>=n},c=i.find(t=>d[t])||"rb",l="",u="",{nodeHeight:f,nodeWidth:y}=e.data._nodeConfig,p={positive:{rt:[e.x+y/2,e.y],lt:[e.x-y/2,e.y],rb:[e.x+y/2,e.y+f],lb:[e.x-y/2,e.y+f]},negative:{rt:[e.x+y/2,-e.y],rb:[e.x+y/2,-e.y+f],lt:[e.x-y/2,-e.y],lb:[e.x-y/2,-e.y+f]}},g={positive:{rt:[e.x+y/2,e.y-r],lt:[e.x-y/2-n,e.y-r],rb:[e.x+y/2,e.y+f],lb:[e.x-y/2-n,e.y+f]},negative:{rt:[e.x+y/2,-e.y-r],rb:[e.x+y/2,-e.y+f],lt:[e.x-y/2-n,-e.y-r],lb:[e.x-y/2-n,-e.y+f]}};1==e.data._sign&&(u=`translate(${p.positive[c][0]},${p.positive[c][1]}) scale(0)`,l=`translate(${g.positive[c][0]},${g.positive[c][1]}) scale(1)`),-1==e.data._sign&&(u=`translate(${p.negative[c][0]},${p.negative[c][1]}) scale(0)`,l=`translate(${g.negative[c][0]},${g.negative[c][1]}) scale(1)`);let m=e.data[this.symbolKey]!=this.drawCustomViewLastConfig?.d?.data?.[this.symbolKey];this.drawCustomViewLastConfig={e:t,d:e,width:n,height:r,priority:i},this.createOrUpdateForeignObject({width:n,height:r,transform:l,transform_begin:u,hasChangeNode:m,duration:o})}}},L=$,j=O(L,S,k,!1,null,"4cbf108c",null),T=j.exports,F={inheritAttrs:!1,name:"MoonHierarchy",props:{mode:{type:String,default:"h"}},components:{horizontal:N,vertical:T},created(){},mounted(){},data(){return{show:!1}},watch:{},computed:{},methods:{getNodeById(t){return this.$refs.MoonHierarchy.getNodeById(t)},getAllNode(){return this.$refs.MoonHierarchy.getAllNode()},moveToCenter(){this.$refs.MoonHierarchy.moveToCenter(null)},zoom(t){this.$refs.MoonHierarchy.scale(t)},addNode(t,e,n){this.$refs.MoonHierarchy.addNodeToTargetNode(t,e,n)},removeNodeById(t){this.$refs.MoonHierarchy.removeNodeById(t)},pauseZoom(){this.$refs.MoonHierarchy.pauseZoom()},continueZoom(){this.$refs.MoonHierarchy.continueZoom()},showCustomView(t,e,n,r,i){this.$refs.MoonHierarchy.drawCustomView(t,e,n,r,i)},hiddenCustomView(){this.$refs.MoonHierarchy.hiddenCustomView()},updateNodeByData(t){this.$refs.MoonHierarchy.updateNodeByData(t)},moveToNode(t,e){this.$refs.MoonHierarchy.moveToNode(t,e)},expendAllNode(){this.$refs.MoonHierarchy.expendAllNode()},foldAllNode(){this.$refs.MoonHierarchy.foldAllNode()}}},E=F,K=O(E,h,d,!1,null,"b75f8d7e",null),z=K.exports,A=z;return o=o["default"],o}()});
//# sourceMappingURL=moon-hierarchy.umd.min.js.map