(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e(require("lodash"),require("d3")):"function"===typeof define&&define.amd?define(["lodash","d3"],e):"object"===typeof exports?exports["moon-hierarchy"]=e(require("lodash"),require("d3")):t["moon-hierarchy"]=e(t["lodash"],t["d3"])})("undefined"!==typeof self?self:this,(function(t,e){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fb15")}({"04f8":function(t,e,i){"use strict";var n=i("2d00"),o=i("d039"),r=i("da84"),s=r.String;t.exports=!!Object.getOwnPropertySymbols&&!o((function(){var t=Symbol("symbol detection");return!s(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},"06cf":function(t,e,i){"use strict";var n=i("83ab"),o=i("c65b"),r=i("d1e7"),s=i("5c6c"),a=i("fc6a"),d=i("a04b"),h=i("1a2d"),l=i("0cfb"),c=Object.getOwnPropertyDescriptor;e.f=n?c:function(t,e){if(t=a(t),e=d(e),l)try{return c(t,e)}catch(i){}if(h(t,e))return s(!o(r.f,t,e),t[e])}},"07fa":function(t,e,i){"use strict";var n=i("50c4");t.exports=function(t){return n(t.length)}},"0cfb":function(t,e,i){"use strict";var n=i("83ab"),o=i("d039"),r=i("cc12");t.exports=!n&&!o((function(){return 7!==Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},"0d51":function(t,e,i){"use strict";var n=String;t.exports=function(t){try{return n(t)}catch(e){return"Object"}}},"13d2":function(t,e,i){"use strict";var n=i("e330"),o=i("d039"),r=i("1626"),s=i("1a2d"),a=i("83ab"),d=i("5e77").CONFIGURABLE,h=i("8925"),l=i("69f3"),c=l.enforce,u=l.get,f=String,y=Object.defineProperty,p=n("".slice),g=n("".replace),v=n([].join),m=a&&!o((function(){return 8!==y((function(){}),"length",{value:8}).length})),b=String(String).split("String"),x=t.exports=function(t,e,i){"Symbol("===p(f(e),0,7)&&(e="["+g(f(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!s(t,"name")||d&&t.name!==e)&&(a?y(t,"name",{value:e,configurable:!0}):t.name=e),m&&i&&s(i,"arity")&&t.length!==i.arity&&y(t,"length",{value:i.arity});try{i&&s(i,"constructor")&&i.constructor?a&&y(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(o){}var n=c(t);return s(n,"source")||(n.source=v(b,"string"==typeof e?e:"")),t};Function.prototype.toString=x((function(){return r(this)&&u(this).source||h(this)}),"toString")},"13d5":function(t,e,i){"use strict";var n=i("23e7"),o=i("d58f").left,r=i("a640"),s=i("2d00"),a=i("605d"),d=!a&&s>79&&s<83,h=d||!r("reduce");n({target:"Array",proto:!0,forced:h},{reduce:function(t){var e=arguments.length;return o(this,t,e,e>1?arguments[1]:void 0)}})},"14d9":function(t,e,i){"use strict";var n=i("23e7"),o=i("7b0b"),r=i("07fa"),s=i("3a34"),a=i("3511"),d=i("d039"),h=d((function(){return 4294967297!==[].push.call({length:4294967296},1)})),l=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},c=h||!l();n({target:"Array",proto:!0,arity:1,forced:c},{push:function(t){var e=o(this),i=r(e),n=arguments.length;a(i+n);for(var d=0;d<n;d++)e[i]=arguments[d],i++;return s(e,i),i}})},1626:function(t,e,i){"use strict";var n="object"==typeof document&&document.all;t.exports="undefined"==typeof n&&void 0!==n?function(t){return"function"==typeof t||t===n}:function(t){return"function"==typeof t}},"1a2d":function(t,e,i){"use strict";var n=i("e330"),o=i("7b0b"),r=n({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return r(o(t),e)}},"1d80":function(t,e,i){"use strict";var n=i("7234"),o=TypeError;t.exports=function(t){if(n(t))throw new o("Can't call method on "+t);return t}},"1e5a":function(t,e,i){"use strict";var n=i("23e7"),o=i("9961"),r=i("dad2");n({target:"Set",proto:!0,real:!0,forced:!r("symmetricDifference")},{symmetricDifference:o})},"1e70":function(t,e,i){"use strict";var n=i("23e7"),o=i("a5f7"),r=i("dad2");n({target:"Set",proto:!0,real:!0,forced:!r("difference")},{difference:o})},"22e5":function(t,e,i){"use strict";i("8b00")},"23cb":function(t,e,i){"use strict";var n=i("5926"),o=Math.max,r=Math.min;t.exports=function(t,e){var i=n(t);return i<0?o(i+e,0):r(i,e)}},"23e7":function(t,e,i){"use strict";var n=i("da84"),o=i("06cf").f,r=i("9112"),s=i("cb2d"),a=i("6374"),d=i("e893"),h=i("94ca");t.exports=function(t,e){var i,l,c,u,f,y,p=t.target,g=t.global,v=t.stat;if(l=g?n:v?n[p]||a(p,{}):n[p]&&n[p].prototype,l)for(c in e){if(f=e[c],t.dontCallGetSet?(y=o(l,c),u=y&&y.value):u=l[c],i=h(g?c:p+(v?".":"#")+c,t.forced),!i&&void 0!==u){if(typeof f==typeof u)continue;d(f,u)}(t.sham||u&&u.sham)&&r(f,"sham",!0),s(l,c,f,t)}}},"241c":function(t,e,i){"use strict";var n=i("ca84"),o=i("7839"),r=o.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,r)}},"2a62":function(t,e,i){"use strict";var n=i("c65b"),o=i("825a"),r=i("dc4a");t.exports=function(t,e,i){var s,a;o(t);try{if(s=r(t,"return"),!s){if("throw"===e)throw i;return i}s=n(s,t)}catch(d){a=!0,s=d}if("throw"===e)throw i;if(a)throw s;return o(s),i}},"2d00":function(t,e,i){"use strict";var n,o,r=i("da84"),s=i("342f"),a=r.process,d=r.Deno,h=a&&a.versions||d&&d.version,l=h&&h.v8;l&&(n=l.split("."),o=n[0]>0&&n[0]<4?1:+(n[0]+n[1])),!o&&s&&(n=s.match(/Edge\/(\d+)/),(!n||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/),n&&(o=+n[1]))),t.exports=o},"342f":function(t,e,i){"use strict";t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},3511:function(t,e,i){"use strict";var n=TypeError,o=9007199254740991;t.exports=function(t){if(t>o)throw n("Maximum allowed index exceeded");return t}},"384f":function(t,e,i){"use strict";var n=i("e330"),o=i("5388"),r=i("cb27"),s=r.Set,a=r.proto,d=n(a.forEach),h=n(a.keys),l=h(new s).next;t.exports=function(t,e,i){return i?o({iterator:h(t),next:l},e):d(t,e)}},"395e":function(t,e,i){"use strict";var n=i("dc19"),o=i("cb27").has,r=i("8e16"),s=i("7f65"),a=i("5388"),d=i("2a62");t.exports=function(t){var e=n(this),i=s(t);if(r(e)<i.size)return!1;var h=i.getIterator();return!1!==a(h,(function(t){if(!o(e,t))return d(h,"normal",!1)}))}},"3a34":function(t,e,i){"use strict";var n=i("83ab"),o=i("e8b5"),r=TypeError,s=Object.getOwnPropertyDescriptor,a=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=a?function(t,e){if(o(t)&&!s(t,"length").writable)throw new r("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},"3a9b":function(t,e,i){"use strict";var n=i("e330");t.exports=n({}.isPrototypeOf)},"40d5":function(t,e,i){"use strict";var n=i("d039");t.exports=!n((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},"44ad":function(t,e,i){"use strict";var n=i("e330"),o=i("d039"),r=i("c6b6"),s=Object,a=n("".split);t.exports=o((function(){return!s("z").propertyIsEnumerable(0)}))?function(t){return"String"===r(t)?a(t,""):s(t)}:s},"46c4":function(t,e,i){"use strict";t.exports=function(t){return{iterator:t,next:t.next,done:!1}}},"485a":function(t,e,i){"use strict";var n=i("c65b"),o=i("1626"),r=i("861d"),s=TypeError;t.exports=function(t,e){var i,a;if("string"===e&&o(i=t.toString)&&!r(a=n(i,t)))return a;if(o(i=t.valueOf)&&!r(a=n(i,t)))return a;if("string"!==e&&o(i=t.toString)&&!r(a=n(i,t)))return a;throw new s("Can't convert object to primitive value")}},"4d64":function(t,e,i){"use strict";var n=i("fc6a"),o=i("23cb"),r=i("07fa"),s=function(t){return function(e,i,s){var a=n(e),d=r(a);if(0===d)return!t&&-1;var h,l=o(s,d);if(t&&i!==i){while(d>l)if(h=a[l++],h!==h)return!0}else for(;d>l;l++)if((t||l in a)&&a[l]===i)return t||l||0;return!t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}},"50c4":function(t,e,i){"use strict";var n=i("5926"),o=Math.min;t.exports=function(t){var e=n(t);return e>0?o(e,9007199254740991):0}},5388:function(t,e,i){"use strict";var n=i("c65b");t.exports=function(t,e,i){var o,r,s=i?t:t.iterator,a=t.next;while(!(o=n(a,s)).done)if(r=e(o.value),void 0!==r)return r}},5692:function(t,e,i){"use strict";var n=i("c6cd");t.exports=function(t,e){return n[t]||(n[t]=e||{})}},"56ef":function(t,e,i){"use strict";var n=i("d066"),o=i("e330"),r=i("241c"),s=i("7418"),a=i("825a"),d=o([].concat);t.exports=n("Reflect","ownKeys")||function(t){var e=r.f(a(t)),i=s.f;return i?d(e,i(t)):e}},5926:function(t,e,i){"use strict";var n=i("b42e");t.exports=function(t){var e=+t;return e!==e||0===e?0:n(e)}},"59ed":function(t,e,i){"use strict";var n=i("1626"),o=i("0d51"),r=TypeError;t.exports=function(t){if(n(t))return t;throw new r(o(t)+" is not a function")}},"5c6c":function(t,e,i){"use strict";t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},"5e77":function(t,e,i){"use strict";var n=i("83ab"),o=i("1a2d"),r=Function.prototype,s=n&&Object.getOwnPropertyDescriptor,a=o(r,"name"),d=a&&"something"===function(){}.name,h=a&&(!n||n&&s(r,"name").configurable);t.exports={EXISTS:a,PROPER:d,CONFIGURABLE:h}},"605d":function(t,e,i){"use strict";var n=i("da84"),o=i("c6b6");t.exports="process"===o(n.process)},"60bb":function(e,i){e.exports=t},6374:function(t,e,i){"use strict";var n=i("da84"),o=Object.defineProperty;t.exports=function(t,e){try{o(n,t,{value:e,configurable:!0,writable:!0})}catch(i){n[t]=e}return e}},"68df":function(t,e,i){"use strict";var n=i("dc19"),o=i("8e16"),r=i("384f"),s=i("7f65");t.exports=function(t){var e=n(this),i=s(t);return!(o(e)>i.size)&&!1!==r(e,(function(t){if(!i.includes(t))return!1}),!0)}},"69f3":function(t,e,i){"use strict";var n,o,r,s=i("cdce"),a=i("da84"),d=i("861d"),h=i("9112"),l=i("1a2d"),c=i("c6cd"),u=i("f772"),f=i("d012"),y="Object already initialized",p=a.TypeError,g=a.WeakMap,v=function(t){return r(t)?o(t):n(t,{})},m=function(t){return function(e){var i;if(!d(e)||(i=o(e)).type!==t)throw new p("Incompatible receiver, "+t+" required");return i}};if(s||c.state){var b=c.state||(c.state=new g);b.get=b.get,b.has=b.has,b.set=b.set,n=function(t,e){if(b.has(t))throw new p(y);return e.facade=t,b.set(t,e),e},o=function(t){return b.get(t)||{}},r=function(t){return b.has(t)}}else{var x=u("state");f[x]=!0,n=function(t,e){if(l(t,x))throw new p(y);return e.facade=t,h(t,x,e),e},o=function(t){return l(t,x)?t[x]:{}},r=function(t){return l(t,x)}}t.exports={set:n,get:o,has:r,enforce:v,getterFor:m}},"70cc":function(t,e,i){"use strict";i("79a4")},7234:function(t,e,i){"use strict";t.exports=function(t){return null===t||void 0===t}},7282:function(t,e,i){"use strict";var n=i("e330"),o=i("59ed");t.exports=function(t,e,i){try{return n(o(Object.getOwnPropertyDescriptor(t,e)[i]))}catch(r){}}},"72c3":function(t,e,i){"use strict";var n=i("23e7"),o=i("e9bc"),r=i("dad2");n({target:"Set",proto:!0,real:!0,forced:!r("union")},{union:o})},7418:function(t,e,i){"use strict";e.f=Object.getOwnPropertySymbols},7839:function(t,e,i){"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"79a4":function(t,e,i){"use strict";var n=i("23e7"),o=i("d039"),r=i("953b"),s=i("dad2"),a=!s("intersection")||o((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));n({target:"Set",proto:!0,real:!0,forced:a},{intersection:r})},"7b0b":function(t,e,i){"use strict";var n=i("1d80"),o=Object;t.exports=function(t){return o(n(t))}},"7f65":function(t,e,i){"use strict";var n=i("59ed"),o=i("825a"),r=i("c65b"),s=i("5926"),a=i("46c4"),d="Invalid size",h=RangeError,l=TypeError,c=Math.max,u=function(t,e){this.set=t,this.size=c(e,0),this.has=n(t.has),this.keys=n(t.keys)};u.prototype={getIterator:function(){return a(o(r(this.keys,this.set)))},includes:function(t){return r(this.has,this.set,t)}},t.exports=function(t){o(t);var e=+t.size;if(e!==e)throw new l(d);var i=s(e);if(i<0)throw new h(d);return new u(t,i)}},"825a":function(t,e,i){"use strict";var n=i("861d"),o=String,r=TypeError;t.exports=function(t){if(n(t))return t;throw new r(o(t)+" is not an object")}},8306:function(t,e,i){"use strict";i("72c3")},"83ab":function(t,e,i){"use strict";var n=i("d039");t.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"83b9":function(t,e,i){"use strict";var n=i("cb27"),o=i("384f"),r=n.Set,s=n.add;t.exports=function(t){var e=new r;return o(t,(function(t){s(e,t)})),e}},"861d":function(t,e,i){"use strict";var n=i("1626");t.exports=function(t){return"object"==typeof t?null!==t:n(t)}},8815:function(t,e,i){},"88e6":function(t,e,i){"use strict";i("1e70")},8925:function(t,e,i){"use strict";var n=i("e330"),o=i("1626"),r=i("c6cd"),s=n(Function.toString);o(r.inspectSource)||(r.inspectSource=function(t){return s(t)}),t.exports=r.inspectSource},"8b00":function(t,e,i){"use strict";var n=i("23e7"),o=i("68df"),r=i("dad2");n({target:"Set",proto:!0,real:!0,forced:!r("isSubsetOf")},{isSubsetOf:o})},"8e16":function(t,e,i){"use strict";var n=i("7282"),o=i("cb27");t.exports=n(o.proto,"size","get")||function(t){return t.size}},"90e3":function(t,e,i){"use strict";var n=i("e330"),o=0,r=Math.random(),s=n(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+s(++o+r,36)}},9112:function(t,e,i){"use strict";var n=i("83ab"),o=i("9bf2"),r=i("5c6c");t.exports=n?function(t,e,i){return o.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},"94ca":function(t,e,i){"use strict";var n=i("d039"),o=i("1626"),r=/#|\.prototype\./,s=function(t,e){var i=d[a(t)];return i===l||i!==h&&(o(e)?n(e):!!e)},a=s.normalize=function(t){return String(t).replace(r,".").toLowerCase()},d=s.data={},h=s.NATIVE="N",l=s.POLYFILL="P";t.exports=s},"953b":function(t,e,i){"use strict";var n=i("dc19"),o=i("cb27"),r=i("8e16"),s=i("7f65"),a=i("384f"),d=i("5388"),h=o.Set,l=o.add,c=o.has;t.exports=function(t){var e=n(this),i=s(t),o=new h;return r(e)>i.size?d(i.getIterator(),(function(t){c(e,t)&&l(o,t)})):a(e,(function(t){i.includes(t)&&l(o,t)})),o}},9961:function(t,e,i){"use strict";var n=i("dc19"),o=i("cb27"),r=i("83b9"),s=i("7f65"),a=i("5388"),d=o.add,h=o.has,l=o.remove;t.exports=function(t){var e=n(this),i=s(t).getIterator(),o=r(e);return a(i,(function(t){h(e,t)?l(o,t):d(o,t)})),o}},"9bf2":function(t,e,i){"use strict";var n=i("83ab"),o=i("0cfb"),r=i("aed9"),s=i("825a"),a=i("a04b"),d=TypeError,h=Object.defineProperty,l=Object.getOwnPropertyDescriptor,c="enumerable",u="configurable",f="writable";e.f=n?r?function(t,e,i){if(s(t),e=a(e),s(i),"function"===typeof t&&"prototype"===e&&"value"in i&&f in i&&!i[f]){var n=l(t,e);n&&n[f]&&(t[e]=i.value,i={configurable:u in i?i[u]:n[u],enumerable:c in i?i[c]:n[c],writable:!1})}return h(t,e,i)}:h:function(t,e,i){if(s(t),e=a(e),s(i),o)try{return h(t,e,i)}catch(n){}if("get"in i||"set"in i)throw new d("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},a04b:function(t,e,i){"use strict";var n=i("c04e"),o=i("d9b5");t.exports=function(t){var e=n(t,"string");return o(e)?e:e+""}},a4e7:function(t,e,i){"use strict";var n=i("23e7"),o=i("395e"),r=i("dad2");n({target:"Set",proto:!0,real:!0,forced:!r("isSupersetOf")},{isSupersetOf:o})},a5f7:function(t,e,i){"use strict";var n=i("dc19"),o=i("cb27"),r=i("83b9"),s=i("8e16"),a=i("7f65"),d=i("384f"),h=i("5388"),l=o.has,c=o.remove;t.exports=function(t){var e=n(this),i=a(t),o=r(e);return s(e)<=i.size?d(e,(function(t){i.includes(t)&&c(o,t)})):h(i.getIterator(),(function(t){l(e,t)&&c(o,t)})),o}},a640:function(t,e,i){"use strict";var n=i("d039");t.exports=function(t,e){var i=[][t];return!!i&&n((function(){i.call(null,e||function(){return 1},1)}))}},aed9:function(t,e,i){"use strict";var n=i("83ab"),o=i("d039");t.exports=n&&o((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},b42e:function(t,e,i){"use strict";var n=Math.ceil,o=Math.floor;t.exports=Math.trunc||function(t){var e=+t;return(e>0?o:n)(e)}},b4bc:function(t,e,i){"use strict";var n=i("dc19"),o=i("cb27").has,r=i("8e16"),s=i("7f65"),a=i("384f"),d=i("5388"),h=i("2a62");t.exports=function(t){var e=n(this),i=s(t);if(r(e)<=i.size)return!1!==a(e,(function(t){if(i.includes(t))return!1}),!0);var l=i.getIterator();return!1!==d(l,(function(t){if(o(e,t))return h(l,"normal",!1)}))}},b622:function(t,e,i){"use strict";var n=i("da84"),o=i("5692"),r=i("1a2d"),s=i("90e3"),a=i("04f8"),d=i("fdbf"),h=n.Symbol,l=o("wks"),c=d?h["for"]||h:h&&h.withoutSetter||s;t.exports=function(t){return r(l,t)||(l[t]=a&&r(h,t)?h[t]:c("Symbol."+t)),l[t]}},c01e:function(t,e,i){"use strict";i("a4e7")},c04e:function(t,e,i){"use strict";var n=i("c65b"),o=i("861d"),r=i("d9b5"),s=i("dc4a"),a=i("485a"),d=i("b622"),h=TypeError,l=d("toPrimitive");t.exports=function(t,e){if(!o(t)||r(t))return t;var i,d=s(t,l);if(d){if(void 0===e&&(e="default"),i=n(d,t,e),!o(i)||r(i))return i;throw new h("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},c1a1:function(t,e,i){"use strict";var n=i("23e7"),o=i("b4bc"),r=i("dad2");n({target:"Set",proto:!0,real:!0,forced:!r("isDisjointFrom")},{isDisjointFrom:o})},c430:function(t,e,i){"use strict";t.exports=!1},c65b:function(t,e,i){"use strict";var n=i("40d5"),o=Function.prototype.call;t.exports=n?o.bind(o):function(){return o.apply(o,arguments)}},c6b6:function(t,e,i){"use strict";var n=i("e330"),o=n({}.toString),r=n("".slice);t.exports=function(t){return r(o(t),8,-1)}},c6cd:function(t,e,i){"use strict";var n=i("c430"),o=i("da84"),r=i("6374"),s="__core-js_shared__",a=t.exports=o[s]||r(s,{});(a.versions||(a.versions=[])).push({version:"3.37.1",mode:n?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"})},c8ba:function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(n){"object"===typeof window&&(i=window)}t.exports=i},ca84:function(t,e,i){"use strict";var n=i("e330"),o=i("1a2d"),r=i("fc6a"),s=i("4d64").indexOf,a=i("d012"),d=n([].push);t.exports=function(t,e){var i,n=r(t),h=0,l=[];for(i in n)!o(a,i)&&o(n,i)&&d(l,i);while(e.length>h)o(n,i=e[h++])&&(~s(l,i)||d(l,i));return l}},cb27:function(t,e,i){"use strict";var n=i("e330"),o=Set.prototype;t.exports={Set:Set,add:n(o.add),has:n(o.has),remove:n(o["delete"]),proto:o}},cb2d:function(t,e,i){"use strict";var n=i("1626"),o=i("9bf2"),r=i("13d2"),s=i("6374");t.exports=function(t,e,i,a){a||(a={});var d=a.enumerable,h=void 0!==a.name?a.name:e;if(n(i)&&r(i,h,a),a.global)d?t[e]=i:s(e,i);else{try{a.unsafe?t[e]&&(d=!0):delete t[e]}catch(l){}d?t[e]=i:o.f(t,e,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},cc12:function(t,e,i){"use strict";var n=i("da84"),o=i("861d"),r=n.document,s=o(r)&&o(r.createElement);t.exports=function(t){return s?r.createElement(t):{}}},cdce:function(t,e,i){"use strict";var n=i("da84"),o=i("1626"),r=n.WeakMap;t.exports=o(r)&&/native code/.test(String(r))},d012:function(t,e,i){"use strict";t.exports={}},d039:function(t,e,i){"use strict";t.exports=function(t){try{return!!t()}catch(e){return!0}}},d066:function(t,e,i){"use strict";var n=i("da84"),o=i("1626"),r=function(t){return o(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?r(n[t]):n[t]&&n[t][e]}},d1e7:function(t,e,i){"use strict";var n={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,r=o&&!n.call({1:2},1);e.f=r?function(t){var e=o(this,t);return!!e&&e.enumerable}:n},d22f:function(t,i){t.exports=e},d58f:function(t,e,i){"use strict";var n=i("59ed"),o=i("7b0b"),r=i("44ad"),s=i("07fa"),a=TypeError,d="Reduce of empty array with no initial value",h=function(t){return function(e,i,h,l){var c=o(e),u=r(c),f=s(c);if(n(i),0===f&&h<2)throw new a(d);var y=t?f-1:0,p=t?-1:1;if(h<2)while(1){if(y in u){l=u[y],y+=p;break}if(y+=p,t?y<0:f<=y)throw new a(d)}for(;t?y>=0:f>y;y+=p)y in u&&(l=i(l,u[y],y,c));return l}};t.exports={left:h(!1),right:h(!0)}},d9b5:function(t,e,i){"use strict";var n=i("d066"),o=i("1626"),r=i("3a9b"),s=i("fdbf"),a=Object;t.exports=s?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return o(e)&&r(e.prototype,a(t))}},da84:function(t,e,i){"use strict";(function(e){var i=function(t){return t&&t.Math===Math&&t};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof e&&e)||i("object"==typeof this&&this)||function(){return this}()||Function("return this")()}).call(this,i("c8ba"))},dad2:function(t,e,i){"use strict";var n=i("d066"),o=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};t.exports=function(t){var e=n("Set");try{(new e)[t](o(0));try{return(new e)[t](o(-1)),!1}catch(i){return!0}}catch(r){return!1}}},dc19:function(t,e,i){"use strict";var n=i("cb27").has;t.exports=function(t){return n(t),t}},dc4a:function(t,e,i){"use strict";var n=i("59ed"),o=i("7234");t.exports=function(t,e){var i=t[e];return o(i)?void 0:n(i)}},e330:function(t,e,i){"use strict";var n=i("40d5"),o=Function.prototype,r=o.call,s=n&&o.bind.bind(r,r);t.exports=n?s:function(t){return function(){return r.apply(t,arguments)}}},e893:function(t,e,i){"use strict";var n=i("1a2d"),o=i("56ef"),r=i("06cf"),s=i("9bf2");t.exports=function(t,e,i){for(var a=o(e),d=s.f,h=r.f,l=0;l<a.length;l++){var c=a[l];n(t,c)||i&&n(i,c)||d(t,c,h(e,c))}}},e8b5:function(t,e,i){"use strict";var n=i("c6b6");t.exports=Array.isArray||function(t){return"Array"===n(t)}},e9bc:function(t,e,i){"use strict";var n=i("dc19"),o=i("cb27").add,r=i("83b9"),s=i("7f65"),a=i("5388");t.exports=function(t){var e=n(this),i=s(t).getIterator(),d=r(e);return a(i,(function(t){o(d,t)})),d}},eb03:function(t,e,i){"use strict";i("c1a1")},eb48:function(t,e,i){"use strict";i("8815")},f772:function(t,e,i){"use strict";var n=i("5692"),o=i("90e3"),r=n("keys");t.exports=function(t){return r[t]||(r[t]=o(t))}},fa76:function(t,e,i){"use strict";i("1e5a")},fb15:function(t,e,i){"use strict";if(i.r(e),"undefined"!==typeof window){var n=window.document.currentScript,o=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(i.p=o[1])}var r=function(){var t=this,e=t._self._c;return e("div",["h"==t.mode?e("horizontal",t._g(t._b({ref:"MoonHierarchy"},"horizontal",t.$attrs,!1),t.$listeners),[t._t("default")],2):e("vertical",t._g(t._b({ref:"MoonHierarchy"},"vertical",t.$attrs,!1),t.$listeners),[t._t("default")],2)],1)},s=[],a=function(){var t=this,e=t._self._c;return e("div",{ref:"svg"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showCustomView,expression:"showCustomView"}],ref:"CoustomView",staticClass:"moon-hierarchy-custom-view"},[t._t("default")],2)])},d=[],h=(i("14d9"),i("13d5"),i("60bb"));let l=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((t,e)=>(e&=63,t+=e<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_",t),"");const c=(t,e)=>"string"===typeof e?Object.prototype.toString.call(t)==`[object ${e}]`:Array.isArray(e)?e.some(e=>Object.prototype.toString.call(t)==`[object ${e}]`):void 0,u=(t="uuid")=>t+l(),f=(t,e="id",i="pId",n="children",o=!0)=>{if(!c(t,"Array"))return void console.error("数据源必须是数组");let r=o?Object(h["cloneDeep"])(t):t.map(t=>(delete t.children,delete t.track,delete t.trigger,t));try{let t=r.reduce((t,o)=>{if(!o.hasOwnProperty(e))throw`${JSON.stringify(o)}树形结构数据不准确,数据项中没有指定的id:${e}`;o[n]=o[n]||[],o.track=o.track||[o[e]],o.trigger=o.trigger||[];let s=r.find(t=>t[e]==o[i]);return s?(s.track=s.track||[s[e]],o.track.push(s.track),s.trigger=s.trigger||[],s.trigger.push(o[e]),s.trigger.push(o.trigger),s[n]=s[n]?[...s[n],o]:[o]):t.push(o),t},[]),o=[],s=r.reduce((t,i)=>(i.trigger=Object(h["flattenDeep"])(i.trigger),i.track=Object(h["flattenDeep"])(i.track).reverse(),i.level=i.track.length,t[i[e]]=i,i[n].length||o.push(i),t),{});return{treeData:t,leafs:o,objById:s,flatData:r}}catch(s){return console.error(s),{treeData:[],leafs:[],objById:{},flatData:[]}}},y=(t,e)=>{if(!c(t,"Array")||!c(e,"Function"))throw"arrayRemoveItem 参数类型不正确，arr必须是数组，fun必须是函数";{let i=t.filter((t,i)=>!e(t,i));t.splice(0,t.length),i.forEach(e=>{t.push(e)})}};i("88e6"),i("70cc"),i("eb03"),i("22e5"),i("c01e"),i("fa76"),i("8306");var p=i("d22f");function g(t){return t&&t.length}var v={props:{width:{type:Number,default:1366},height:{type:Number,default:768},treeData:{type:Array,default:()=>[]},treeOptions:{type:Object,default:()=>({})},defaultOpenLevel:{type:Number,default:2},duration:{type:Number,default:400},negativeIds:{type:Array,default:()=>[]},config:{type:Object,default:()=>({})},canExpendFold:{type:[Boolean,Function],default:!0},expendShape:{type:String},foldShape:{type:String}},mounted(){var t;this.currentScale=(null===(t=this.config)||void 0===t||null===(t=t.zoom)||void 0===t?void 0:t.defaultScale)||1,this.drawSvg(),this.$watch(()=>[this.treeData,this.layout],()=>{g(this.treeData)&&this.drawContainer()},{deep:!0,immediate:!0})},data(){return{svg:null,zoom:null,container:null,hierarchyLayoutData:null,lastClickNode:null,nodesContainer:null,linksContainer:null,currentScale:1,treeDataFactory:{treeData:[],leafs:[],objById:{},flatData:[]},exceptListener:["click","clickFetchChildren","mouseover","mouseout"],showCustomView:!1,InnerChangeTreeData:!1}},computed:{nodeListener(){var t;return(null===(t=this.config)||void 0===t||null===(t=t.node)||void 0===t?void 0:t.on)||{}},symbolKey(){return this.inner_treeOptions.id},inner_treeOptions(){return{id:"id",pId:"pId",name:"name",...this.treeOptions}},centerPosition(){return{x:this.width/2,y:this.height/2}},linkConifg(){var t,e;return{fill:"none",...(null===(t=this.config)||void 0===t?void 0:t.link)||{},class:"moon-hierarchy-link","marker-end":!1===(null===(e=this.config)||void 0===e||null===(e=e.arrow)||void 0===e?void 0:e.show)?"none":"url(#moon-hierarchy-arrow)"}},defsNodeConfig(){var t,e;const i=16;return{loadingSize:i,nodeList:[{name:"marker",attrs:{viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",...(null===(t=this.config.arrow)||void 0===t?void 0:t.attrs)||{},id:"moon-hierarchy-arrow",class:"moon-hierarchy-arrow"},children:[{name:"path",attrs:{d:(null===(e=this.config.arrow)||void 0===e?void 0:e.path)||"M 0 0 L 10 5 L 0 10 z"}}]},{name:"symbol",attrs:{viewBox:"0 0 1024 1024",width:"16",height:"16",id:"loading"},children:[{name:"path",attrs:{d:"M475.428571 97.52381h73.142858v219.428571h-73.142858z m0 609.523809h73.142858v219.428571h-73.142858zM926.47619 475.428571v73.142858h-219.428571v-73.142858z m-609.523809 0v73.142858H97.52381v-73.142858zM779.215238 193.072762l51.712 51.687619-155.136 155.184762-51.736381-51.736381zM348.208762 624.054857l51.736381 51.736381-155.160381 155.136-51.712-51.687619zM193.097143 244.784762l51.687619-51.712 155.184762 155.136-51.736381 51.736381z m430.982095 431.006476l51.736381-51.736381 155.136 155.160381-51.687619 51.712z"}}]}]}}},methods:{formatToArray(t){return t?Array.isArray(t)?t:[t]:[]},initTreeData(){this.treeDataFactory=f(this.treeData,this.inner_treeOptions.id,this.inner_treeOptions.pId);let t=[];this.treeDataFactory.treeData.length>1&&this.treeDataFactory.treeData.slice(1).forEach(e=>{t.push(e[this.symbolKey],...e.trigger)}),y(this.treeDataFactory.flatData,e=>t.includes(e[this.symbolKey])),t.forEach(t=>{delete this.treeDataFactory.objById[t]}),this.setSign()},createSvg(){this.svg=p["create"]("svg").attr("class","moon-hierarchy-svg").attr("width",this.width).attr("height",this.height).attr("cursor","move"),this.$emit("graph",this.svg)},createContainDom(){this.container=this.svg.append("g").attr("class","moon-hierarchy-container").attr("font-family","sans-serif").attr("transform",`translate(${this.width/2},${this.height/2}) scale(1)`)},drawSvg(){this.$watch(()=>[this.width,this.height],()=>{var t;this.svg?(this.svg.attr("width",this.width).attr("height",this.height),null!==(t=this.treeData)&&void 0!==t&&t.length&&this.treeLayout&&this.moveToCenter()):this.createSvg()},{deep:!0,immediate:!0}),this.addDefs(),this.$refs.svg.append(this.svg.node())},drawContainer(){this.InnerChangeTreeData?this.InnerChangeTreeData=!1:(this.container&&this.container.remove(),Object.assign(this.$data,this.$options.data(),{svg:this.svg}),this.createContainDom(),this.initTreeData(),this.defaultExpendLevel(),this.drawView(),this.initZoom(),this.moveToCenter(),this.$emit("draw-done",{svg:this.svg,container:this.container}))},defaultExpendLevel(){this.defaultOpenLevel>0&&this.treeDataFactory.flatData.forEach(t=>{t.level>=this.defaultOpenLevel&&(t._children=t.children,t.children=null)})},setLayoutData(){let t=this.treeDataFactory.treeData[0];if(this.hierarchyLayoutData=this.treeLayout(p["hierarchy"](t)),"bf"==this.layout&&t.children){let e=t.children.filter(t=>1==t._sign),i=t.children.filter(t=>-1==t._sign),n=this.treeLayout(p["hierarchy"]({...t,children:e})),o=this.treeLayout(p["hierarchy"]({...t,children:i}));this.hierarchyLayoutData.children=[...(null===n||void 0===n?void 0:n.children)||[],...(null===o||void 0===o?void 0:o.children)||[]]}},setNodeClassAttr(t){var e;const i=(null===(e=this.config.node)||void 0===e?void 0:e.attrs)||{};t.attr("class",(function(t){const e=p["select"](this).attr("class")||"",n=e.split(" ");n.push("moon-hierarchy-node"),1==t.data.track.length&&n.push("moon-hierarchy-node-root"),"boolean"==typeof t.data._isexpend&&n.push("moon-hierarchy-node-limit-button"),g(t.data.children)?n.push("moon-hierarchy-node-expend"):y(n,t=>"moon-hierarchy-node-expend"==t),(g(t.data.children)||g(t.data._children)||t.data._hasChildren)&&n.push("moon-hierarchy-node-haschildren");let o=i.class;return o&&("function"==typeof o&&n.push(o(t)||""),"string"==typeof o)?n.push(o):[...new Set(n)].join(" ")}))},setNodeDefaultAttr(t){var e;const i=this.getNodeId,n=this.symbolKey,o=this.lastClickNode,r=(null===(e=this.config.node)||void 0===e?void 0:e.attrs)||{},s={cursor:"pointer",...r,id:t=>i(t.data[n]),transform:t=>this.onNodeFoldTranslate(o,t)};Object.keys(s).reduce((t,e)=>t.attr(e,s[e]),t),this.setNodeClassAttr(t)},addNode(t){this.nodesContainer||(this.nodesContainer=this.container.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).attr("class","moon-hierarchy-nodes"));const e=this.nodesContainer.selectAll().data(t).join("g").on("click",(t,e)=>{var i,n;if(t.stopPropagation(),this.onNodeClick(e),"boolean"==typeof e.data._isexpend)return;const o=this.getNodeId(e.data[this.symbolKey]),r=this.svg.select("#"+o);null===(i=(n=this.nodeListener)["click"])||void 0===i||i.call(n,t,e,r,this.svg)}).on("mouseover",(t,e)=>{var i,n;if("boolean"==typeof e.data._isexpend)return;this.onNodeMouseOver(e);const o=this.getNodeId(e.data[this.symbolKey]),r=this.svg.select("#"+o);null===(i=(n=this.nodeListener)["mouseover"])||void 0===i||i.call(n,t,e,r,this.svg)}).on("mouseout",(t,e)=>{var i,n;if("boolean"==typeof e.data._isexpend)return;this.onNodeMouseOut(e);const o=this.getNodeId(e.data[this.symbolKey]),r=this.svg.select("#"+o);null===(i=(n=this.nodeListener)["mouseout"])||void 0===i||i.call(n,t,e,r,this.svg)});this.setNodeDefaultAttr(e),this.addListener(e,this.nodeListener,this.exceptListener),e.transition().duration(this.duration).attr("transform",t=>this.onNodeExpendTranslate(t)),this.iteratorAddNode(e,this.nodeConfig.shaps),this.addShapEexpendFold(e)},updateNodeByData(t){t=this.formatToArray(t);let e=[this.inner_treeOptions.id,this.inner_treeOptions.pId,"children","level","track","trigger"];t.forEach(t=>{let i=this.treeDataFactory.objById[t[this.symbolKey]];if(!i)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t[this.symbolKey]}的节点`;let n=Object.keys(i).reduce((t,n)=>((e.includes(n)||n.startsWith("_"))&&(t[n]=i[n]),t),{});Object.assign(i,t,n),this.InnerChangeTreeData=!0;let o=this.treeData.find(e=>e[this.symbolKey]==t[this.symbolKey]);Object.keys(o).forEach(t=>{o[t]=i[t]})}),this.drawView()},updateNode(t){for(let e=0;e<t.length;e++){let i=t[e];const n=this.getNodeId(i.data[this.symbolKey]),o=this.svg.select("#"+n);this.addListener(o,this.nodeListener,this.exceptListener,i),o.on("click",t=>{var e,n;t.stopPropagation(),this.onNodeClick(i),"boolean"!=typeof i.data._isexpend&&(null===(e=(n=this.nodeListener)["click"])||void 0===e||e.call(n,t,i,o,this.svg))}).on("mouseover",t=>{var e,n;"boolean"!=typeof i.data._isexpend&&(this.onNodeMouseOver(i),null===(e=(n=this.nodeListener)["mouseover"])||void 0===e||e.call(n,t,i,o,this.svg))}).on("mouseout",t=>{var e,n;"boolean"!=typeof i.data._isexpend&&(this.onNodeMouseOut(i),null===(e=(n=this.nodeListener)["mouseout"])||void 0===e||e.call(n,t,i,o,this.svg))}).transition().duration(this.duration).attr("transform",()=>this.onNodeExpendTranslate(i)),o.selectAll("*").remove(),this.setNodeClassAttr(o),this.iteratorAddNode(o,this.nodeConfig.shaps),this.addShapEexpendFold(o,i)}},removeNode(t,e=!0,i=!1){if(!t)throw`moon-hierarchy组件：请传入目标节点数据中${this.symbolKey}的值`;let n=this.hierarchyLayoutData.data[this.symbolKey];if(t==n)throw"moon-hierarchy组件：根节点不能删除";const o=this.treeDataFactory.objById[t];if(!o)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t}的节点`;if("boolean"==typeof o._isexpend&&!i)throw"moon-hierarchy组件：展开/收起节点不能手动删除！";let r=[...o.trigger,t];for(let a=0;a<r.length;a++){let t=this.treeDataFactory.objById[r[a]];this.svg.select("#"+this.getNodeId(t[this.symbolKey])).remove();const e=this.getLinkId(t[this.inner_treeOptions.pId],t[this.symbolKey]);this.svg.select("#"+e).remove()}let s=this.treeDataFactory.objById[o[this.inner_treeOptions.pId]];if(s){if(s._exChildren){let e=s._exChildren.findIndex(e=>e[this.symbolKey]==t);e>=0&&s._exChildren.splice(e,1)}const e=e=>{let i=s[e];if(i&&(i.splice(i.findIndex(e=>e[this.symbolKey]==t),1),this.limit>0&&s._exChildren)){let t=s._exChildren.filter(t=>t._sign==o._sign),e=i.filter(t=>t._sign==o._sign&&"boolean"!=typeof t._isexpend);if(e.length<this.limit){let n=t.slice(0,this.limit-e.length),r=i.findIndex(t=>"boolean"==typeof t._isexpend&&t._sign==o._sign);i.splice(r,0,...n),y(s._exChildren,t=>n.find(e=>e[this.symbolKey]==t[this.symbolKey]))}if(t=s._exChildren.filter(t=>t._sign==o._sign),e=i.filter(t=>t._sign==o._sign&&"boolean"!=typeof t._isexpend),e.length+t.length<=this.limit){let t=i.find(t=>"boolean"==typeof t._isexpend&&t._sign==o._sign);t&&this.removeNode(t[this.symbolKey],!1,!0)}}};e("children"),e("_children")}y(this.treeDataFactory.flatData,e=>[...o.trigger,t].includes(e[this.symbolKey])),[...o.trigger,t].forEach(t=>{delete this.treeDataFactory.objById[t]}),s.track.map(e=>{y(this.treeDataFactory.objById[e].trigger,e=>[...o.trigger,t].includes(e))}),this.InnerChangeTreeData=!0,y(this.treeData,e=>[...o.trigger,t].includes(e[this.symbolKey])),e&&this.drawView()},removeNodeById(t){t=this.formatToArray(t),t.forEach(t=>{this.removeNode(t,!1)}),this.drawView()},addShapEexpendFold(t,e){this.expendShape!=this.foldShape?(this.expendShape&&t.select(this.expendShape).on("click.customEvent",(t,i)=>{t.stopPropagation(),this.onNodeExpendOrFold(e||i,!0)}),this.foldShape&&t.select(this.foldShape).on("click.customEvent",(t,i)=>{t.stopPropagation(),this.onNodeExpendOrFold(e||i,!1)})):this.expendShape&&t.select(this.expendShape).on("click.customEvent",(t,i)=>{t.stopPropagation();const n=e?e.data[this.symbolKey]:i.data[this.symbolKey],o=this.treeDataFactory.objById[n];this.onNodeExpendOrFold(e||i,!g(o.children))})},addListener(t,e={},i=[],n){Object.keys(e).forEach(o=>{if(!i.includes(o)){let i=this.svg;t.on(o,(function(t,r){n&&(r=n),"boolean"!=typeof r.data._isexpend&&e[o](t,r,this,i)}))}})},addOrUpdateNode(){const t=this.hierarchyLayoutData.descendants();let e=[],i=[];for(let n=0;n<t.length;n++){let o=t[n];const r=this.getNodeId(o.data[this.symbolKey]),s=this.svg.select("#"+r);s.node()?i.push(o):e.push(o)}this.addNode(e),this.updateNode(i)},async onNodeClick(t){this.lastClickNode=t;const e=this.symbolKey,i=this.treeDataFactory.objById[this.lastClickNode.data[e]];g(i.children)?this.foldShape||this.onNodeExpendOrFold(t,!1):this.expendShape||this.onNodeExpendOrFold(t,!0),"boolean"===typeof i._isexpend&&this.onLimitNodeExpendOrFold&&this.onLimitNodeExpendOrFold(i)},async onNodeExpendOrFold(t,e=!1){if("boolean"==typeof this.canExpendFold&&!this.canExpendFold)return;if("function"==typeof this.canExpendFold&&!this.canExpendFold(n))return;const i=this.symbolKey;this.lastClickNode=t;const n=this.treeDataFactory.objById[this.lastClickNode.data[i]];e?g(n._children)?(n.children=n._children,n._children=void 0):n._hasChildren&&(await this.onClickFetchChildren(n),this.setLimtNode&&this.setLimtNode()):g(n.children)&&(n._children=n.children,n.children=void 0),this.drawView();let o=g(n._children);const r=this.hierarchyLayoutData.find(t=>t.data[i]==this.lastClickNode.data[i]);o&&this.foldLinksAndNodes(this.lastClickNode,r),this.moveToCenter({...this.nodeToCenterXY(r),d:this.duration})},onNodeMouseOver(t){t.links().forEach(t=>{const e=this.getLinkId(t.source.data[this.symbolKey],t.target.data[this.symbolKey]);this.svg.select("#"+e).classed("moon-hierarchy-node-hover-link",!0)})},onNodeMouseOut(t){t.links().forEach(t=>{const e=this.getLinkId(t.source.data[this.symbolKey],t.target.data[this.symbolKey]);let i=this.svg.select("#"+e);i.classed("moon-hierarchy-node-hover-link",!1)})},addNodeToTargetNode(t,e,i){if(!t)throw`moon-hierarchy组件：请传入目标节点数据中${this.symbolKey}的值`;const n=this.treeDataFactory.objById[t];if(!n)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t}的节点`;if("boolean"==typeof n._isexpend)throw"展开/收起节点不能新增子节点！";let o=this.treeDataFactory.treeData[0];i=t==o[this.symbolKey]?"bf"==this.layout&&[-1,1].includes(i)?i||n._sign:"bt"==this.layout||"rl"==this.layout?-1:1:n._sign;let r=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t);if(this.lastClickNode=r,e=this.formatToArray(e),e.length){var s;n.track.map(t=>{this.treeDataFactory.objById[t].trigger.push(...e.map(t=>t[this.symbolKey]))});let t=e.map(t=>(t._sign=i,t[this.inner_treeOptions.pId]=n[this.symbolKey],t)),o=t.findIndex(t=>t[this.symbolKey]==n[this.symbolKey]);-1!=o&&t.splice(o,1);const a={...n};a.children=[],t.push(a);let{objById:d,flatData:h}=f(t,this.symbolKey,this.inner_treeOptions.pId),l=d[n[this.symbolKey]].children;if(null!==(s=n._exChildren)&&void 0!==s&&s.length){let t=n.children||n._children,e=t.findIndex(t=>"boolean"==typeof t._isexpend&&t._sign==i),o=t[e];n._exChildren.push(...l),null!==o&&void 0!==o&&o._isexpend&&n.children.splice(e,0,...l),o._isexpend||(o._isexpend=!0,t.splice(t.indexOf(o),0,...r.data._exChildren.filter(t=>t._sign==o._sign)))}else n.children?n.children.push(...l):n._children?n._children.push(...l):n.children=l;h.filter(t=>t[this.symbolKey]!=n[this.symbolKey]).forEach(t=>{let e=t[this.symbolKey];this.treeDataFactory.objById[e]=t,this.treeDataFactory.flatData.push(t)})}this.onNodeExpendOrFold(r,!0),this.InnerChangeTreeData=!0,this.treeData.push(...e)},async onClickFetchChildren(t){if(t._hasChildren&&!t._loading)try{var e,i;this.setLoadingIcon(t);let n=await(null===(e=(i=this.nodeListener)["clickFetchChildren"])||void 0===e?void 0:e.call(i,t,this.svg.select("#"+this.getNodeId(t[this.symbolKey])),this.svg));if(n=this.formatToArray(n),n.length){t.track.map(t=>{this.treeDataFactory.objById[t].trigger.push(...n.map(t=>t[this.symbolKey]))});let e=n.map(e=>(e._sign=t._sign,e[this.inner_treeOptions.pId]||(e[this.inner_treeOptions.pId]=t[this.symbolKey]),e)),i=e.findIndex(e=>e[this.symbolKey]==t[this.symbolKey]);-1!=i&&e.splice(i,1),e.push(t);let{objById:o,flatData:r}=f(e,this.symbolKey,this.inner_treeOptions.pId);t.children=o[t[this.symbolKey]].children,r.filter(e=>e[this.symbolKey]!=t[this.symbolKey]).forEach(t=>{let e=t[this.symbolKey];this.treeDataFactory.objById[e]=t,this.treeDataFactory.flatData.push(t)})}this.setLoadingIcon(t,!1)}catch(n){throw this.setLoadingIcon(t,!1),n}},addOrUpdateLinks(){const t=this.hierarchyLayoutData.links();let e=[],i=[];for(let n=0;n<t.length;n++){let o=t[n];const r=this.getLinkId(o.source.data[this.symbolKey],o.target.data[this.symbolKey]),s=this.svg.select("#"+r);s.node()?i.push(o):e.push(o)}this.addLinks(e),this.updateLinks(i)},foldLinksAndNodes(t,e,i){const n=this.getLinkId,o=this.getNodeId,r=this.symbolKey;t.links().forEach(t=>{if("function"==typeof i&&!i(t))return;const s=o(t.target.data[r]),a=this.svg.select("#"+s);a.transition().duration(this.duration).attr("transform",()=>this.onNodeFoldTranslate(e,t.target));const d=n(t.source.data[r],t.target.data[r]),h=this.svg.select("#"+d);h.transition().duration(this.duration).attr("transform",()=>this.onNodeFoldTranslate(e,t.target)).on("end",()=>{h.attr("d",null)})})},drawView(){this.initLayoutData(),this.addOrUpdateLinks(),this.addOrUpdateNode(),this.updateCustomView()},addDefs(){const t=this.svg.append("defs");this.iteratorAddNode(t,this.defsNodeConfig.nodeList)},iteratorAddNode(t,e){e.forEach(e=>{const i=t.append(e.name);this.setAttrByOpt(i,e.attrs),this.setComposeOpt(i,e.compose),this.addListener(i,e.on),e.children&&this.iteratorAddNode(i,e.children)})},moveToCenter(t){if(!t){let e=this.hierarchyLayoutData;t={...this.nodeToCenterXY(e),d:this.duration}}let{x:e,y:i,d:n}=t;const o=1/this.currentScale;let r=this.centerPosition.x*o-e,s=this.centerPosition.y*o-i,a=p["zoomIdentity"].scale(this.currentScale).translate(r,s);a.d=n,this.svg.call(this.zoom.transform,a)},initZoom(){var t;let e=(null===(t=this.config)||void 0===t||null===(t=t.zoom)||void 0===t?void 0:t.scaleRange)||[.2,2],i=t=>{var e,i;null!==(e=this.config)&&void 0!==e&&null!==(e=e.zoom)&&void 0!==e&&e.callback&&(null===(i=this.config)||void 0===i||null===(i=i.zoom)||void 0===i||i.callback(t));let n=t.transform;this.currentScale=n.k,this.container.transition().duration(n.d).attr("transform",`translate(${Number(n.x)},${n.y}) scale(${n.k})`)};this.zoom=p["zoom"]().scaleExtent(e).on("zoom",i),this.zoom.zoomEvent=i,this.zoom.scaleRange=e,this.svg.call(this.zoom).on("dblclick.zoom",null)},pauseZoom(){this.zoom.scaleExtent([this.currentScale,this.currentScale])},continueZoom(){this.zoom.scaleExtent(this.zoom.scaleRange)},scale(t){if("number"!==typeof t)throw"缩放参数必须数字";{var e;this.currentScale=this.currentScale*Math.abs(t);let i=(null===(e=this.config)||void 0===e||null===(e=e.zoom)||void 0===e?void 0:e.scaleRange)||[.2,2];this.currentScale<i[0]&&(this.currentScale=i[0]),this.currentScale>i[1]&&(this.currentScale=i[1]),this.moveToCenter()}},setAttrByOpt(t,e={}){Object.keys(e).map(i=>{t.attr(i,e[i])})},setComposeOpt(t,e={}){Object.keys(e).reduce((t,i)=>(Array.isArray(e[i])?t[i](...e[i]):t[i](e[i]),t),t)},getNodeById(t){return{data:this.treeDataFactory.objById[t],el:this.svg.select("#"+this.getNodeId(t))}},getAllNode(){const t=Object.keys(this.treeDataFactory.objById),e=[];for(let i=0;i<t.length;i++){const n=t[i];let o=this.treeDataFactory.objById[n];"boolean"!=typeof o._isexpend&&e.push({data:o,el:this.svg.select("#"+this.getNodeId(n))})}return e},getNodeId(t){return"node-"+t},getLinkId(t,e){return"link-"+t+"-"+e},setPaddingFormat(t){let e=()=>[0,0,0,0],i=t;return"number"==typeof i&&(e=()=>[i,i,i,i]),Array.isArray(i)&&(2==i.length&&(e=()=>[i[0],i[1],i[0],i[1]]),4==i.length&&(e=()=>i)),"function"==typeof i&&(e=i),e},setShapClass(t,e,i){let n=i[e].attrs.class,o="moon-hierarchy-"+e;return"function"==typeof n?`${o} ${n(t)||""}`:"string"==typeof n&&n?`${o} ${n}`:o},calculateTextWidth(t,e,i){const n=document.createElement("canvas"),o=n.getContext("2d");o.font=`${e}px ${i}`;const r=o.measureText(t).width;return r},createOrUpdateForeignObject(t){var e;t={width:100,height:50,transform_begin:"translate(0,0) scale(0)",transform:"translate(0,0) scale(1)",...t},this.foreignObject||(this.foreignObject=this.container.append("foreignObject")),this.showCustomView=!0,Object.keys(t).reduce((e,i)=>"transform"!=i?e.attr(i,t[i]):e,this.foreignObject),t.hasChangeNode&&this.foreignObject.attr("transform",t.transform_begin),this.foreignObject.transition().duration(t.duration||(null===(e=this.config)||void 0===e||null===(e=e.customView)||void 0===e?void 0:e.duration)||this.duration).attr("transform",t.transform),this.foreignObject.on("click",t=>t.stopPropagation()),this.foreignObject.node().append(this.$refs.CoustomView)},updateCustomView(){if(this.foreignObject&&this.drawCustomViewLastConfig.d){let t=this.drawCustomViewLastConfig.d;const e=this.svg.select("#"+this.getNodeId(t.data[this.symbolKey]));if(e.node()){let t=this.drawCustomViewLastConfig.d.data[this.symbolKey],e=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t),{e:i,width:n,height:o,priority:r}=this.drawCustomViewLastConfig;e?this.drawCustomView(i,e,n,o,r):this.hiddenCustomView()}else this.hiddenCustomView()}},hiddenCustomView(){this.showCustomView=!1,this.drawCustomViewLastConfig={},this.foreignObject&&(this.foreignObject.remove(),this.foreignObject=null)},expendAllNode(){this.lastClickNode=this.hierarchyLayoutData,this.treeDataFactory.flatData.forEach(t=>{if(t._children&&(t.children=t._children,t._children=null),"boolean"==typeof t._isexpend&&!1===t._isexpend){var e;t._isexpend=!0;let i=this.treeDataFactory.objById[t[this.inner_treeOptions.pId]],n=i.children||i._children;if(null!==(e=i._exChildren)&&void 0!==e&&e.length){let e=i._exChildren.filter(e=>e._sign==t._sign);n.splice(n.indexOf(t),0,...e)}}}),this.drawView()},foldAllNode(){let t=[];this.treeDataFactory.flatData.forEach(e=>{let i={};if(this.defaultOpenLevel>0&&(e.level>=this.defaultOpenLevel&&e.children&&(e._children=e.children,e.children=null),e.level==this.defaultOpenLevel)){let t=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==e[this.symbolKey]);i.node=t}if("boolean"==typeof e._isexpend&&e._isexpend){e._isexpend=!1;let t=this.treeDataFactory.objById[e[this.inner_treeOptions.pId]],n=t.children||t._children,o=t._exChildren.filter(t=>t._sign==e._sign).map(t=>t[this.symbolKey]);e.level==this.defaultOpenLevel&&(i.parentNode=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t[this.symbolKey]),i.exChildrenIds=o),y(n,t=>o.includes(t[this.symbolKey]))}i.node&&t.push(i)}),this.drawView(),t.length?t.forEach(({node:t,parentNode:e,exChildrenIds:i})=>{let n=this.hierarchyLayoutData.find(e=>e.data[this.symbolKey]==t.data[this.symbolKey]);this.foldLinksAndNodes(t,n),e&&i&&(n=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==e.data[this.symbolKey]),this.foldLinksAndNodes(e,n,t=>i.includes(t.target.data[this.symbolKey])))}):this.foldLinksAndNodes(this.hierarchyLayoutData,this.hierarchyLayoutData),this.moveToCenter()},expendToNode(t){t.track.forEach((e,i)=>{if(e!=t[this.symbolKey]){let o=this.treeDataFactory.objById[e];if(this.lastClickNode||g(o._children)&&(this.lastClickNode=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==e)),g(o._children)&&(o.children=o._children,o._children=void 0),i<t.track.length-1){var n;let e=t.track[i+1],r=o.children||o._children,s=null===o||void 0===o||null===(n=o._exChildren)||void 0===n?void 0:n.find(t=>t[this.symbolKey]==e);if(s){let t=r.find(t=>"boolean"==typeof t._isexpend&&t._sign==s._sign);t._isexpend||(t._isexpend=!0,r.splice(r.indexOf(t),0,...o._exChildren.filter(e=>e._sign==t._sign)))}}}}),this.drawView()},moveToNode(t,e=[]){if(!t)throw`moon-hierarchy组件：请传入目标节点数据中${this.symbolKey}的值`;const i=this.treeDataFactory.objById[t];if(!i)throw`moon-hierarchy组件：画布中没有匹配到${this.symbolKey}=${t}的节点`;let n=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==i[this.symbolKey]);if(n||(this.expendToNode(i),n=this.hierarchyLayoutData.find(t=>t.data[this.symbolKey]==i[this.symbolKey])),this.moveToCenter({...this.nodeToCenterXY(n),d:this.duration}),e=this.formatToArray(e),e.length){let o=this.svg.select("#"+this.getNodeId(t));e.forEach(t=>{var e,r;const s={preventDefault(){}};if("clickFetchChildren"!=t){var a,d,h,l,c,u;if("click"==t)return console.log("click"),void(null===(a=(d=this.nodeListener)["click"])||void 0===a||a.call(d,s,n,o,this.svg));if("mouseover"==t)return this.onNodeMouseOver(n),void(null===(h=(l=this.nodeListener)["mouseover"])||void 0===h||h.call(l,s,n,o,this.svg));if("mouseover"==t)return this.onNodeMouseOut(n),void(null===(c=(u=this.nodeListener)["mouseout"])||void 0===c||c.call(u,s,n,o,this.svg));null===(e=(r=this.nodeListener)[t])||void 0===e||e.call(r,s,n,n,this.svg)}else this.onClickFetchChildren(i)})}}}};function m(t){return t&&t.length}var b={inheritAttrs:!1,name:"",mixins:[v],props:{layout:{type:String,default:"lr"},limit:{type:Number,default:3}},components:{},created(){},watch:{},computed:{nodeConfig(){var t,e,i,n,o,r;let s=2*((null===(t=this.config.node)||void 0===t||null===(t=t.plus)||void 0===t||null===(t=t.attrs)||void 0===t?void 0:t.r)||6);"boolean"!=typeof(null===(e=this.config.node)||void 0===e||null===(e=e.plus)||void 0===e?void 0:e.show)||null!==(i=this.config.node)&&void 0!==i&&null!==(i=i.plus)&&void 0!==i&&i.show||(s=0);let a={padding:t=>{let e=[15,15,15,15];return t&&(m(t.children)||m(t._children)||t._hasChildren)&&(1==t._sign&&t.track.length>1&&(e[1]=s+e[1]),-1==t._sign&&(e[3]=s+e[3])),e},nodeWidth:60,nodeHeight:16,separation:1.5,exShaps:[],...this.config.node||{},rect:{attrs:{},show:!0,on:{},...(null===(n=this.config.node)||void 0===n?void 0:n.rect)||{}},text:{attrs:{},show:!0,on:{},compose:{},...(null===(o=this.config.node)||void 0===o?void 0:o.text)||{}},plus:{attrs:{},show:!0,on:{},...(null===(r=this.config.node)||void 0===r?void 0:r.plus)||{}}},d=this.setPaddingFormat(a.padding),h=d();a.padding=d;let l=a.text.attrs["font-size"]||16;a.text.attrs["font-size"]=l;let c=a.text.attrs["font-family"]||null;a.text.attrs["font-family"]=c;let u=a.nodeHeight+h[0]+h[2],f=a.nodeWidth;a.plus.attrs.r=s/2;let y=a.separation,p=this.inner_treeOptions.name;const g={name:"rect",attrs:{...a.rect.attrs,class:t=>this.setShapClass(t,"rect",a),height:u,width:t=>t.data._nodeConfig.nodeWidth}},v={name:"rect",attrs:{stroke:"none",fill:"black","fill-opacity":0,"stroke-width":"0",height:u,width:t=>t.data._nodeConfig.nodeWidth},on:a.rect.on},b={name:"text",attrs:{"font-size":l,transform:t=>{let e=l+4;return`translate(${d(t.data)[3]},${(u-e)/2+l})`},...a.text.attrs,class:t=>this.setShapClass(t,"text",a)},compose:{text(t){return void 0===t.data._isexpend?t.data[p]:!0===t.data._isexpend?"收起":"展开"},...a.text.compose},on:a.text.on},x={name:"g",attrs:{...a.plus.attrs,class:t=>this.setShapClass(t,"plus",a),transform:t=>`translate(${1==t.data._sign?t.data._nodeConfig.nodeWidth-d(t.data)[1]+s:d(t.data)[3]-s},${u/2})`},on:a.plus.on,children:[{name:"circle",attrs:{r:s/2}},{name:"line",attrs:{x1:-s/4,y1:"0",x2:s/4,y2:"0"}},{name:"line",attrs:{x1:"0",y1:-s/4,x2:"0",y2:s/4}}]};return{fontSize:l,padding:d,plusCircleWidth:s,nodeHeight:u,nodeSize:[u,f],separation:y,shaps:[...a.rect.show?[g]:[],...a.text.show?[b]:[],...a.plus.show?[x]:[],...a.rect.show?[v]:[],...a.exShaps]}}},methods:{setSign(){var t;const e=(null===(t=this.treeDataFactory.treeData[0].children||this.treeDataFactory.treeData[0]._children)||void 0===t?void 0:t.filter(t=>this.negativeIds.includes(t[this.symbolKey])).map(t=>t[this.symbolKey]))||[];this.treeDataFactory.flatData.forEach(t=>{t._sign=1,"rl"==this.layout&&(t._sign=-1),"bf"==this.layout&&(t._sign=Object(h["intersection"])(t.track,e).length>0?-1:1)}),this.treeDataFactory.treeData[0]._sign=1,this.setLimtNode()},setLimtNode(){this.limit>0&&this.treeDataFactory.flatData.forEach(t=>{var e;let i=!t.children||"boolean"==typeof(null===(e=t.children)||void 0===e||null===(e=e[t.children.length-1])||void 0===e?void 0:e._isexpend);if(i)return;let n=[],o=[];const r=(e,i=1)=>{if(e.length>this.limit&&"boolean"!=typeof e[e.length-1]._isexpend){let r=u(),s={[this.symbolKey]:r,[this.inner_treeOptions.name]:"展开",[this.inner_treeOptions.pId]:t[this.symbolKey],track:[...t.track,r],trigger:[],level:t.level+1,_isexpend:!1,_sign:i};t.trigger.push(r),this.treeDataFactory.flatData.push(s),this.treeDataFactory.objById[r]=s,o.push(...e.slice(this.limit)),n.push(...e.slice(0,this.limit)),n.push(s)}else n.push(...e)};let s=t.children.filter(t=>1==t._sign),a=t.children.filter(t=>-1==t._sign);r(s,1),r(a,-1),t.children=n,t._exChildren=o})},initLayoutData(){this.addNodeWidthToData(this.treeDataFactory.treeData),this.addNodeOffset(this.treeDataFactory.treeData),this.setLayoutData()},onLimitNodeExpendOrFold(t){const e=this.symbolKey;let i=[],n=[];this.lastClickNode=this.lastClickNode.parent,t._isexpend=!t._isexpend;let o=this.treeDataFactory.objById[this.lastClickNode.data[e]];t._isexpend?o.children.splice(o.children.indexOf(t),0,...o._exChildren.filter(e=>e._sign==t._sign)):(i=o._exChildren.filter(e=>e._sign==t._sign).map(t=>t[this.symbolKey]),n=this.hierarchyLayoutData.descendants().filter(t=>i.includes(t.data[e])),o.children=o.children.filter(t=>!i.includes(t[this.symbolKey]))),this.drawView();const r=this.hierarchyLayoutData.find(t=>t.data[e]==this.lastClickNode.data[e]);t._isexpend||(n.forEach(t=>{this.foldLinksAndNodes(t,r)}),this.foldLinksAndNodes(this.lastClickNode,r,t=>i.includes(t.target.data[this.symbolKey]))),this.moveToCenter({...this.nodeToCenterXY(r),d:this.duration})},onNodeExpendTranslate(t){return t||(t={x:0,y:0,data:{_nodeConfig:{nodeWidth:0}}}),1==t.data._sign?`translate(${t.y},${t.x}) scale(1)`:-1==t.data._sign?`translate(${-t.y-t.data._nodeConfig.nodeWidth+this.getTranslateOffset(t)},${t.x}) scale(1)`:void 0},onNodeFoldTranslate(t,e){return t?`translate(${(t.y+t.data._nodeConfig.nodeWidth-this.getTranslateOffset(e))*t.data._sign},${t.x+this.nodeConfig.nodeHeight/2}) scale(0)`:`translate(0,${this.nodeConfig.nodeHeight/2}) scale(0)`},addLinks(t){const e=this.getLinkId,i=this.symbolKey;this.linksContainer||(this.linksContainer=this.container.append("g").attr("class","moon-hierarchy-links"));let n=this.linksContainer.selectAll().data(t).join("path");this.setAttrByOpt(n,this.linkConifg),n.attr("id",({source:t,target:n})=>e(t.data[i],n.data[i])),n.attr("d",t=>this.setLinkPath(t)).attr("transform",({target:t})=>this.onNodeFoldTranslate(this.lastClickNode,t)).transition().duration(this.duration).attr("transform",({target:t})=>`translate(${this.getTranslateOffset(t)},0) scale(1)`)},updateLinks(t){for(let e=0;e<t.length;e++){let i=t[e];const n=this.getLinkId(i.source.data[this.symbolKey],i.target.data[this.symbolKey]),o=this.svg.select("#"+n);o.transition().duration(this.duration).attr("transform",` translate(${this.getTranslateOffset(i.target)},0)  scale(1)`).attr("d",()=>this.setLinkPath(i))}},setLinkPath({source:t,target:e}){let i=this.nodeConfig.nodeHeight/2,n=e.data._sign*(t.y+t.data._nodeConfig.nodeWidth),o=t.x+i,r=e.data._sign*e.y,s=e.x+i,a=r-n,d=s-o,h=e.data._sign*this.nodeConfig.nodeSize[1];return`M${n},${o}h${a-h/2}v${d}h${h/2}`},nodeToCenterXY(t){let e=0;return e=1==t.data._sign?t.y+t.data._nodeConfig.nodeWidth/2:-t.y-t.data._nodeConfig.nodeWidth/2+this.hierarchyLayoutData.data._nodeConfig.nodeWidth,{x:e,y:t.x+this.nodeConfig.nodeHeight/2}},treeLayout(t){let e=p["tree"]().separation(()=>this.nodeConfig.separation).nodeSize(this.nodeConfig.nodeSize)(t);function i(t){for(let e=0;e<t.length;e++){let n=t[e];n.y=n.y+n.data.offset,m(n.children)&&i(n.children)}}return i(e.children||[]),e},addNodeWidthToData(t){for(let e=0;e<t.length;e++){let i=t[e];i._nodeConfig={...this.nodeConfig,nodeWidth:this.getNodeWidth(i)},m(i.children)&&this.addNodeWidthToData(i.children)}},addNodeOffset(t){const e=this.findTreeSameLevelData;function i(n,o=0){for(let r=0;r<n.length;r++){let s=n[r];if(s.offset=o,m(s.children)){let n=Object(h["maxBy"])(e(t,s),(function(t){return t._nodeConfig.nodeWidth}));i(s.children,s.offset+n._nodeConfig.nodeWidth)}}}i(t)},findTreeSameLevelData(t,e){let i=[],n=e.level,o=e._sign;function r(t,e,n){for(let s=0;s<t.length;s++){let a=t[s];n!=e||a._sign!=o?m(a.children)&&r(a.children,e,n+1):i.push(a)}}return r(t,n,1),i},getTranslateOffset(t){return-1==t.data._sign&&t.data[this.symbolKey]!=this.hierarchyLayoutData.data[this.symbolKey]?this.hierarchyLayoutData.data._nodeConfig.nodeWidth:0},getNodeWidth(t){let e=this.calculateTextWidth(t[this.inner_treeOptions.name],this.nodeConfig.fontSize,this.nodeConfig.fontFamily),i=this.nodeConfig.padding(t);return e+i[1]+i[3]},setLoadingIcon(t,e=!0){t._loading=e;const i=this.getNodeId(t[this.symbolKey]),n=t=>1==t.data._sign?t.data._nodeConfig.nodeWidth:-this.defsNodeConfig.loadingSize,o=()=>this.nodeConfig.nodeHeight/2-this.defsNodeConfig.loadingSize/2;if(e){const t=p["select"]("#"+i).append("use").attr("class","moon-hierarchy-loading").attr("xlink:href","#loading");t.attr("x",n).attr("y",o).attr("transform-origin",t=>`${n(t)+this.defsNodeConfig.loadingSize/2} ${o(t)+this.defsNodeConfig.loadingSize/2}`)}else this.svg.select("#"+i).select("use").remove()},drawCustomView(t,e,i,n,o,r){var s,a,d,h;i=i||(null===(s=this.config)||void 0===s||null===(s=s.customView)||void 0===s?void 0:s.width)||100,n=n||(null===(a=this.config)||void 0===a||null===(a=a.customView)||void 0===a?void 0:a.height)||50,o=o||(null===(d=this.config)||void 0===d||null===(d=d.customView)||void 0===d?void 0:d.priority)||["rb","rt","lb","lt"];const l=this.svg.node().getBoundingClientRect(),c=this.getNodeId(e.data[this.symbolKey]),u=this.svg.select("#"+c).node().getBoundingClientRect();let f={rb:l.bottom-u.bottom>=n&&l.right-u.right>=i,rt:u.top-l.top>=n&&l.right-u.right>=i,lb:l.bottom-u.bottom>=n&&u.left-l.left>=i,lt:u.top-l.top>=n&&u.left-l.left>=i},y=o.find(t=>f[t])||"rb",p="",g="",{nodeHeight:v,nodeWidth:m}=e.data._nodeConfig,b=this.getTranslateOffset(e),x={positive:{rt:[e.y+m,e.x],lt:[e.y,e.x],rb:[e.y+m,e.x+v],lb:[e.y,e.x+v]},negative:{rt:[-e.y+b,e.x],rb:[-e.y+b,e.x+v],lt:[-e.y+b-m,e.x],lb:[-e.y+b-m,e.x+v]}},_={positive:{rt:[e.y+m,e.x-n],lt:[e.y-i,e.x-n],rb:[e.y+m,e.x+v],lb:[e.y-i,e.x+v]},negative:{rt:[-e.y+b,e.x-n],rb:[-e.y+b,e.x+v],lt:[-e.y+b-m-i,e.x-n],lb:[-e.y+b-m-i,e.x+v]}};1==e.data._sign&&(g=`translate(${x.positive[y][0]},${x.positive[y][1]}) scale(0)`,p=`translate(${_.positive[y][0]},${_.positive[y][1]}) scale(1)`),-1==e.data._sign&&(g=`translate(${x.negative[y][0]},${x.negative[y][1]}) scale(0)`,p=`translate(${_.negative[y][0]},${_.negative[y][1]}) scale(1)`);let w=e.data[this.symbolKey]!=(null===(h=this.drawCustomViewLastConfig)||void 0===h||null===(h=h.d)||void 0===h||null===(h=h.data)||void 0===h?void 0:h[this.symbolKey]);this.drawCustomViewLastConfig={e:t,d:e,width:i,height:n,priority:o},this.createOrUpdateForeignObject({width:i,height:n,transform:p,transform_begin:g,hasChangeNode:w,duration:r})}}},x=b;function _(t,e,i,n,o,r,s,a){var d,h="function"===typeof t?t.options:t;if(e&&(h.render=e,h.staticRenderFns=i,h._compiled=!0),n&&(h.functional=!0),r&&(h._scopeId="data-v-"+r),s?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},h._ssrRegister=d):o&&(d=a?function(){o.call(this,(h.functional?this.parent:this).$root.$options.shadowRoot)}:o),d)if(h.functional){h._injectStyles=d;var l=h.render;h.render=function(t,e){return d.call(e),l(t,e)}}else{var c=h.beforeCreate;h.beforeCreate=c?[].concat(c,d):[d]}return{exports:t,options:h}}var w=_(x,a,d,!1,null,"7991cd10",null),C=w.exports,O=function(){var t=this,e=t._self._c;return e("div",{ref:"svg"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showCustomView,expression:"showCustomView"}],ref:"CoustomView",staticClass:"moon-hierarchy-custom-view"},[t._t("default")],2)])},N=[];function D(t){return t&&t.length}var k={inheritAttrs:!1,name:"",mixins:[v],props:{layout:{type:String,default:"tb"}},components:{},created(){},watch:{},computed:{nodeConfig(){var t,e,i,n;let o={padding:10,nodeWidth:168,nodeHeight:68,lineHeight:10,separation:1.5,exShaps:[],...(null===(t=this.config)||void 0===t?void 0:t.node)||{},rect:{attrs:{},show:!0,on:{},...(null===(e=this.config.node)||void 0===e?void 0:e.rect)||{}},text:{attrs:{},show:!0,on:{},...(null===(i=this.config.node)||void 0===i?void 0:i.text)||{}},plus:{attrs:{},show:!0,on:{},...(null===(n=this.config.node)||void 0===n?void 0:n.plus)||{}}};o.padding=this.setPaddingFormat(o.padding);let r=o.nodeWidth,s=o.nodeHeight,a=0;var d;o.plus.show&&(a=2*((null===(d=o.plus.attrs)||void 0===d?void 0:d.r)||10),o.plus.attrs.r=a/2);let h=o.text.attrs["font-size"]||16;o.text.attrs["font-size"]=h;let l=o.text.attrs["font-family"]||null;o.text.attrs["font-family"]=l;let c=o.text.attrs["line-height"]||10;o.text.attrs["line-height"]=c;let u=o.separation;const f={name:"rect",attrs:{...o.rect.attrs,class:t=>this.setShapClass(t,"rect",o),height:s,width:t=>t.data._nodeConfig.nodeWidth}},y={name:"rect",attrs:{stroke:"none",fill:"black","fill-opacity":0,"stroke-width":"0",height:s,width:t=>t.data._nodeConfig.nodeWidth},on:o.rect.on},p={name:"g",attrs:{transform:t=>`translate(${r/2},${s/2-(t.data._name[1]?(h+c)/2:0)})`},on:o.text.on,children:[{name:"text",attrs:{...o.text.attrs,class:t=>this.setShapClass(t,"text",o),"font-size":h,"text-anchor":"middle","dominant-baseline":"middle"},children:[{name:"tspan",attrs:{},compose:{text(t){return t.data._name[0]}}},{name:"tspan",attrs:{x:0,dy:h+c},compose:{text(t){return t.data._name[1]}}}]}]},g={name:"g",attrs:{...o.plus.attrs,class:t=>this.setShapClass(t,"plus",o),transform:t=>`translate(${t.data._nodeConfig.nodeWidth/2},${(1==t.data._sign?s:0)+t.data._sign*a/2})`},on:o.plus.on,children:[{name:"circle",attrs:{r:a/2}},{name:"line",attrs:{x1:-a/4,y1:"0",x2:a/4,y2:"0"}},{name:"line",attrs:{x1:"0",y1:-a/4,x2:"0",y2:a/4}}]};return{fontSize:h,padding:o.padding,nodeHeight:s,nodeWidth:r,nodeSize:[r,2*s],separation:u,plusCircleWidth:a,shaps:[...o.rect.show?[f]:[],...o.text.show?[p]:[],...o.plus.show?[g]:[],...o.rect.show?[y]:[],...o.exShaps]}}},methods:{setSign(){var t;const e=(null===(t=this.treeDataFactory.treeData[0].children||this.treeDataFactory.treeData[0]._children)||void 0===t?void 0:t.filter(t=>this.negativeIds.includes(t[this.symbolKey])).map(t=>t[this.symbolKey]))||[];this.treeDataFactory.flatData.forEach(t=>{t._sign=1,"bt"==this.layout&&(t._sign=-1),"bf"==this.layout&&(t._sign=Object(h["intersection"])(t.track,e).length>0?-1:1)}),this.treeDataFactory.treeData[0]._sign=1},initLayoutData(){this.addNodeWidthToData(this.treeDataFactory.treeData),this.setLayoutData()},onNodeExpendTranslate(t){return t||(t={x:0,y:0,data:{_nodeConfig:{nodeWidth:0}}}),1==t.data._sign?`translate(${t.x-t.data._nodeConfig.nodeWidth/2},${t.y}) scale(1)`:-1==t.data._sign?`translate(${t.x-t.data._nodeConfig.nodeWidth/2},${-t.y}) scale(1)`:void 0},onNodeFoldTranslate(t,e){return t?-1==e.data._sign?`translate(${t.x},${t.y*t.data._sign}) scale(0)`:`translate(${t.x},${t.y+this.nodeConfig.nodeHeight}) scale(0)`:(e.data._sign,`translate(0,${this.nodeConfig.nodeHeight}) scale(0)`)},addLinks(t){const e=this.getLinkId,i=this.symbolKey;this.linksContainer||(this.linksContainer=this.container.append("g").attr("class","moon-hierarchy-links"));let n=this.linksContainer.selectAll().data(t).join("path");this.setAttrByOpt(n,this.linkConifg),n.attr("id",({source:t,target:n})=>e(t.data[i],n.data[i])),n.attr("d",t=>this.setLinkPath(t)).attr("transform",({target:t})=>this.onNodeFoldTranslate(this.lastClickNode,t)).transition().duration(this.duration).attr("transform",({target:t})=>`translate(0,${this.getTranslateOffset(t)}) scale(1)`)},updateLinks(t){for(let e=0;e<t.length;e++){let i=t[e];const n=this.getLinkId(i.source.data[this.symbolKey],i.target.data[this.symbolKey]),o=this.svg.select("#"+n);o.transition().duration(this.duration).attr("transform",` translate(0,${this.getTranslateOffset(i.target)} )  scale(1)`).attr("d",()=>this.setLinkPath(i))}},setLinkPath({source:t,target:e}){let i=t.x,n=e.data._sign*(t.y+this.nodeConfig.nodeHeight),o=e.x,r=e.data._sign*e.y,s=o-i,a=r-n;return`M${i},${n}v${a/2}h${s}v${a/2}`},nodeToCenterXY(t){return{x:t.x+t.data._nodeConfig.nodeWidth/2,y:t.data._sign*t.y+this.nodeConfig.nodeHeight/2}},treeLayout(t){return p["tree"]().separation(()=>this.nodeConfig.separation).nodeSize(this.nodeConfig.nodeSize)(t)},addNodeWidthToData(t){for(let e=0;e<t.length;e++){let i=t[e];i._nodeConfig={...this.nodeConfig,nodeWidth:this.nodeConfig.nodeWidth},i["_"+this.inner_treeOptions.name]=this.getFormatTextArr(i),D(i.children)&&this.addNodeWidthToData(i.children)}},getTranslateOffset(t){return-1==t.data._sign&&t.data[this.symbolKey]!=this.hierarchyLayoutData.data[this.symbolKey]?this.nodeConfig.nodeHeight:0},setLoadingIcon(t,e=!0){const i=this.getNodeId(t[this.symbolKey]),n=t=>t.data._nodeConfig.nodeWidth/2-this.defsNodeConfig.loadingSize/2,o=t=>1==t.data._sign?this.nodeConfig.nodeHeight+this.nodeConfig.plusCircleWidth:-this.defsNodeConfig.loadingSize-this.nodeConfig.plusCircleWidth;if(e){t._loading=e;const r=p["select"]("#"+i).append("use").attr("class","moon-hierarchy-loading").attr("xlink:href","#loading");r.attr("x",n).attr("y",o).attr("transform-origin",t=>`${n(t)+this.defsNodeConfig.loadingSize/2} ${o(t)+this.defsNodeConfig.loadingSize/2}`)}else delete t._loading,this.svg.select("#"+i).select("use").remove()},getFormatTextArr(t,e=2,i="…"){const n=t[this.inner_treeOptions.name],o=this.nodeConfig.padding(t),r=this.nodeConfig.nodeWidth-o[1]-o[3];let s=[];const a=this.calculateTextWidth;function d(t,e,i,n,o=[]){for(let r=t.length;r>=0;r--){const s=t.slice(0,r),h=a(s,i,n);if(e>=h){o.push(s);let a=t.slice(r);a&&d(a,e,i,n,o);break}}}if(d(n,r,this.nodeConfig.fontSize,this.nodeConfig.fontFamily,s),e&&s.length>e){s=s.slice(0,e);const t=s[e-1];for(let n=t.length;n>=0;n--){const o=t.slice(0,n)+i,d=a(o,this.nodeConfig.fontSize,this.nodeConfig.fontFamily);if(r>=d){s[e-1]=o;break}}}if(s.length<e)for(let h=s.length+1;h<=e;h++)s.push("");return s},drawCustomView(t,e,i,n,o,r){var s,a,d,h;i=i||(null===(s=this.config)||void 0===s||null===(s=s.customView)||void 0===s?void 0:s.width)||100,n=n||(null===(a=this.config)||void 0===a||null===(a=a.customView)||void 0===a?void 0:a.height)||50,o=o||(null===(d=this.config)||void 0===d||null===(d=d.customView)||void 0===d?void 0:d.priority)||["rb","rt","lb","lt"];const l=this.svg.node().getBoundingClientRect(),c=this.getNodeId(e.data[this.symbolKey]),u=this.svg.select("#"+c).node().getBoundingClientRect();let f={rb:l.bottom-u.bottom>=n&&l.right-u.right>=i,rt:u.top-l.top>=n&&l.right-u.right>=i,lb:l.bottom-u.bottom>=n&&u.left-l.left>=i,lt:u.top-l.top>=n&&u.left-l.left>=i},y=o.find(t=>f[t])||"rb",p="",g="",{nodeHeight:v,nodeWidth:m}=e.data._nodeConfig,b={positive:{rt:[e.x+m/2,e.y],lt:[e.x-m/2,e.y],rb:[e.x+m/2,e.y+v],lb:[e.x-m/2,e.y+v]},negative:{rt:[e.x+m/2,-e.y],rb:[e.x+m/2,-e.y+v],lt:[e.x-m/2,-e.y],lb:[e.x-m/2,-e.y+v]}},x={positive:{rt:[e.x+m/2,e.y-n],lt:[e.x-m/2-i,e.y-n],rb:[e.x+m/2,e.y+v],lb:[e.x-m/2-i,e.y+v]},negative:{rt:[e.x+m/2,-e.y-n],rb:[e.x+m/2,-e.y+v],lt:[e.x-m/2-i,-e.y-n],lb:[e.x-m/2-i,-e.y+v]}};1==e.data._sign&&(g=`translate(${b.positive[y][0]},${b.positive[y][1]}) scale(0)`,p=`translate(${x.positive[y][0]},${x.positive[y][1]}) scale(1)`),-1==e.data._sign&&(g=`translate(${b.negative[y][0]},${b.negative[y][1]}) scale(0)`,p=`translate(${x.negative[y][0]},${x.negative[y][1]}) scale(1)`);let _=e.data[this.symbolKey]!=(null===(h=this.drawCustomViewLastConfig)||void 0===h||null===(h=h.d)||void 0===h||null===(h=h.data)||void 0===h?void 0:h[this.symbolKey]);this.drawCustomViewLastConfig={e:t,d:e,width:i,height:n,priority:o},this.createOrUpdateForeignObject({width:i,height:n,transform:p,transform_begin:g,hasChangeNode:_,duration:r})}}},S=k,L=_(S,O,N,!1,null,"fde22212",null),j=L.exports,I={inheritAttrs:!1,name:"MoonHierarchy",props:{mode:{type:String,default:"h"}},components:{horizontal:C,vertical:j},created(){},mounted(){},data(){return{show:!1}},watch:{},computed:{},methods:{getNodeById(t){return this.$refs.MoonHierarchy.getNodeById(t)},getAllNode(){return this.$refs.MoonHierarchy.getAllNode()},moveToCenter(){this.$refs.MoonHierarchy.moveToCenter(null)},zoom(t){this.$refs.MoonHierarchy.scale(t)},addNode(t,e,i){this.$refs.MoonHierarchy.addNodeToTargetNode(t,e,i)},removeNodeById(t){this.$refs.MoonHierarchy.removeNodeById(t)},pauseZoom(){this.$refs.MoonHierarchy.pauseZoom()},continueZoom(){this.$refs.MoonHierarchy.continueZoom()},showCustomView(t,e,i,n,o){this.$refs.MoonHierarchy.drawCustomView(t,e,i,n,o)},hiddenCustomView(){this.$refs.MoonHierarchy.hiddenCustomView()},updateNodeByData(t){this.$refs.MoonHierarchy.updateNodeByData(t)},moveToNode(t,e){this.$refs.MoonHierarchy.moveToNode(t,e)},expendAllNode(){this.$refs.MoonHierarchy.expendAllNode()},foldAllNode(){this.$refs.MoonHierarchy.foldAllNode()}}},$=I,K=(i("eb48"),_($,r,s,!1,null,"b75f8d7e",null)),F=K.exports;e["default"]=F},fc6a:function(t,e,i){"use strict";var n=i("44ad"),o=i("1d80");t.exports=function(t){return n(o(t))}},fdbf:function(t,e,i){"use strict";var n=i("04f8");t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator}})["default"]}));
//# sourceMappingURL=moon-hierarchy.umd.min.js.map