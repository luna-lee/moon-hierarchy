(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e(require("lodash"),require("d3")):"function"===typeof define&&define.amd?define(["lodash","d3"],e):"object"===typeof exports?exports["moon-hierarchy"]=e(require("lodash"),require("d3")):t["moon-hierarchy"]=e(t["lodash"],t["d3"])})("undefined"!==typeof self?self:this,(function(t,e){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s="fb15")}({"04f8":function(t,e,n){"use strict";var r=n("2d00"),i=n("d039"),o=n("da84"),a=o.String;t.exports=!!Object.getOwnPropertySymbols&&!i((function(){var t=Symbol("symbol detection");return!a(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},"06cf":function(t,e,n){"use strict";var r=n("83ab"),i=n("c65b"),o=n("d1e7"),a=n("5c6c"),s=n("fc6a"),d=n("a04b"),c=n("1a2d"),l=n("0cfb"),h=Object.getOwnPropertyDescriptor;e.f=r?h:function(t,e){if(t=s(t),e=d(e),l)try{return h(t,e)}catch(n){}if(c(t,e))return a(!i(o.f,t,e),t[e])}},"07fa":function(t,e,n){"use strict";var r=n("50c4");t.exports=function(t){return r(t.length)}},"0cfb":function(t,e,n){"use strict";var r=n("83ab"),i=n("d039"),o=n("cc12");t.exports=!r&&!i((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},"0d51":function(t,e,n){"use strict";var r=String;t.exports=function(t){try{return r(t)}catch(e){return"Object"}}},"13d2":function(t,e,n){"use strict";var r=n("e330"),i=n("d039"),o=n("1626"),a=n("1a2d"),s=n("83ab"),d=n("5e77").CONFIGURABLE,c=n("8925"),l=n("69f3"),h=l.enforce,u=l.get,f=String,p=Object.defineProperty,g=r("".slice),y=r("".replace),v=r([].join),m=s&&!i((function(){return 8!==p((function(){}),"length",{value:8}).length})),b=String(String).split("String"),x=t.exports=function(t,e,n){"Symbol("===g(f(e),0,7)&&(e="["+y(f(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!a(t,"name")||d&&t.name!==e)&&(s?p(t,"name",{value:e,configurable:!0}):t.name=e),m&&n&&a(n,"arity")&&t.length!==n.arity&&p(t,"length",{value:n.arity});try{n&&a(n,"constructor")&&n.constructor?s&&p(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(i){}var r=h(t);return a(r,"source")||(r.source=v(b,"string"==typeof e?e:"")),t};Function.prototype.toString=x((function(){return o(this)&&u(this).source||c(this)}),"toString")},"13d5":function(t,e,n){"use strict";var r=n("23e7"),i=n("d58f").left,o=n("a640"),a=n("2d00"),s=n("605d"),d=!s&&a>79&&a<83,c=d||!o("reduce");r({target:"Array",proto:!0,forced:c},{reduce:function(t){var e=arguments.length;return i(this,t,e,e>1?arguments[1]:void 0)}})},"14d9":function(t,e,n){"use strict";var r=n("23e7"),i=n("7b0b"),o=n("07fa"),a=n("3a34"),s=n("3511"),d=n("d039"),c=d((function(){return 4294967297!==[].push.call({length:4294967296},1)})),l=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},h=c||!l();r({target:"Array",proto:!0,arity:1,forced:h},{push:function(t){var e=i(this),n=o(e),r=arguments.length;s(n+r);for(var d=0;d<r;d++)e[n]=arguments[d],n++;return a(e,n),n}})},1626:function(t,e,n){"use strict";var r="object"==typeof document&&document.all;t.exports="undefined"==typeof r&&void 0!==r?function(t){return"function"==typeof t||t===r}:function(t){return"function"==typeof t}},"1a2d":function(t,e,n){"use strict";var r=n("e330"),i=n("7b0b"),o=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return o(i(t),e)}},"1d80":function(t,e,n){"use strict";var r=n("7234"),i=TypeError;t.exports=function(t){if(r(t))throw new i("Can't call method on "+t);return t}},"23cb":function(t,e,n){"use strict";var r=n("5926"),i=Math.max,o=Math.min;t.exports=function(t,e){var n=r(t);return n<0?i(n+e,0):o(n,e)}},"23e7":function(t,e,n){"use strict";var r=n("da84"),i=n("06cf").f,o=n("9112"),a=n("cb2d"),s=n("6374"),d=n("e893"),c=n("94ca");t.exports=function(t,e){var n,l,h,u,f,p,g=t.target,y=t.global,v=t.stat;if(l=y?r:v?r[g]||s(g,{}):(r[g]||{}).prototype,l)for(h in e){if(f=e[h],t.dontCallGetSet?(p=i(l,h),u=p&&p.value):u=l[h],n=c(y?h:g+(v?".":"#")+h,t.forced),!n&&void 0!==u){if(typeof f==typeof u)continue;d(f,u)}(t.sham||u&&u.sham)&&o(f,"sham",!0),a(l,h,f,t)}}},"241c":function(t,e,n){"use strict";var r=n("ca84"),i=n("7839"),o=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},"2d00":function(t,e,n){"use strict";var r,i,o=n("da84"),a=n("342f"),s=o.process,d=o.Deno,c=s&&s.versions||d&&d.version,l=c&&c.v8;l&&(r=l.split("."),i=r[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&a&&(r=a.match(/Edge\/(\d+)/),(!r||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/),r&&(i=+r[1]))),t.exports=i},"342f":function(t,e,n){"use strict";t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},3511:function(t,e,n){"use strict";var r=TypeError,i=9007199254740991;t.exports=function(t){if(t>i)throw r("Maximum allowed index exceeded");return t}},"3a34":function(t,e,n){"use strict";var r=n("83ab"),i=n("e8b5"),o=TypeError,a=Object.getOwnPropertyDescriptor,s=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=s?function(t,e){if(i(t)&&!a(t,"length").writable)throw new o("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},"3a9b":function(t,e,n){"use strict";var r=n("e330");t.exports=r({}.isPrototypeOf)},"40d5":function(t,e,n){"use strict";var r=n("d039");t.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},"44ad":function(t,e,n){"use strict";var r=n("e330"),i=n("d039"),o=n("c6b6"),a=Object,s=r("".split);t.exports=i((function(){return!a("z").propertyIsEnumerable(0)}))?function(t){return"String"===o(t)?s(t,""):a(t)}:a},"485a":function(t,e,n){"use strict";var r=n("c65b"),i=n("1626"),o=n("861d"),a=TypeError;t.exports=function(t,e){var n,s;if("string"===e&&i(n=t.toString)&&!o(s=r(n,t)))return s;if(i(n=t.valueOf)&&!o(s=r(n,t)))return s;if("string"!==e&&i(n=t.toString)&&!o(s=r(n,t)))return s;throw new a("Can't convert object to primitive value")}},"4d64":function(t,e,n){"use strict";var r=n("fc6a"),i=n("23cb"),o=n("07fa"),a=function(t){return function(e,n,a){var s,d=r(e),c=o(d),l=i(a,c);if(t&&n!==n){while(c>l)if(s=d[l++],s!==s)return!0}else for(;c>l;l++)if((t||l in d)&&d[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},"50c4":function(t,e,n){"use strict";var r=n("5926"),i=Math.min;t.exports=function(t){return t>0?i(r(t),9007199254740991):0}},5692:function(t,e,n){"use strict";var r=n("c430"),i=n("c6cd");(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.35.0",mode:r?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.35.0/LICENSE",source:"https://github.com/zloirock/core-js"})},"56ef":function(t,e,n){"use strict";var r=n("d066"),i=n("e330"),o=n("241c"),a=n("7418"),s=n("825a"),d=i([].concat);t.exports=r("Reflect","ownKeys")||function(t){var e=o.f(s(t)),n=a.f;return n?d(e,n(t)):e}},5926:function(t,e,n){"use strict";var r=n("b42e");t.exports=function(t){var e=+t;return e!==e||0===e?0:r(e)}},"59ed":function(t,e,n){"use strict";var r=n("1626"),i=n("0d51"),o=TypeError;t.exports=function(t){if(r(t))return t;throw new o(i(t)+" is not a function")}},"5c6c":function(t,e,n){"use strict";t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},"5e77":function(t,e,n){"use strict";var r=n("83ab"),i=n("1a2d"),o=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,s=i(o,"name"),d=s&&"something"===function(){}.name,c=s&&(!r||r&&a(o,"name").configurable);t.exports={EXISTS:s,PROPER:d,CONFIGURABLE:c}},"605d":function(t,e,n){"use strict";var r=n("da84"),i=n("c6b6");t.exports="process"===i(r.process)},"60bb":function(e,n){e.exports=t},6374:function(t,e,n){"use strict";var r=n("da84"),i=Object.defineProperty;t.exports=function(t,e){try{i(r,t,{value:e,configurable:!0,writable:!0})}catch(n){r[t]=e}return e}},"69f3":function(t,e,n){"use strict";var r,i,o,a=n("cdce"),s=n("da84"),d=n("861d"),c=n("9112"),l=n("1a2d"),h=n("c6cd"),u=n("f772"),f=n("d012"),p="Object already initialized",g=s.TypeError,y=s.WeakMap,v=function(t){return o(t)?i(t):r(t,{})},m=function(t){return function(e){var n;if(!d(e)||(n=i(e)).type!==t)throw new g("Incompatible receiver, "+t+" required");return n}};if(a||h.state){var b=h.state||(h.state=new y);b.get=b.get,b.has=b.has,b.set=b.set,r=function(t,e){if(b.has(t))throw new g(p);return e.facade=t,b.set(t,e),e},i=function(t){return b.get(t)||{}},o=function(t){return b.has(t)}}else{var x=u("state");f[x]=!0,r=function(t,e){if(l(t,x))throw new g(p);return e.facade=t,c(t,x,e),e},i=function(t){return l(t,x)?t[x]:{}},o=function(t){return l(t,x)}}t.exports={set:r,get:i,has:o,enforce:v,getterFor:m}},7234:function(t,e,n){"use strict";t.exports=function(t){return null===t||void 0===t}},7418:function(t,e,n){"use strict";e.f=Object.getOwnPropertySymbols},7839:function(t,e,n){"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},"7b0b":function(t,e,n){"use strict";var r=n("1d80"),i=Object;t.exports=function(t){return i(r(t))}},"825a":function(t,e,n){"use strict";var r=n("861d"),i=String,o=TypeError;t.exports=function(t){if(r(t))return t;throw new o(i(t)+" is not an object")}},"83ab":function(t,e,n){"use strict";var r=n("d039");t.exports=!r((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"861d":function(t,e,n){"use strict";var r=n("1626");t.exports=function(t){return"object"==typeof t?null!==t:r(t)}},8925:function(t,e,n){"use strict";var r=n("e330"),i=n("1626"),o=n("c6cd"),a=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(t){return a(t)}),t.exports=o.inspectSource},"90e3":function(t,e,n){"use strict";var r=n("e330"),i=0,o=Math.random(),a=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+a(++i+o,36)}},9112:function(t,e,n){"use strict";var r=n("83ab"),i=n("9bf2"),o=n("5c6c");t.exports=r?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},"94ca":function(t,e,n){"use strict";var r=n("d039"),i=n("1626"),o=/#|\.prototype\./,a=function(t,e){var n=d[s(t)];return n===l||n!==c&&(i(e)?r(e):!!e)},s=a.normalize=function(t){return String(t).replace(o,".").toLowerCase()},d=a.data={},c=a.NATIVE="N",l=a.POLYFILL="P";t.exports=a},9846:function(t,e,n){},"9bf2":function(t,e,n){"use strict";var r=n("83ab"),i=n("0cfb"),o=n("aed9"),a=n("825a"),s=n("a04b"),d=TypeError,c=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",u="configurable",f="writable";e.f=r?o?function(t,e,n){if(a(t),e=s(e),a(n),"function"===typeof t&&"prototype"===e&&"value"in n&&f in n&&!n[f]){var r=l(t,e);r&&r[f]&&(t[e]=n.value,n={configurable:u in n?n[u]:r[u],enumerable:h in n?n[h]:r[h],writable:!1})}return c(t,e,n)}:c:function(t,e,n){if(a(t),e=s(e),a(n),i)try{return c(t,e,n)}catch(r){}if("get"in n||"set"in n)throw new d("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},a04b:function(t,e,n){"use strict";var r=n("c04e"),i=n("d9b5");t.exports=function(t){var e=r(t,"string");return i(e)?e:e+""}},a640:function(t,e,n){"use strict";var r=n("d039");t.exports=function(t,e){var n=[][t];return!!n&&r((function(){n.call(null,e||function(){return 1},1)}))}},aa86:function(t,e,n){"use strict";n("9846")},aed9:function(t,e,n){"use strict";var r=n("83ab"),i=n("d039");t.exports=r&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},b42e:function(t,e,n){"use strict";var r=Math.ceil,i=Math.floor;t.exports=Math.trunc||function(t){var e=+t;return(e>0?i:r)(e)}},b622:function(t,e,n){"use strict";var r=n("da84"),i=n("5692"),o=n("1a2d"),a=n("90e3"),s=n("04f8"),d=n("fdbf"),c=r.Symbol,l=i("wks"),h=d?c["for"]||c:c&&c.withoutSetter||a;t.exports=function(t){return o(l,t)||(l[t]=s&&o(c,t)?c[t]:h("Symbol."+t)),l[t]}},c04e:function(t,e,n){"use strict";var r=n("c65b"),i=n("861d"),o=n("d9b5"),a=n("dc4a"),s=n("485a"),d=n("b622"),c=TypeError,l=d("toPrimitive");t.exports=function(t,e){if(!i(t)||o(t))return t;var n,d=a(t,l);if(d){if(void 0===e&&(e="default"),n=r(d,t,e),!i(n)||o(n))return n;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),s(t,e)}},c430:function(t,e,n){"use strict";t.exports=!1},c65b:function(t,e,n){"use strict";var r=n("40d5"),i=Function.prototype.call;t.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},c6b6:function(t,e,n){"use strict";var r=n("e330"),i=r({}.toString),o=r("".slice);t.exports=function(t){return o(i(t),8,-1)}},c6cd:function(t,e,n){"use strict";var r=n("da84"),i=n("6374"),o="__core-js_shared__",a=r[o]||i(o,{});t.exports=a},c8ba:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}t.exports=n},ca84:function(t,e,n){"use strict";var r=n("e330"),i=n("1a2d"),o=n("fc6a"),a=n("4d64").indexOf,s=n("d012"),d=r([].push);t.exports=function(t,e){var n,r=o(t),c=0,l=[];for(n in r)!i(s,n)&&i(r,n)&&d(l,n);while(e.length>c)i(r,n=e[c++])&&(~a(l,n)||d(l,n));return l}},cb2d:function(t,e,n){"use strict";var r=n("1626"),i=n("9bf2"),o=n("13d2"),a=n("6374");t.exports=function(t,e,n,s){s||(s={});var d=s.enumerable,c=void 0!==s.name?s.name:e;if(r(n)&&o(n,c,s),s.global)d?t[e]=n:a(e,n);else{try{s.unsafe?t[e]&&(d=!0):delete t[e]}catch(l){}d?t[e]=n:i.f(t,e,{value:n,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return t}},cc12:function(t,e,n){"use strict";var r=n("da84"),i=n("861d"),o=r.document,a=i(o)&&i(o.createElement);t.exports=function(t){return a?o.createElement(t):{}}},cdce:function(t,e,n){"use strict";var r=n("da84"),i=n("1626"),o=r.WeakMap;t.exports=i(o)&&/native code/.test(String(o))},d012:function(t,e,n){"use strict";t.exports={}},d039:function(t,e,n){"use strict";t.exports=function(t){try{return!!t()}catch(e){return!0}}},d066:function(t,e,n){"use strict";var r=n("da84"),i=n("1626"),o=function(t){return i(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?o(r[t]):r[t]&&r[t][e]}},d1e7:function(t,e,n){"use strict";var r={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,o=i&&!r.call({1:2},1);e.f=o?function(t){var e=i(this,t);return!!e&&e.enumerable}:r},d22f:function(t,n){t.exports=e},d58f:function(t,e,n){"use strict";var r=n("59ed"),i=n("7b0b"),o=n("44ad"),a=n("07fa"),s=TypeError,d=function(t){return function(e,n,d,c){var l=i(e),h=o(l),u=a(l);r(n);var f=t?u-1:0,p=t?-1:1;if(d<2)while(1){if(f in h){c=h[f],f+=p;break}if(f+=p,t?f<0:u<=f)throw new s("Reduce of empty array with no initial value")}for(;t?f>=0:u>f;f+=p)f in h&&(c=n(c,h[f],f,l));return c}};t.exports={left:d(!1),right:d(!0)}},d9b5:function(t,e,n){"use strict";var r=n("d066"),i=n("1626"),o=n("3a9b"),a=n("fdbf"),s=Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return i(e)&&o(e.prototype,s(t))}},da84:function(t,e,n){"use strict";(function(e){var n=function(t){return t&&t.Math===Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()}).call(this,n("c8ba"))},dc4a:function(t,e,n){"use strict";var r=n("59ed"),i=n("7234");t.exports=function(t,e){var n=t[e];return i(n)?void 0:r(n)}},e330:function(t,e,n){"use strict";var r=n("40d5"),i=Function.prototype,o=i.call,a=r&&i.bind.bind(o,o);t.exports=r?a:function(t){return function(){return o.apply(t,arguments)}}},e893:function(t,e,n){"use strict";var r=n("1a2d"),i=n("56ef"),o=n("06cf"),a=n("9bf2");t.exports=function(t,e,n){for(var s=i(e),d=a.f,c=o.f,l=0;l<s.length;l++){var h=s[l];r(t,h)||n&&r(n,h)||d(t,h,c(e,h))}}},e8b5:function(t,e,n){"use strict";var r=n("c6b6");t.exports=Array.isArray||function(t){return"Array"===r(t)}},f772:function(t,e,n){"use strict";var r=n("5692"),i=n("90e3"),o=r("keys");t.exports=function(t){return o[t]||(o[t]=i(t))}},fb15:function(t,e,n){"use strict";if(n.r(e),"undefined"!==typeof window){var r=window.document.currentScript,i=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(n.p=i[1])}var o=function(){var t=this,e=t._self._c;return e("div",["h"==t.mode?e("horizontal",t._g(t._b({},"horizontal",t.$attrs,!1),t.$listeners)):e("vertical",t._g(t._b({},"vertical",t.$attrs,!1),t.$listeners))],1)},a=[],s=function(){var t=this,e=t._self._c;return e("div",{ref:"svg"})},d=[],c=(n("14d9"),n("13d5"),n("60bb"));let l=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((t,e)=>(e&=63,t+=e<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_",t),"");const h=(t,e)=>"string"===typeof e?Object.prototype.toString.call(t)==`[object ${e}]`:Array.isArray(e)?e.some(e=>Object.prototype.toString.call(t)==`[object ${e}]`):void 0,u=(t="uuid")=>t+l(),f=(t,e="id",n="pId",r="children",i=!0)=>{if(!h(t,"Array"))return void console.error("数据源必须是数组");let o=i?Object(c["cloneDeep"])(t):t.map(t=>(delete t.children,delete t.track,delete t.trigger,t));try{let t=o.reduce((t,i)=>{if(!i.hasOwnProperty(e))throw`${JSON.stringify(i)}树形结构数据不准确,数据项中没有指定的id:${e}`;i[r]=i[r]||[],i.track=i.track||[i[e]],i.trigger=i.trigger||[];let a=o.find(t=>t[e]==i[n]);return a?(a.track=a.track||[a[e]],i.track.push(a.track),a.trigger=a.trigger||[],a.trigger.push(i[e]),a.trigger.push(i.trigger),a[r]=a[r]?[...a[r],i]:[i]):t.push(i),t},[]),i=[],a=o.reduce((t,n)=>(n.trigger=Object(c["flattenDeep"])(n.trigger),n.track=Object(c["flattenDeep"])(n.track).reverse(),n.level=n.track.length,t[n[e]]=n,n[r].length||i.push(n),t),{});return{treeData:t,leafs:i,objById:a,flatData:o}}catch(a){return console.error(a),{treeData:[],leafs:[],objById:{},flatData:[]}}};var p=n("d22f");function g(t){return t&&t.length}var y={props:{width:{type:Number,default:1366},height:{type:Number,default:768},treeData:{type:Array,default:()=>[]},treeOptions:{type:Object,default:()=>({})},defaultOpenLevel:{type:Number,default:2},duration:{type:Number,default:400},negativeIds:{type:Array,default:()=>[]},listener:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},canExpendFold:{type:[Boolean,Function],default:!0},expendShape:{type:String},foldShape:{type:String}},mounted(){var t;this.currentScale=(null===(t=this.config)||void 0===t||null===(t=t.zoom)||void 0===t?void 0:t.defaultScale)||1,this.drawSvg(),this.$watch(()=>[this.treeData,this.layout],()=>{g(this.treeData)&&this.drawContainer()},{deep:!0,immediate:!0})},data(){return{svg:null,zoom:null,container:null,treeLayoutData:null,lastClickNode:null,nodesContainer:null,linksContainer:null,currentScale:1,treeDataFactory:{treeData:[],leafs:[],objById:{},flatData:[]},exceptListener:["click","clickFetchChildren","mouseover","mouseout"]}},computed:{symbolKey(){return this.inner_treeOptions.id},inner_treeOptions(){return{id:"id",pId:"pId",name:"name",...this.treeOptions}},centerPosition(){return{x:this.width/2,y:this.height/2}},linkConifg(){var t,e;return{stroke:"#D8D8D8",fill:"none","stroke-opacity":"1","stroke-width":"1",...(null===(t=this.config)||void 0===t?void 0:t.link)||{},class:"moon-hierarchy-link","marker-end":!1===(null===(e=this.config)||void 0===e||null===(e=e.arrow)||void 0===e?void 0:e.show)?"none":"url(#arrow)"}},defsNodeConfig(){var t,e;const n=16;return{loadingSize:n,nodeList:[{name:"marker",attrs:{viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",fill:"#128BED",orient:"auto-start-reverse",...(null===(t=this.config.arrow)||void 0===t?void 0:t.attrs)||{},id:"arrow"},children:[{name:"path",attrs:{d:(null===(e=this.config.arrow)||void 0===e?void 0:e.path)||"M 0 0 L 10 5 L 0 10 z"}}]},{name:"symbol",attrs:{viewBox:"0 0 1024 1024",width:"16",height:"16",id:"loading"},children:[{name:"path",attrs:{d:"M475.428571 97.52381h73.142858v219.428571h-73.142858z m0 609.523809h73.142858v219.428571h-73.142858zM926.47619 475.428571v73.142858h-219.428571v-73.142858z m-609.523809 0v73.142858H97.52381v-73.142858zM779.215238 193.072762l51.712 51.687619-155.136 155.184762-51.736381-51.736381zM348.208762 624.054857l51.736381 51.736381-155.160381 155.136-51.712-51.687619zM193.097143 244.784762l51.687619-51.712 155.184762 155.136-51.736381 51.736381z m430.982095 431.006476l51.736381-51.736381 155.136 155.160381-51.687619 51.712z"}}]}]}},needUpdataShapsByClassMap(){let t={};function e(n){n.forEach(n=>{var r;null!==(r=n.attrs)&&void 0!==r&&r.class&&(t[n.attrs.class]=n),g(n.children)&&e(n.children)})}return e(this.nodeConfig.shaps),t}},methods:{initTreeData(){this.treeDataFactory=f(this.treeData,this.inner_treeOptions.id,this.inner_treeOptions.pId),this.setSign()},createSvg(){this.svg=p["create"]("svg").attr("class","moon-hierarchy-svg").attr("width",this.width).attr("height",this.height).attr("cursor","move")},createContainDom(){this.container=this.svg.append("g").attr("class","moon-hierarchy-container").attr("font-family","sans-serif").attr("transform",`translate(${this.width/2},${this.height/2}) scale(1)`)},drawSvg(){this.$watch(()=>[this.width,this.height],()=>{this.svg?(this.svg.attr("width",this.width).attr("height",this.height),this.moveToCenter()):this.createSvg()},{deep:!0,immediate:!0}),this.addDefs(),this.appendSvg()},drawContainer(){this.container&&this.container.remove(),Object.assign(this.$data,this.$options.data(),{svg:this.svg}),this.createContainDom(),this.initTreeData(),this.defaultExpendLevel(),this.drawView(),this.initZoom(),this.moveToCenter()},defaultExpendLevel(){this.defaultOpenLevel>0&&this.treeDataFactory.flatData.forEach(t=>{t.level>=this.defaultOpenLevel&&(t._children=t.children,t.children=null)})},setLayoutData(){let t=this.treeDataFactory.treeData[0];if(this.treeLayoutData=this.treeLayout(p["hierarchy"](t)),"bf"==this.layout&&t.children){let e=t.children.filter(t=>1==t._sign),n=t.children.filter(t=>-1==t._sign),r=this.treeLayout(p["hierarchy"]({...t,children:e})),i=this.treeLayout(p["hierarchy"]({...t,children:n}));this.treeLayoutData.children=[...(null===r||void 0===r?void 0:r.children)||[],...(null===i||void 0===i?void 0:i.children)||[]]}},addNode(t){const e=this.getNodeId,n=this.symbolKey,r=this.lastClickNode;this.nodesContainer||(this.nodesContainer=this.container.append("g").attr("stroke-linejoin","round").attr("stroke-width",3).attr("class","moon-hierarchy-nodes"));const i=this.nodesContainer.selectAll().data(t).join("g").attr("class",t=>"boolean"==typeof t.data._isexpend?"moon-hierarchy-node moon-hierarchy-expend-button":"moon-hierarchy-node").attr("cursor","pointer").attr("id",t=>e(t.data[n])).attr("transform",t=>this.onNodeFoldTranslate(r,t)).on("click",(t,e)=>{var n,r;this.onNodeClick(e),null===(n=(r=this.listener)["click"])||void 0===n||n.call(r,t,e)}).on("mouseover",(t,e)=>{var n,r;this.onNodeMouseOver(e),null===(n=(r=this.listener)["mouseover"])||void 0===n||n.call(r,t,e)}).on("mouseout",(t,e)=>{var n,r;this.onNodeMouseOut(e),null===(n=(r=this.listener)["mouseout"])||void 0===n||n.call(r,t,e)});this.addListener(i,this.listener,this.exceptListener),i.transition().duration(this.duration).attr("transform",t=>this.onNodeExpendTranslate(t)),this.iteratorAddNode(i,this.nodeConfig.shaps),this.addShapEexpendFold(i)},updateNode(t){for(let e=0;e<t.length;e++){let n=t[e];const r=this.getNodeId(n.data[this.symbolKey]),i=p["select"]("#"+r);this.addListener(i,this.listener,this.exceptListener,n),i.on("click",()=>{var t,e;this.onNodeClick(n),null===(t=(e=this.listener)["click"])||void 0===t||t.call(e,n)}).on("mouseover",t=>{var e,r;this.onNodeMouseOver(n),null===(e=(r=this.listener)["mouseover"])||void 0===e||e.call(r,t,n)}).on("mouseout",t=>{var e,r;this.onNodeMouseOut(n),null===(e=(r=this.listener)["mouseout"])||void 0===e||e.call(r,t,n)}).transition().duration(this.duration).attr("transform",()=>this.onNodeExpendTranslate(n)),Object.keys(this.needUpdataShapsByClassMap).forEach(t=>{const{attrs:e,compose:n,on:r}=this.needUpdataShapsByClassMap[t],o=i.select("."+t);this.setAttrByOpt(o,e),this.addListener(o,r),this.setComposeOpt(o,n)}),this.addShapEexpendFold(i,n)}},addShapEexpendFold(t,e){this.expendShape!=this.foldShape?(this.expendShape&&t.select(this.expendShape).on("click",(t,n)=>{t.stopPropagation(),this.onNodeExpendOrFold(e||n,!0)}),this.foldShape&&t.select(this.foldShape).on("click",(t,n)=>{t.stopPropagation(),this.onNodeExpendOrFold(e||n,!1)})):this.expendShape&&t.select(this.expendShape).on("click",(t,n)=>{t.stopPropagation();const r=e?e.data[this.symbolKey]:n.data[this.symbolKey],i=this.treeDataFactory.objById[r];this.onNodeExpendOrFold(e||n,!g(i.children))})},addListener(t,e={},n=[],r){Object.keys(e).forEach(i=>{n.includes(i)||t.on(i,(t,n)=>e[i](t,r||n))})},addOrUpdateNode(){const t=this.treeLayoutData.descendants();let e=[],n=[];for(let r=0;r<t.length;r++){let i=t[r];const o=this.getNodeId(i.data[this.symbolKey]),a=p["select"]("#"+o);a.node()?n.push(i):e.push(i)}this.addNode(e),this.updateNode(n)},async onNodeClick(t){this.lastClickNode=t;const e=this.symbolKey,n=this.treeDataFactory.objById[this.lastClickNode.data[e]];g(n.children)?this.foldShape||this.onNodeExpendOrFold(t,!1):this.expendShape||this.onNodeExpendOrFold(t,!0),"boolean"===typeof n._isexpend&&this.onLimitNodeExpendOrFold&&this.onLimitNodeExpendOrFold(n)},async onNodeExpendOrFold(t,e=!1){if("boolean"==typeof this.canExpendFold&&!this.canExpendFold)return;if("function"==typeof this.canExpendFold&&!this.canExpendFold(r))return;const n=this.symbolKey;this.lastClickNode=t;const r=this.treeDataFactory.objById[this.lastClickNode.data[n]];e?g(r._children)?(r.children=r._children,r._children=void 0):r._hasChildren&&(await this.onClickFetchChildren(r),this.setLimtNode&&this.setLimtNode()):g(r.children)&&(r._children=r.children,r.children=void 0),this.drawView();let i=g(r._children);const o=this.treeLayoutData.descendants().find(t=>t.data[n]==this.lastClickNode.data[n]);i&&this.foldLinksAndNodes(this.lastClickNode,o),this.moveToCenter({...this.nodeToCenterXY(o),d:this.duration})},onNodeMouseOver(t){t.links().forEach(t=>{const e=this.getLinkId(t.source.data[this.symbolKey],t.target.data[this.symbolKey]);p["select"]("#"+e).attr("class","moon-hierarchy-link-custom")})},onNodeMouseOut(t){t.links().forEach(t=>{const e=this.getLinkId(t.source.data[this.symbolKey],t.target.data[this.symbolKey]);let n=p["select"]("#"+e);n.classed("moon-hierarchy-link-custom",!1)})},async onClickFetchChildren(t){if(t._hasChildren&&!t._loading)try{var e,n;this.setLoadingIcon(t);let r=await(null===(e=(n=this.listener)["clickFetchChildren"])||void 0===e?void 0:e.call(n,t));if(Array.isArray(r)&&r.length){let e=r.map(e=>(e._sign=t._sign,e[this.inner_treeOptions.pId]||(e[this.inner_treeOptions.pId]=t[this.symbolKey]),e)),n=e.findIndex(e=>e[this.symbolKey]==t[this.symbolKey]);-1!=n&&e.splice(n,1),e.push(t);let{objById:i,flatData:o}=f(e,this.symbolKey,this.inner_treeOptions.pId);t.children=i[t[this.symbolKey]].children,o.filter(e=>e[this.symbolKey]!=t[this.symbolKey]).forEach(t=>{let e=t[this.symbolKey];this.treeDataFactory.objById[e]=t,this.treeDataFactory.flatData.push(t)})}this.setLoadingIcon(t,!1)}catch(r){this.setLoadingIcon(t,!1),console.error(r)}},addOrUpdateLinks(){const t=this.treeLayoutData.links();let e=[],n=[];for(let r=0;r<t.length;r++){let i=t[r];const o=this.getLinkId(i.source.data[this.symbolKey],i.target.data[this.symbolKey]),a=p["select"]("#"+o);a.node()?n.push(i):e.push(i)}this.addLinks(e),this.updateLinks(n)},foldLinksAndNodes(t,e,n){const r=this.getLinkId,i=this.getNodeId,o=this.symbolKey;t.links().forEach(t=>{if("function"==typeof n&&!n(t))return;const a=i(t.target.data[o]);p["select"]("#"+a).transition().duration(this.duration).attr("transform",()=>this.onNodeFoldTranslate(e,t.target));const s=r(t.source.data[o],t.target.data[o]);p["select"]("#"+s).transition().duration(this.duration).attr("transform",()=>this.onNodeFoldTranslate(e,t.target))})},drawView(){this.initLayoutData(),this.addOrUpdateLinks(),this.addOrUpdateNode()},addDefs(){const t=this.svg.append("defs");this.iteratorAddNode(t,this.defsNodeConfig.nodeList)},iteratorAddNode(t,e){e.forEach(e=>{const n=t.append(e.name);this.setAttrByOpt(n,e.attrs),this.setComposeOpt(n,e.compose),this.addListener(n,e.on),e.children&&this.iteratorAddNode(n,e.children)})},moveToCenter(t){if(!t){let e=this.treeLayoutData;t={...this.nodeToCenterXY(e),d:this.duration}}let{x:e,y:n,d:r}=t;const i=1/this.currentScale;let o=this.centerPosition.x*i-e,a=this.centerPosition.y*i-n,s=p["zoomIdentity"].scale(this.currentScale).translate(o,a);s.d=r,this.svg.call(this.zoom.transform,s)},appendSvg(){this.$refs.svg.append(this.svg.node())},initZoom(){var t;let e=(null===(t=this.config)||void 0===t||null===(t=t.zoom)||void 0===t?void 0:t.scaleRange)||[.2,2];this.zoom=p["zoom"]().scaleExtent(e).on("zoom",t=>{let e=t.transform;this.currentScale=e.k,this.container.transition().duration(e.d).attr("transform",`translate(${Number(e.x)},${e.y}) scale(${e.k})`)}),this.svg.call(this.zoom).on("dblclick.zoom",null)},setAttrByOpt(t,e={}){Object.keys(e).map(n=>{t.attr(n,e[n])})},setComposeOpt(t,e={}){Object.keys(e).reduce((t,n)=>(Array.isArray(e[n])?t[n](...e[n]):t[n](e[n]),t),t)},getNodeId(t){return"node-"+t},getLinkId(t,e){return"link-"+t+"-"+e},setPaddingFormat(t){let e=()=>[0,0,0,0],n=t;return"number"==typeof n&&(e=()=>[n,n,n,n]),Array.isArray(n)&&(2==n.length&&(e=()=>[n[0],n[1],n[0],n[1]]),4==n.length&&(e=()=>n)),"function"==typeof n&&(e=n),e},calculateTextWidth(t,e,n){const r=document.createElement("canvas"),i=r.getContext("2d");i.font=`${e}px ${n}`;const o=i.measureText(t).width;return o}}};function v(t){return t&&t.length}var m={inheritAttrs:!1,name:"",mixins:[y],props:{layout:{type:String,default:"lr"},limit:{type:Number,default:3}},components:{},created(){},watch:{},computed:{nodeConfig(){var t,e,n,r,i,o;let a=2*((null===(t=this.config.node)||void 0===t||null===(t=t.plus)||void 0===t||null===(t=t.attrs)||void 0===t?void 0:t.r)||6);"boolean"!=typeof(null===(e=this.config.node)||void 0===e||null===(e=e.plus)||void 0===e?void 0:e.show)||null!==(n=this.config.node)&&void 0!==n&&null!==(n=n.plus)&&void 0!==n&&n.show||(a=0);let s={padding:t=>{let e=[15,15,15,15];return t&&(v(t.children)||v(t._children)||t._hasChildren)&&(1==t._sign&&t.track.length>1&&(e[1]=a+e[1]),-1==t._sign&&(e[3]=a+e[3])),e},nodeWidth:60,separation:1.5,exShaps:()=>[],...this.config.node||{},rect:{attrs:{},show:!0,on:{},...(null===(r=this.config.node)||void 0===r?void 0:r.rect)||{}},text:{attrs:{},show:!0,on:{},compose:{},...(null===(i=this.config.node)||void 0===i?void 0:i.text)||{}},plus:{attrs:{},show:!0,on:{},...(null===(o=this.config.node)||void 0===o?void 0:o.plus)||{}}},d=this.setPaddingFormat(s.padding),c=d();s.padding=d;let l=s.text.attrs["font-size"]||16;s.text.attrs["font-size"]=l;let h=s.text.attrs["font-family"]||null;s.text.attrs["font-family"]=h;let u=l+c[0]+c[2];s.nodeHeight=u;let f=s.nodeWidth;s.plus.attrs.r=a/2;let p=s.separation,g=this.inner_treeOptions.name;const y={name:"rect",attrs:{stroke:"rgb(216, 216, 216)",fill:t=>1==t.data.track.length?"#128BED":"boolean"==typeof t.data._isexpend?"rgb(247,247,247)":"#fff","stroke-width":"0.5",...s.rect.attrs,height:u,width:t=>t.data._nodeWidth},on:s.rect.on},m={name:"text",attrs:{class:"moon-hierarchy-text",fill:t=>1==t.data.track.length?"#fff":v(t.data.children)?"rgb(18, 139, 237)":"rgb(51, 51, 51)",...s.text.attrs,"font-size":l,y:l+c[0],x:t=>d(t.data)[3]},compose:{text(t){return void 0===t.data._isexpend?t.data[g]:!0===t.data._isexpend?"收起":"展开"},...s.text.compose},on:s.text.on},b={name:"g",attrs:{class:"moon-hierarchy-plus",stroke:"rgb(153, 153, 153)",fill:"rgb(234, 242, 255)","stroke-width":1,...s.plus.attrs,display:t=>{if(!v(t.data.children)&&!v(t.data._children)&&!t.data._hasChildren||1==t.data.track.length)return"none"},transform:t=>`translate(${1==t.data._sign?t.data._nodeWidth-d(t.data)[1]+a:d(t.data)[3]-a},${u/2+1})`},on:s.plus.on,children:[{name:"circle",attrs:{r:a/2}},{name:"line",attrs:{x1:-a/4,y1:"0",x2:a/4,y2:"0"}},{name:"line",attrs:{class:"moon-hierarchy-plus-line2",display:t=>{if(v(t.data.children))return"none"},x1:"0",y1:-a/4,x2:"0",y2:a/4}}]};return{fontSize:l,padding:d,plusCircleWidth:a,nodeHeight:u,nodeSize:[u,f],separation:p,shaps:[...s.rect.show?[y]:[],...s.text.show?[m]:[],...s.plus.show?[b]:[],...s.exShaps(s)]}}},methods:{setSign(){var t;const e=(null===(t=this.treeDataFactory.treeData[0].children||this.treeDataFactory.treeData[0]._children)||void 0===t?void 0:t.filter(t=>this.negativeIds.includes(t[this.symbolKey])).map(t=>t[this.symbolKey]))||[];this.treeDataFactory.flatData.forEach(t=>{t._sign=1,"rl"==this.layout&&(t._sign=-1),"bf"==this.layout&&(t._sign=Object(c["intersection"])(t.track,e).length>0?-1:1)}),this.treeDataFactory.treeData[0]._sign=1,this.setLimtNode()},setLimtNode(){this.limit>0&&this.treeDataFactory.flatData.forEach(t=>{var e;let n=!t.children||"boolean"==typeof(null===(e=t.children)||void 0===e||null===(e=e[t.children.length-1])||void 0===e?void 0:e._isexpend);if(n)return;let r=[],i=[];const o=(e,n=1)=>{if(e.length>this.limit&&"boolean"!=typeof e[e.length-1]._isexpend){let o=u(),a={[this.symbolKey]:o,[this.inner_treeOptions.name]:"展开",[this.inner_treeOptions.pId]:t[this.symbolKey],track:[...t.track,o],level:t.level+1,_isexpend:!1,_sign:n};this.treeDataFactory.flatData.push(a),this.treeDataFactory.objById[o]=a,i.push(...e.slice(this.limit)),r.push(...e.slice(0,this.limit)),r.push(a)}else r.push(...e)};let a=t.children.filter(t=>1==t._sign),s=t.children.filter(t=>-1==t._sign);o(a,1),o(s,-1),t.children=r,t._exChildren=i})},initLayoutData(){this.addNodeWidthToData(this.treeDataFactory.treeData),this.addNodeOffset(this.treeDataFactory.treeData),this.setLayoutData()},onLimitNodeExpendOrFold(t){const e=this.symbolKey;let n=[],r=[];this.lastClickNode=this.lastClickNode.parent,t._isexpend=!t._isexpend;let i=this.treeDataFactory.objById[this.lastClickNode.data[e]];t._isexpend?i.children.splice(i.children.indexOf(t),0,...i._exChildren.filter(e=>e._sign==t._sign)):(n=i._exChildren.filter(e=>e._sign==t._sign).map(t=>t[this.symbolKey]),r=this.treeLayoutData.descendants().filter(t=>n.includes(t.data[e])),i.children=i.children.filter(t=>!n.includes(t[this.symbolKey]))),this.drawView();const o=this.treeLayoutData.descendants().find(t=>t.data[e]==this.lastClickNode.data[e]);t._isexpend||(r.forEach(t=>{this.foldLinksAndNodes(t,o)}),this.foldLinksAndNodes(this.lastClickNode,o,t=>n.includes(t.target.data[this.symbolKey]))),this.moveToCenter({...this.nodeToCenterXY(o),d:this.duration})},onNodeExpendTranslate(t){return t||(t={x:0,y:0,data:{_nodeWidth:0}}),1==t.data._sign?`translate(${t.y},${t.x}) scale(1)`:-1==t.data._sign?`translate(${-t.y-t.data._nodeWidth+this.getTranslateOffset(t)},${t.x}) scale(1)`:void 0},onNodeFoldTranslate(t,e){return t?`translate(${(t.y+t.data._nodeWidth-this.getTranslateOffset(e))*t.data._sign},${t.x+this.nodeConfig.nodeHeight/2}) scale(0)`:`translate(0,${this.nodeConfig.nodeHeight/2}) scale(0)`},addLinks(t){const e=this.getLinkId,n=this.symbolKey;this.linksContainer||(this.linksContainer=this.container.append("g").attr("class","moon-hierarchy-links"));let r=this.linksContainer.selectAll().data(t).join("path");this.setAttrByOpt(r,this.linkConifg),r.attr("id",({source:t,target:r})=>e(t.data[n],r.data[n])),r.attr("d",t=>this.setLinkPath(t)).attr("transform",({target:t})=>this.onNodeFoldTranslate(this.lastClickNode,t)).transition().duration(this.duration).attr("transform",({target:t})=>`translate(${this.getTranslateOffset(t)},0) scale(1)`)},updateLinks(t){for(let e=0;e<t.length;e++){let n=t[e];const r=this.getLinkId(n.source.data[this.symbolKey],n.target.data[this.symbolKey]),i=p["select"]("#"+r);i.transition().duration(this.duration).attr("transform",` translate(${this.getTranslateOffset(n.target)},0)  scale(1)`).attr("d",()=>this.setLinkPath(n))}},setLinkPath({source:t,target:e}){let n=this.nodeConfig.nodeHeight/2,r=e.data._sign*(t.y+t.data._nodeWidth),i=t.x+n,o=e.data._sign*e.y,a=e.x+n,s=o-r,d=a-i,c=e.data._sign*this.nodeConfig.nodeSize[1];return`M${r},${i}h${s-c/2}v${d}h${c/2}`},nodeToCenterXY(t){let e=0;return e=1==t.data._sign?t.y+t.data._nodeWidth/2:-t.y-t.data._nodeWidth/2+this.treeLayoutData.data._nodeWidth,{x:e,y:t.x+this.nodeConfig.nodeHeight/2}},treeLayout(t){let e=p["tree"]().separation(()=>this.nodeConfig.separation).nodeSize(this.nodeConfig.nodeSize)(t);function n(t){for(let e=0;e<t.length;e++){let r=t[e];r.y=r.y+r.data.offset,v(r.children)&&n(r.children)}}return n(e.children||[]),e},addNodeWidthToData(t){for(let e=0;e<t.length;e++){let n=t[e];n._nodeWidth=this.getNodeWidth(n),v(n.children)&&this.addNodeWidthToData(n.children)}},addNodeOffset(t){const e=this.findTreeSameLevelData;function n(r,i=0){for(let o=0;o<r.length;o++){let a=r[o];if(a.offset=i,v(a.children)){let r=Object(c["maxBy"])(e(t,a),(function(t){return t._nodeWidth}));n(a.children,a.offset+r._nodeWidth)}}}n(t)},findTreeSameLevelData(t,e){let n=[],r=e.level,i=e._sign;function o(t,e,r){for(let a=0;a<t.length;a++){let s=t[a];r!=e||s._sign!=i?v(s.children)&&o(s.children,e,r+1):n.push(s)}}return o(t,r,1),n},getTranslateOffset(t){return-1==t.data._sign&&t.data[this.symbolKey]!=this.treeLayoutData.data[this.symbolKey]?this.treeLayoutData.data._nodeWidth:0},getNodeWidth(t){let e=this.calculateTextWidth(t[this.inner_treeOptions.name],this.nodeConfig.fontSize,this.nodeConfig.fontFamily),n=this.nodeConfig.padding(t);return e+n[1]+n[3]},setLoadingIcon(t,e=!0){t._loading=e;const n=this.getNodeId(t[this.symbolKey]),r=t=>1==t.data._sign?t.data._nodeWidth:-this.defsNodeConfig.loadingSize,i=()=>this.nodeConfig.nodeHeight/2-this.defsNodeConfig.loadingSize/2;if(e){const t=p["select"]("#"+n).append("use").attr("class","moon-hierarchy-loading").attr("xlink:href","#loading");t.attr("x",r).attr("y",i).attr("transform-origin",t=>`${r(t)+this.defsNodeConfig.loadingSize/2} ${i(t)+this.defsNodeConfig.loadingSize/2}`)}else{let t=p["select"]("#"+n).select("use");t.remove()}}}},b=m;function x(t,e,n,r,i,o,a,s){var d,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=n,c._compiled=!0),r&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),a?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},c._ssrRegister=d):i&&(d=s?function(){i.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:i),d)if(c.functional){c._injectStyles=d;var l=c.render;c.render=function(t,e){return d.call(e),l(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,d):[d]}return{exports:t,options:c}}var _=x(b,s,d,!1,null,"07c25468",null),k=_.exports,w=function(){var t=this,e=t._self._c;return e("div",{ref:"svg"})},C=[];function O(t){return t&&t.length}var S={inheritAttrs:!1,name:"",mixins:[y],props:{layout:{type:String,default:"tb"}},components:{},created(){},watch:{},computed:{nodeConfig(){var t,e,n,r;let i={padding:10,nodeWidth:168,nodeHeight:68,lineHeight:10,separation:1.5,exShaps:()=>[],...(null===(t=this.config)||void 0===t?void 0:t.node)||{},rect:{attrs:{},show:!0,on:{},...(null===(e=this.config.node)||void 0===e?void 0:e.rect)||{}},text:{attrs:{},show:!0,on:{},...(null===(n=this.config.node)||void 0===n?void 0:n.text)||{}},plus:{attrs:{},show:!0,on:{},...(null===(r=this.config.node)||void 0===r?void 0:r.plus)||{}}};i.padding=this.setPaddingFormat(i.padding);let o=i.nodeWidth,a=i.nodeHeight,s=0;var d;i.plus.show&&(s=2*((null===(d=i.plus.attrs)||void 0===d?void 0:d.r)||10),i.plus.attrs.r=s/2);let c=i.text.attrs["font-size"]||16;i.text.attrs["font-size"]=c;let l=i.text.attrs["font-family"]||null;i.text.attrs["font-family"]=l;let h=i.text.attrs["line-height"]||10;i.text.attrs["line-height"]=h;let u=i.separation;const f={name:"rect",attrs:{stroke:"rgb(216, 216, 216)",fill:t=>1==t.data.track.length?"#128BED":"boolean"==typeof t.data._isexpend?"rgb(247,247,247)":"#fff","stroke-width":"0.5",...i.rect,height:a,width:t=>t.data._nodeWidth},on:i.rect.on},p={name:"g",attrs:{transform:t=>`translate(${o/2},${a/2-(t.data._name[1]?(c+h)/2:0)})`},on:i.text.on,children:[{name:"text",attrs:{class:"moon-hierarchy-text",fill:t=>1==t.data.track.length?"#fff":O(t.data.children)?"rgb(18, 139, 237)":"rgb(51, 51, 51)",...i.text,"font-size":c,"text-anchor":"middle","dominant-baseline":"middle"},children:[{name:"tspan",attrs:{},compose:{text(t){return t.data._name[0]}}},{name:"tspan",attrs:{x:0,dy:c+h},compose:{text(t){return t.data._name[1]}}}]}]},g={name:"g",attrs:{class:"moon-hierarchy-plus",stroke:"rgb(153, 153, 153)",fill:" rgb(234, 242, 255)","stroke-width":1,...i.plus,display:t=>{if(!O(t.data.children)&&!O(t.data._children)&&!t.data._hasChildren||1==t.data.track.length)return"none"},transform:t=>`translate(${t.data._nodeWidth/2},${(1==t.data._sign?a:0)+t.data._sign*s/2})`},on:i.plus.on,children:[{name:"circle",attrs:{r:s/2}},{name:"line",attrs:{x1:-s/4,y1:"0",x2:s/4,y2:"0"}},{name:"line",attrs:{class:"moon-hierarchy-plus-line2",display:t=>{if(O(t.data.children))return"none"},x1:"0",y1:-s/4,x2:"0",y2:s/4}}]};return{fontSize:c,padding:i.padding,nodeHeight:a,nodeWidth:o,nodeSize:[o,2*a],separation:u,plusCircleWidth:s,shaps:[...i.rect.show?[f]:[],...i.text.show?[p]:[],...i.plus.show?[g]:[],...i.exShaps(i)]}}},methods:{setSign(){var t;const e=(null===(t=this.treeDataFactory.treeData[0].children||this.treeDataFactory.treeData[0]._children)||void 0===t?void 0:t.filter(t=>this.negativeIds.includes(t[this.symbolKey])).map(t=>t[this.symbolKey]))||[];this.treeDataFactory.flatData.forEach(t=>{t._sign=1,"bt"==this.layout&&(t._sign=-1),"bf"==this.layout&&(t._sign=Object(c["intersection"])(t.track,e).length>0?-1:1)}),this.treeDataFactory.treeData[0]._sign=1},initLayoutData(){this.addNodeWidthToData(this.treeDataFactory.treeData),this.setLayoutData()},onNodeExpendTranslate(t){return t||(t={x:0,y:0,data:{_nodeWidth:0}}),1==t.data._sign?`translate(${t.x-t.data._nodeWidth/2},${t.y}) scale(1)`:-1==t.data._sign?`translate(${t.x-t.data._nodeWidth/2},${-t.y}) scale(1)`:void 0},onNodeFoldTranslate(t,e){return t?-1==e.data._sign?`translate(${t.x},${t.y*t.data._sign}) scale(0)`:`translate(${t.x},${t.y+this.nodeConfig.nodeHeight}) scale(0)`:(e.data._sign,`translate(0,${this.nodeConfig.nodeHeight}) scale(0)`)},addLinks(t){const e=this.getLinkId,n=this.symbolKey;this.linksContainer||(this.linksContainer=this.container.append("g").attr("class","moon-hierarchy-links"));let r=this.linksContainer.selectAll().data(t).join("path");this.setAttrByOpt(r,this.linkConifg),r.attr("id",({source:t,target:r})=>e(t.data[n],r.data[n])),r.attr("d",t=>this.setLinkPath(t)).attr("transform",({target:t})=>this.onNodeFoldTranslate(this.lastClickNode,t)).transition().duration(this.duration).attr("transform",({target:t})=>`translate(0,${this.getTranslateOffset(t)}) scale(1)`)},updateLinks(t){for(let e=0;e<t.length;e++){let n=t[e];const r=this.getLinkId(n.source.data[this.symbolKey],n.target.data[this.symbolKey]),i=p["select"]("#"+r);i.transition().duration(this.duration).attr("transform",` translate(0,${this.getTranslateOffset(n.target)} )  scale(1)`).attr("d",()=>this.setLinkPath(n))}},setLinkPath({source:t,target:e}){let n=t.x,r=e.data._sign*(t.y+this.nodeConfig.nodeHeight),i=e.x,o=e.data._sign*e.y,a=i-n,s=o-r;return`M${n},${r}v${s/2}h${a}v${s/2}`},nodeToCenterXY(t){return{x:t.x+t.data._nodeWidth/2,y:t.data._sign*t.y+this.nodeConfig.nodeHeight/2}},treeLayout(t){return p["tree"]().separation(()=>this.nodeConfig.separation).nodeSize(this.nodeConfig.nodeSize)(t)},addNodeWidthToData(t){for(let e=0;e<t.length;e++){let n=t[e];n._nodeWidth=this.nodeConfig.nodeWidth,n["_"+this.inner_treeOptions.name]=this.getFormatTextArr(n),O(n.children)&&this.addNodeWidthToData(n.children)}},getTranslateOffset(t){return-1==t.data._sign&&t.data[this.symbolKey]!=this.treeLayoutData.data[this.symbolKey]?this.nodeConfig.nodeHeight:0},setLoadingIcon(t,e=!0){const n=this.getNodeId(t[this.symbolKey]),r=t=>t.data._nodeWidth/2-this.defsNodeConfig.loadingSize/2,i=t=>1==t.data._sign?this.nodeConfig.nodeHeight+this.nodeConfig.plusCircleWidth:-this.defsNodeConfig.loadingSize-this.nodeConfig.plusCircleWidth;if(e){t._loading=e;const o=p["select"]("#"+n).append("use").attr("class","moon-hierarchy-loading").attr("xlink:href","#loading");o.attr("x",r).attr("y",i).attr("transform-origin",t=>`${r(t)+this.defsNodeConfig.loadingSize/2} ${i(t)+this.defsNodeConfig.loadingSize/2}`)}else{delete t._loading;let e=p["select"]("#"+n).select("use");e.remove()}},getFormatTextArr(t,e=2,n="…"){const r=t[this.inner_treeOptions.name],i=this.nodeConfig.padding(t),o=this.nodeConfig.nodeWidth-i[1]-i[3];let a=[];const s=this.calculateTextWidth;function d(t,e,n,r,i=[]){for(let o=t.length;o>=0;o--){const a=t.slice(0,o),c=s(a,n,r);if(e>=c){i.push(a);let s=t.slice(o);s&&d(s,e,n,r,i);break}}}if(d(r,o,this.nodeConfig.fontSize,this.nodeConfig.fontFamily,a),e&&a.length>e){a=a.slice(0,e);const t=a[e-1];for(let r=t.length;r>=0;r--){const i=t.slice(0,r)+n,d=s(i,this.nodeConfig.fontSize,this.nodeConfig.fontFamily);if(o>=d){a[e-1]=i;break}}}if(a.length<e)for(let c=a.length+1;c<=e;c++)a.push("");return a}}},N=S,D=x(N,w,C,!1,null,"c7b9b268",null),L=D.exports,j={inheritAttrs:!1,name:"MoonHierarchy",props:{mode:{type:String,default:"h"}},components:{horizontal:k,vertical:L},created(){},mounted(){},data(){return{}},watch:{},computed:{},methods:{}},F=j,E=(n("aa86"),x(F,o,a,!1,null,"55760705",null)),$=E.exports;e["default"]=$},fc6a:function(t,e,n){"use strict";var r=n("44ad"),i=n("1d80");t.exports=function(t){return r(i(t))}},fdbf:function(t,e,n){"use strict";var r=n("04f8");t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator}})["default"]}));
//# sourceMappingURL=moon-hierarchy.umd.min.js.map